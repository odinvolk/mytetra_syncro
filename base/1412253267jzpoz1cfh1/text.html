<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:10pt; font-weight:400; font-style:normal;">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">Yii предоставляет гибкий и расширяемый функционал протоколирования. Сообщения можно классифицировать в соответствии с уровнем протоколирования и типом сообщений. Используя фильтры по уровню и категории, можно направить поток сообщений в файлы, электронную почту, окно браузера и т.д. </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-style:italic;"></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Протоколирование сообщений в Yii</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Сообщение может быть запротоколировано путем вызова <a href="http://www.yiiframework.com/doc/api/Yii#log"><span style=" text-decoration: underline; color:#0000ff;">Yii::log</span></a> или <a href="http://www.yiiframework.com/doc/api/Yii#trace"><span style=" text-decoration: underline; color:#0000ff;">Yii::trace</span></a>. Разница между ними заключается в том, что последний пишет в лог только тогда, когда приложение работает в режиме отладки.</p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a1009;">Yii::log($message, $level, $category);</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a1009;">Yii::trace($message, $category); </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для внесения сообщения в лог, необходимо указать категорию и уровень сообщения. Категория представляет собой строку формата <span style=" font-family:'Courier New,courier';">xxx.yyy.zzz</span>, что очень схоже с форматом представления <a href="http://yiiframework.ru/doc/guide/ru/basics.namespace"><span style=" text-decoration: underline; color:#0000ff;">псевдонима пути</span></a>. Например, если сообщение добавляется в лог в <a href="http://www.yiiframework.com/doc/api/CController"><span style=" text-decoration: underline; color:#0000ff;">CController</span></a>, мы можем использовать категорию <span style=" font-family:'Courier New,courier';">system.web.CController</span>. Уровень сообщения может иметь одно из следующих значений: </p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">trace</span>: этот уровень используется методом <a href="http://www.yiiframework.com/doc/api/Yii#trace"><span style=" text-decoration: underline; color:#0000ff;">Yii::trace</span></a>. Он предназначен для отслеживания процесса выполнения приложения в ходе разработки;</li>
<li style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">info</span>: этот уровень предназначен для протоколирования информации общего характера;</li>
<li style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">profile</span>: данный уровень используется для профилирования (измерения) производительности;</li>
<li style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">warning</span>: этот уровень предназначен для сообщений-предупреждений;</li>
<li style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">error</span>: этот уровень используется для сообщений о критических ошибках.</li></ul>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Маршрутизация сообщений</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Сообщения, протоколируемые с использованием <a href="http://www.yiiframework.com/doc/api/Yii#log"><span style=" text-decoration: underline; color:#0000ff;">Yii::log</span></a> или <a href="http://www.yiiframework.com/doc/api/Yii#trace"><span style=" text-decoration: underline; color:#0000ff;">Yii::trace</span></a>, хранятся в памяти. Как правило, нам требуется либо отобразить их в окне браузера, либо сохранить в файле, отправить электронным письмом и пр. Направление сообщений в различные места назначения называется <span style=" font-style:italic;">маршрутизацией сообщений</span>. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В Yii за маршрутизацию сообщений отвечает компонент приложения <a href="http://www.yiiframework.com/doc/api/CLogRouter"><span style=" text-decoration: underline; color:#0000ff;">CLogRouter</span></a>. Этот компонент управляет множеством так называемых <span style=" font-style:italic;">маршрутов сообщений</span>. Каждый маршрут представляет одно место назначения потока сообщений. Сообщения, направляемые по тому или иному маршруту, можно отфильтровать в зависимости от их уровня и типа. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для того, чтобы воспользоваться маршрутизацией сообщений, нам необходимо установить и подгрузить заранее компонент приложения <a href="http://www.yiiframework.com/doc/api/CLogRouter"><span style=" text-decoration: underline; color:#0000ff;">CLogRouter</span></a>. Кроме того, необходимо настроить свойство <a href="http://www.yiiframework.com/doc/api/CLogRouter#routes"><span style=" text-decoration: underline; color:#0000ff;">routes</span></a> этого компонента, указав маршруты сообщений, которые предполагается использовать. Ниже приведен пример необходимой <a href="http://yiiframework.ru/doc/guide/ru/basics.application#application-configuration"><span style=" text-decoration: underline; color:#0000ff;">конфигурации приложения</span></a>: </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">array(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    …</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    'preload'=&gt;array('log'),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    'components'=&gt;array(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">        …</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">        'log'=&gt;array(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">            'class'=&gt;'CLogRouter',</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">            'routes'=&gt;array(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                array(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                    'class'=&gt;'CFileLogRoute',</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                    'levels'=&gt;'trace, info',</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                    'categories'=&gt;'system.*',</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                ),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                array(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                    'class'=&gt;'CEmailLogRoute',</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                    'levels'=&gt;'error, warning',</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                    'emails'=&gt;'admin@example.com',</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                ),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">            ),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">        ),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    ),</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">) </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В примере выше, у нас есть два маршрута сообщений. Первый - <a href="http://www.yiiframework.com/doc/api/CFileLogRoute"><span style=" text-decoration: underline; color:#0000ff;">CFileLogRoute</span></a> - сохраняет сообщения в папке приложения для временных файлов <span style=" font-family:'Courier New,courier';">runtime</span>. Сохраняются только сообщения с уровнем <span style=" font-family:'Courier New,courier';">trace</span> или <span style=" font-family:'Courier New,courier';">info</span> и чья категория начинается с <span style=" font-family:'Courier New,courier';">system.</span>. Второй маршрут - <a href="http://www.yiiframework.com/doc/api/CEmailLogRoute"><span style=" text-decoration: underline; color:#0000ff;">CEmailLogRoute</span></a> - отправляет сообщения на указанный электронный адрес. Отправляются только сообщения уровня <span style=" font-family:'Courier New,courier';">error</span> или <span style=" font-family:'Courier New,courier';">warning</span>. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Начиная с Yii версии 1.1.13 можно исключать определённые категории: </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">'routes'=&gt;array(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">        array(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">            'class'=&gt;'CEmailLogRoute',</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">            'levels'=&gt;'error, warning',</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">            'except'=&gt;'system.CModule.*' // отсылаем почтой всё кроме сообщений от CModule</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">            'emails'=&gt;'admin@example.com',</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">        ),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">        array(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">            'class'=&gt;'CWebLogRoute',</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">            'categories'=&gt;'system.db.*',</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">            'except'=&gt;'system.db.ar.*', // показываем всё, что касается базы данных, но не касается AR</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">        ), </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В Yii доступны для использования следующие маршруты сообщений: </p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.yiiframework.com/doc/api/CDbLogRoute"><span style=" text-decoration: underline; color:#0000ff;">CDbLogRoute</span></a>: сохраняет сообщения в таблицу базы данных;</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.yiiframework.com/doc/api/CEmailLogRoute"><span style=" text-decoration: underline; color:#0000ff;">CEmailLogRoute</span></a>: отправляет сообщения на указанный адрес электронной почты;</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.yiiframework.com/doc/api/CFileLogRoute"><span style=" text-decoration: underline; color:#0000ff;">CFileLogRoute</span></a>: сохраняет сообщения во временной папке приложения;</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.yiiframework.com/doc/api/CWebLogRoute"><span style=" text-decoration: underline; color:#0000ff;">CWebLogRoute</span></a>: отображает сообщения в конце текущей страницы;</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.yiiframework.com/doc/api/CProfileLogRoute"><span style=" text-decoration: underline; color:#0000ff;">CProfileLogRoute</span></a>: отображает сообщения о производительности в конце текущей страницы.</li></ul>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">array(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    ......</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    'preload'=&gt;array('log'),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    'components'=&gt;array(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">        ......</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">        'log'=&gt;array(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">            'class'=&gt;'CLogRouter',</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">            'routes'=&gt;array(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                array(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                    'class'=&gt;'CProfileLogRoute',</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                    'report'=&gt;'summary',</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                    // Показывает время выполнения каждого отмеченного блока кода.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                    // Значение &quot;report&quot; также можно указать как &quot;callstack&quot;.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                ),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                ...остальные маршруты...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">            ),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">        ),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    ),</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">) </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Информация:</span> Маршрутизация сообщения происходит в конце каждого текущего цикла обработки запроса, в момент, когда вызывается событие <a href="http://www.yiiframework.com/doc/api/CApplication#onEndRequest"><span style=" text-decoration: underline; color:#0000ff;">onEndRequest</span></a>. Для прерывания процесса обработки текущего запроса, используйте метод <a href="http://www.yiiframework.com/doc/api/CApplication#end"><span style=" text-decoration: underline; color:#0000ff;">CApplication::end()</span></a> вместо <span style=" font-family:'Courier New,courier';">die()</span> или <span style=" font-family:'Courier New,courier';">exit()</span>. <a href="http://www.yiiframework.com/doc/api/CApplication#end"><span style=" text-decoration: underline; color:#0000ff;">CApplication::end()</span></a> вызывает событие <a href="http://www.yiiframework.com/doc/api/CApplication#onEndRequest"><span style=" text-decoration: underline; color:#0000ff;">onEndRequest</span></a>, что позволяет корректно запротоколировать сообщения. </p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Фильтрация сообщений</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Как уже упоминалось выше, сообщения можно отфильтровать по их уровню и типу до того, как они будут направлены тем или иным маршрутом. Это осуществляется путем настройки свойств <a href="http://www.yiiframework.com/doc/api/CLogRoute#levels"><span style=" text-decoration: underline; color:#0000ff;">levels</span></a> и <a href="http://www.yiiframework.com/doc/api/CLogRoute#categories"><span style=" text-decoration: underline; color:#0000ff;">categories</span></a> соответствующего маршрута. Если необходимо указать несколько уровней или типов, значения должны быть разделены запятыми. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Поскольку типы сообщений указываются в формате <span style=" font-family:'Courier New,courier';">xxx.yyy.zzz</span>, мы можем воспринимать их как иерархию типов. В частности, мы говорим, что <span style=" font-family:'Courier New,courier';">xxx</span> является родителем <span style=" font-family:'Courier New,courier';">xxx.yyy</span>, а последний в свою очередь является родителем для <span style=" font-family:'Courier New,courier';">xxx.yyy.zzz</span>. Поэтому для указания типа <span style=" font-family:'Courier New,courier';">xxx</span>, а также всех его типов-потомков можно использовать выражение <span style=" font-family:'Courier New,courier';">xxx.*</span>. </p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Сохранение контекста сообщений</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Мы можем сохранять дополнительную информацию, такую как предопределённые переменные PHP (<span style=" font-family:'Courier New,courier';">$_GET</span>, <span style=" font-family:'Courier New,courier';">$_SERVER</span>), ID сессии, имя пользователя и т.д. Для этого необходимо задать необходимый фильтр в свойстве <a href="http://www.yiiframework.com/doc/api/CLogRoute#filter"><span style=" text-decoration: underline; color:#0000ff;">CLogRoute::filter</span></a>. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В состав фреймворка входит удобный класс <a href="http://www.yiiframework.com/doc/api/CLogFilter"><span style=" text-decoration: underline; color:#0000ff;">CLogFilter</span></a>, который может быть использован в качестве фильтра в большинстве случаев. По умолчанию, <a href="http://www.yiiframework.com/doc/api/CLogFilter"><span style=" text-decoration: underline; color:#0000ff;">CLogFilter</span></a> будет записывать сообщение вместе с такими переменными, как <span style=" font-family:'Courier New,courier';">$_GET</span> и <span style=" font-family:'Courier New,courier';">$_SERVER</span>, которые обычно содержат ценную системную информацию. Можно настроить <a href="http://www.yiiframework.com/doc/api/CLogFilter"><span style=" text-decoration: underline; color:#0000ff;">CLogFilter</span></a> таким образом, чтобы перед каждым сообщением записывать ID сессии, имя пользователя и другие данные, которые могут облегчить поиск по большому количеству сообщений. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Следующие настройки включают запись контекста сообщений. У каждого журнального маршрута может быть задан свой фильтр. По умолчанию никакого фильтра не задано. </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">array(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    …</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    'preload'=&gt;array('log'),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    'components'=&gt;array(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">        …</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">        'log'=&gt;array(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">            'class'=&gt;'CLogRouter',</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">            'routes'=&gt;array(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                array(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                    'class'=&gt;'CFileLogRoute',</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                    'levels'=&gt;'error',</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                    'filter'=&gt;'CLogFilter',</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                ),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                …other log routes…</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">            ),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">        ),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    ),</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">) </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Yii поддерживает журналирование информации стека вызова в сообщениях, протоколируемых путем вызова <a href="http://www.yiiframework.com/doc/api/Yii#trace"><span style=" text-decoration: underline; color:#0000ff;">Yii::trace</span></a>. По умолчанию, данная особенность отключена, т.к. снижает производительность. Для ее использования, необходимо просто определить константу <span style=" font-family:'Courier New,courier';">YII_TRACE_LEVEL</span> в начале входного скрипта (до включения файла <span style=" font-family:'Courier New,courier';">yii.php</span>) целым числом большим нуля. Тогда Yii будет добавлять в каждое трассирующее сообщение имя файла и номер строки стека вызова, в которых был сделан вызов кода. Число <span style=" font-family:'Courier New,courier';">YII_TRACE_LEVEL</span> определяет количество слоев каждого стека вызова, которое должно быть записано. Эта информация особенно полезна на стадии разработки, так как может помочь нам определить места, в которых вызываются трассирующие сообщения.</p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p></body></html>
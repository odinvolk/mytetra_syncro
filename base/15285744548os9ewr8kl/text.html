<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans';"> немножко доработал </span><a href="https://pro-prof.com/archives/1520"><span style=" font-family:'Sans'; text-decoration: underline; color:#0000ff;">игрушку на Qt</span></a><span style=" font-family:'Sans';"> из предыдущей статьи, выложил ее на google play и решил описать всё, что мне показалось интересным в этом процессе: получение аккаунта разработчика, сборка приложения для google play, проблемы с файлами дополнений и отладка приложения.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="more-1568"></a><span style=" font-family:'Sans';">Д</span><span style=" font-family:'Sans';">ля того, чтобы </span><span style=" font-family:'Sans'; font-style:italic;">размещать приложения на площадке гугла</span><span style=" font-family:'Sans';">, надо иметь </span><span style=" font-family:'Sans'; font-weight:600;">аккаунт разработчика для google play</span><span style=" font-family:'Sans';"> [2]. Регистрация стоит денег (в районе 900 рублей), которые требуют переводить с банковской карты типа Visa, MasterCard или некоторых другие. У меня было 2 банковских карты — зарплатная MasterCard и Visa Momentum. Обе не подошли, пришлось заказывать новую карту Visa Classic (заняло 2 недели).</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:x-large; font-weight:600;">Сборка Qt-приложения для google play</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans';">До того, как </span><span style=" font-family:'Sans'; font-style:italic;">выложить игру на маркет</span><span style=" font-family:'Sans';">, я собирал </span><span style=" font-family:'Sans'; font-style:italic;">.apk-файл для android</span><span style=" font-family:'Sans';">, копировал его на телефон или передавал товарищам. Несмотря на то, что я использовал тип сборки </span><span style=" font-family:'Sans'; font-style:italic;">выпуск (release)</span><span style=" font-family:'Sans';">, почему-то получался файл с префиксом </span><span style=" font-family:'Sans'; font-style:italic;">debug </span><span style=" font-family:'Sans';">и я не придавал этому значения,пока гугл не сообщил, что отладочная версия его не устроит. Для сборки релизной версии не достаточно установить </span><span style=" font-family:'Sans'; font-style:italic;">галочку «выпуск» в настройках проекта</span><span style=" font-family:'Sans';">, надо покопаться в настройках установки (</span><span style=" font-family:'Sans'; font-style:italic;">проекты-&gt;run-&gt;конфигурация установки</span><span style=" font-family:'Sans';">).</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans';"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image978238945.png" width="766" height="316" /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="attachment_1574"></a><span style=" font-family:'Sans';">В</span><span style=" font-family:'Sans';">ыбор типа сборки </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans';">В настройках установки можно выбрать </span><span style=" font-family:'Sans'; font-style:italic;">установку Ministro</span><span style=" font-family:'Sans';"> — тогда ваше приложение будет «весить меньше», но при первом запуске будет устанавливать </span><span style=" font-family:'Sans'; font-style:italic;">Ministro</span><span style=" font-family:'Sans';">, которое подгрузит нужные библиотеки, это удобно при отладке приложения на своем телефоне. </span><span style=" font-family:'Sans'; font-style:italic;">Установка во временный каталог</span><span style=" font-family:'Sans';"> тоже используется при отладке, а для выпуска приложения на маркет надо </span><span style=" font-family:'Sans'; font-style:italic;">внедрять библиотеки в .apk-файл</span><span style=" font-family:'Sans';">.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans';"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1309333464.png" width="773" height="433" /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="attachment_1573"></a><span style=" font-family:'Sans';">К</span><span style=" font-family:'Sans';">онфигурация установки </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans';">У вас никак не получится собрать релиз без </span><span style=" font-family:'Sans'; font-style:italic;">подписывания пакета</span><span style=" font-family:'Sans';">, а для этого нужно создать </span><span style=" font-family:'Sans'; font-style:italic;">связку ключей (keychain)</span><span style=" font-family:'Sans';">, щелкнув соответствующую кнопку в окне конфигурации установки.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans';"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image2111135216.png" width="654" height="441" /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="attachment_1572"></a><span style=" font-family:'Sans';">С</span><span style=" font-family:'Sans';">оздание связки ключей и сертификата </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans';">В появившемся окне я ввел только пароль и персональные данные, остальные поля оставил со значениями по умолчанию. Теперь при сборке у вас должна получаться релизная версия, но при загрузке на маркет, вы будете получать ошибку о том, что приложению надо установить иконку (добавлен иконок на сайте маркета тут не при чем).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans';">Для добавления иконки нужно создать </span><span style=" font-family:'Sans'; font-weight:600;">файл манифеста</span><span style=" font-family:'Sans';"> (кнопкой на экране конфигурации установки).</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans';"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1920489346.png" width="668" height="337" /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="attachment_1571"></a><span style=" font-family:'Sans';">Н</span><span style=" font-family:'Sans';">астройка манифеста </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-style:italic;">Файл манифеста</span><span style=" font-family:'Sans';"> можно редактировать как руками (это </span><span style=" font-family:'Sans'; font-style:italic;">.xml-файл</span><span style=" font-family:'Sans';">), так и специальным инструментом, встроенным в </span><span style=" font-family:'Sans'; font-style:italic;">Qt Creator</span><span style=" font-family:'Sans';">. В файле манифеста нужно указать:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans';" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">имя пакета</span> — идентификатор приложения на маркете;</li>
<li style=" font-family:'Sans';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">код и название версии</span> — вы будете менять их всякий раз при обновлении приложения;</li>
<li style=" font-family:'Sans';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">иконку приложения</span> — я добавил только одну иконку 512х512 пикселей (иконку такого же размера потом надо будет добавить на маркет);</li>
<li style=" font-family:'Sans';" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">разрешения</span> — если ваше приложение работает с интернетом, файловой системой и т.п., то дополнительные разрешения надо будет выбрать из выпадающего списка. При установке приложения пользователя предупредят о том, куда лезет ваша программа.</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans';">Теперь приложение соберется для выпуска и </span><span style=" font-family:'Sans'; font-style:italic;">.apk файл можно будет загрузить на маркет</span><span style=" font-family:'Sans';">.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans';"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image269753733.png" /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="attachment_1569"></a><span style=" font-family:'Sans';">З</span><span style=" font-family:'Sans';">агрузка .apk-файла </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans';">К загруженному приложению нужно добавить иконки, рекламные материалы и не менее двух скриншотов. Если ваше приложение использует много ресурсов (музыки, видео, …) и занимает много места, то ресурсы могут быть вынесены в файлы дополнения (об этом я напишу дальше чуть подробнее).</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans';"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1508007307.png" width="644" height="273" /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="attachment_1570"></a><span style=" font-family:'Sans';">З</span><span style=" font-family:'Sans';">агрузка иконок и рекламных изображений </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans';">После этого приложение можно опубликовать как альфа-/бета-версию, нагнать тестеров, а затем повысить до рабочей версии.</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:x-large; font-weight:600;">Файлы дополнения на Android</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans';">В игрушку я добавил меню, позволяющее выбрать уровень. Перед тем, как выкладывать приложение на маркет, я прочитал про файлы дополнений. </span><span style=" font-family:'Sans'; font-style:italic;">Прочитал плохо</span><span style=" font-family:'Sans';">, отсюда появилась проблема — я захотел обновлять приложение изменяя лишь файл дополнений (я подумал, что пользователю приятнее скачать несколько килобайт файла с описанием уровней, чем 10 мегабайт приложения), но это оказалось невозможно. Изменить файл дополнения можно лишь изменив </span><span style=" font-family:'Sans'; font-style:italic;">.apk-файл</span><span style=" font-family:'Sans';">, который оно дополняет, при этом обязательно </span><span style=" font-family:'Sans'; font-style:italic;">изменится версия приложения (указанная в файле манифеста)</span><span style=" font-family:'Sans';">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans';">Можно попытаться найти обходные пути — например, хранить файл с описанием уровней на каком-нибудь сервере в интернете, но тогда приложение не будет </span><span style=" font-family:'Sans'; font-weight:600;">автоматически</span><span style=" font-family:'Sans';"> обновляться (</span><span style=" font-family:'Sans'; font-style:italic;">как это делается через google play</span><span style=" font-family:'Sans';">). Пользователь не узнает о новых уровнях, пока не откроет приложение в то время, когда будет иметь доступ к интернету и сервер с файлом уровней будет доступен. В общем, лучше так не делать.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans';">Пока я возился с дополнениями, я столкнулся с еще одной проблемой — при загрузке, оно переименовывается и </span><span style=" font-family:'Sans'; font-style:italic;">размещается далеко не в том же каталоге, что и .apk файл</span><span style=" font-family:'Sans';">. Чтобы обратиться к нему, надо будет сначала получить путь к каталогу с дополнениями, а это можно сделать с использованием </span><span style=" font-family:'Sans'; font-style:italic;">QtAndroidExtras</span><span style=" font-family:'Sans';">. В общем, это не так красиво, как хотелось бы и я не стал заморачиваться.</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:x-large; font-weight:600;">Тестирование приложения на google play</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans';">Очень понравилась </span><span style=" font-family:'Sans'; font-style:italic;">организация тестирования на google play</span><span style=" font-family:'Sans';">. У приложения есть 3 стадии:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans';" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">альфа-версия</span>. Приложение не доступно для поиска в маркете, никто случайно его не установит и ругаться не будет. В настройках проекта (на той же вкладке, где вы загружали .apk файл) есть кнопка «<span style=" font-style:italic;">изменить список тестировщиков</span>«. Можно либо добавлять тестеров по одному (с указанием из <span style=" font-style:italic;">почты на gmail</span>), либо добавить <span style=" font-style:italic;">сообщество google+</span> (я создал сообщество). Все люди, вошедшие в сообщество, получают доступ к тестированию, но на маркете они найти приложение до сих пор не могут, поэтому <span style=" font-style:italic;">в сообществе стоит разместить ссылку на приложение</span>. Понравилось то, что есть хорошая возможность прорекламировать сообщество и игрушку в социальной сети google. Сообщество — это место для обсуждения, т.е. в нем Вам могут написать о пожеланиях и найденных ошибках;</li>
<li style=" font-family:'Sans';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">бета-версия. Приложение по прежнему не доступно через поиск на <span style=" font-style:italic;">google play</span>, но для его тестирования уже не обязательно вступать в сообщество, достаточно воспользоваться ссылкой (это очень удобно для поиска тестеров на сторонних сайтах, не связанных с <span style=" font-style:italic;">google+</span>);</li>
<li style=" font-family:'Sans';" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">рабочая версия. Приложение доступно через поиск, его могут скачивать, ставить плохие оценки и писать отзывы.</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans';">Ссылку на тестирование я разместил на нескольких тематических сайтах [3, 4, 5], игрушку попробовали, нашли один баг и даже приложили архив с забавным звуком топота ежика. В общем, я думаю, что публиковать ссылки на приложение нужно везде, это поможет сделать программу лучше.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-weight:600;">Ссылки по теме:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans';" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://pro-prof.com/archives/1520"><span style=" text-decoration: underline; color:#0000ff;">Разработка игры на С++, Qt</span></a> // URL: https://pro-prof.com/archives/1520</li>
<li style=" font-family:'Sans';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Регистрация разработчиков google play // URL: https://support.google.com/googleplay/android-developer/answer/6112435?hl=ru&amp;visit_id=1-636242945450941482-2796141705&amp;rd=1</li>
<li style=" font-family:'Sans';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Форум Google Android — это не сложно // URL: http://forum.startandroid.ru/index.php</li>
<li style=" font-family:'Sans';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Форум программистов — Обсуждение программ // URL: http://programmersforum.ru/forumdisplay.php?f=25</li>
<li style=" font-family:'Sans';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">4PDA — Создание игр под Android // URL: http://4pda.ru/forum/index.php?showforum=550</li>
<li style=" font-family:'Sans';" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://pro-prof.com/about"><span style=" text-decoration: underline; color:#0000ff;">Описание проекта, исходный код</span></a> // URL: https://pro-prof.com/about</li></ol>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans';"><br /></p></body></html>
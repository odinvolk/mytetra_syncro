<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:10pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:xx-large; font-weight:600;">Сигналы и слоты<br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Сигналы и слоты используются для связи между объектами. Механизм сигналов и слотов - это основная особенность Qt и, вероятно, основная часть Qt, которая больше всего отличается по функциональности от других библиотек.</p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://doc.crossplatform.ru/qt/4.3.2/signalsandslots.html#introduction"><span style=" text-decoration: underline; color:#0000ff;">Введение</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://doc.crossplatform.ru/qt/4.3.2/signalsandslots.html#signals-and-slots"><span style=" text-decoration: underline; color:#0000ff;">Сигналы и слоты</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://doc.crossplatform.ru/qt/4.3.2/signalsandslots.html#a-small-example"><span style=" text-decoration: underline; color:#0000ff;">Небольшой пример</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://doc.crossplatform.ru/qt/4.3.2/signalsandslots.html#building-the-example"><span style=" text-decoration: underline; color:#0000ff;">Сборка примера</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://doc.crossplatform.ru/qt/4.3.2/signalsandslots.html#signals"><span style=" text-decoration: underline; color:#0000ff;">Сигналы</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://doc.crossplatform.ru/qt/4.3.2/signalsandslots.html#slots"><span style=" text-decoration: underline; color:#0000ff;">Слоты</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://doc.crossplatform.ru/qt/4.3.2/signalsandslots.html#meta-object-information"><span style=" text-decoration: underline; color:#0000ff;">Мета-объектная информация</span></a></li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://doc.crossplatform.ru/qt/4.3.2/signalsandslots.html#a-real-example"><span style=" text-decoration: underline; color:#0000ff;">Реальный пример</span></a><a name="introduction"></a> </li></ul>
<p style="-qt-paragraph-type:empty; margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Введение</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">При программировании графического интерфейса пользователя мы часто хотим сообщать одним элементам об изменении других элементов управления. Более обобщенно можно сказать, что мы хотим обеспечить связь между объектами любых видов. Например, если пользователь нажимает кнопку <span style=" font-weight:600;">Close</span> мы, вероятно, хотим, чтобы была вызвана функция окна <span style=" font-family:'Courier New'; color:#6a1009;">close()</span>.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Более старые инструментарии обеспечивают подобную связь с помощью функций обратного вызова. Обратный вызов - это указатель на функцию. Если вы хотите, чтобы функция обработки уведомила вас о некотором событии, вы передаете ей указатель на другую функцию (отзыв). Функция обработки вызовет функцию обратного вызова, когда это будет уместно. Но данный подход имеет два фундаментальных недостатка: во-первых, он не типобезопасен. Мы некогда не сможем проверить, что функция обработки вызывает отзыв с правильными аргументами. Во-вторых, этот метод жестко связан с функцией обработки, так как она должна знать, какой отзыв вызывать.<a name="signals-and-slots"></a> </p>
<p style="-qt-paragraph-type:empty; margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Сигналы и слоты</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В Qt мы ввели технику, альтернативную функциям обратного вызова: мы используем сигналы и слоты. Сигнал испускается, когда происходит определенное событие. Виджеты Qt имеют множество предопределенных сигналов, и вы всегда можете создать их подклассы, чтобы добавить свои сигналы. Слот - это функция, вызываемая в ответ на определенный сигнал. Виджеты Qt имеют множество предопределенных слотов, но вы, и это стало общеиспользуемой практикой, можете создавать подклассы виджетов и добавлять свои слоты для того, чтобы обрабатывать поступающие сигналы, как того хотите.</p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image27774.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Этот механизм типобезопасен: сигнатура сигнала должна соответствовать сигнатуре принимающего слота. (Фактически, слот может иметь более короткую сигнатуру, чем сигнал, который он получает, поскольку может игнорировать лишние аргументы.) Сигналы и слоты связаны без нежёстко: Класс, испускающий сигналы, не знает и не интересуется, который из слотов получит сигнал. Механизм сигналов и слотов Qt гарантирует, что, если Вы соединили сигнал со слотом, слот будет вызываться с параметрами сигнала в нужный момент. Сигналы и слоты могут иметь любое количество аргументов любых типов. Они полностью типобезопасны.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Все классы, наследуемые от <span style=" font-family:'Courier New'; color:#6a1009;">QObject</span> или одного из его подклассов (например, <span style=" font-family:'Courier New'; color:#6a1009;">QWidget</span>) могут содержать сигналы и слоты. Сигналы испускаются при изменении объектом своего состояния, если это изменение может быть интересно другим объектам. Все объекты делают это для связи с другими объектами. Их не заботит, получает ли кто-нибудь испускаемые ими сигналы. Это является истинной инкапсуляцией информации, и она гарантирует, что объекты могут использоваться как отдельные компоненты программного обеспечения.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Слоты могут получать сигнал, но они также являются обыкновенными функциями-членами. Также, как объект не знает, получает ли кто-нибудь сигналы, испускаемые им, слоты не знают, существуют ли сигналы, с ними связанные. Это гарантирует, что можно создать полностью независимые Qt компоненты.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вы можете присоединять к одному слоту столько сигналов, сколько вам будет нужно, и один сигнал может быть соединен со столькими слотами, сколько вам требуется. Даже возможно соединять сигнал непосредственно с другим сигналом. (Второй сигнал будет испускаться немедленно всякий раз, когда испускается первый.)</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вместе сигналы и слоты представляют собой мощный механизм компонентного программирования.<a name="a-small-example"></a> </p>
<p style="-qt-paragraph-type:empty; margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Небольшой пример</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Минимальная декларация класса C++ может выглядеть следующим образом:</p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> class Counter</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> public:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     Counter() { m_value = 0; }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     int value() const { return m_value; }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     void setValue(int value);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> private:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     int m_value;</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> };</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Небольшой класс, основанный на <span style=" font-family:'Courier New'; color:#6a1009;">QObject</span>, может выглядеть так:</p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> #include &lt;QObject&gt;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> class Counter : public QObject</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     Q_OBJECT</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> public:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     Counter() { m_value = 0; }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     int value() const { return m_value; }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> public slots:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     void setValue(int value);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> signals:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     void valueChanged(int newValue);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> private:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     int m_value;</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> };</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Версия класса, основанная на <span style=" font-family:'Courier New'; color:#6a1009;">QObject</span>, имеет то же самое внутреннее состояние и предоставляет открытые методы для доступа к нему, но в дополнение к этому она поддерживает компонентное программирование с использованием сигналов и слотов. Этот класс, испустив сигнал <span style=" font-family:'Courier New,courier';">valueChanged()</span>, может сообщать вовне, что его состояние изменилось, и имеет слот, которому другие объекты могут посылать сигналы.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Все классы, содержащие сигналы и слоты, должны упомянуть макрос <span style=" font-family:'Courier New'; color:#6a1009;">Q_OBJECT</span> в начале своей декларации. Также они должны происходить (прямо или косвенно) от <span style=" font-family:'Courier New'; color:#6a1009;">QObject</span>.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Слоты реализуются программистом. Вот возможная реализация слота <span style=" font-family:'Courier New,courier';">Counter::setValue()</span>:</p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> void Counter::setValue(int value)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     if (value != m_value) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">         m_value = value;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">         emit valueChanged(value);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     }</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> }</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Строка, содержащая <span style=" font-family:'Courier New,courier';">emit</span>, заставляет объект испустить сигнал <span style=" font-family:'Courier New,courier';">valueChanged()</span> с новым значением, переданным в аргументе.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В следующем фрагменте кода мы создаем два объекта <span style=" font-family:'Courier New,courier';">Counter</span> и соединяем сигнал первого объекта <span style=" font-family:'Courier New,courier';">valueChanged()</span> со слотом второго объекта <span style=" font-family:'Courier New,courier';">setValue()</span>, используя <span style=" font-family:'Courier New'; color:#6a1009;">QObject::connect()</span>:</p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     Counter a, b;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     QObject::connect(&amp;a, SIGNAL(valueChanged(int)),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                      &amp;b, SLOT(setValue(int)));</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     a.setValue(12);     // a.value() == 12, b.value() == 12</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     b.setValue(48);     // a.value() == 12, b.value() == 48</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вызов <span style=" font-family:'Courier New,courier';">a.setValue(12)</span> заставляет <span style=" font-family:'Courier New,courier';">a</span> испускать сигнал <span style=" font-family:'Courier New,courier';">valueChanged(12)</span>, который будет получен объектом <span style=" font-family:'Courier New,courier';">b</span> через слот <span style=" font-family:'Courier New,courier';">setValue()</span>, т.е. будет вызвана функция <span style=" font-family:'Courier New,courier';">b.setValue(12)</span>. Затем <span style=" font-family:'Courier New,courier';">b</span> сам испустит сигнал <span style=" font-family:'Courier New,courier';">valueChanged()</span>, но так как никто не связан с объектом <span style=" font-family:'Courier New,courier';">b</span> через сигнал <span style=" font-family:'Courier New,courier';">valueChanged()</span>, он будет проигнорирован.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обратите внимание на то, что функция <span style=" font-family:'Courier New,courier';">setValue()</span> устанавливает значение и испускается только в том случае, если <span style=" font-family:'Courier New,courier';">value != m_value</span>. Это предотвращает бесконечный цикл при циклических соединениях (например, если бы <span style=" font-family:'Courier New,courier';">b.valueChanged()</span> был соединён с <span style=" font-family:'Courier New,courier';">a.setValue()</span>).</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Сигнал испускается для каждого соединения, которое было создано; если сигнал соединен с двумя слотами, то он будет испущен дважды. Также вы можете разорвать соединение с помощью <span style=" font-family:'Courier New'; color:#6a1009;">QObject::disconnect()</span>.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Данный пример иллюстрирует совместную работу объектов, которые ничего не знают друг о друге. Для её достижения объекты должны быть соединены с помощью вызова простой функции <span style=" font-family:'Courier New'; color:#6a1009;">QObject::connect()</span> или посредством функции <span style=" font-family:'Courier New,courier';">uic</span>'а - <span style=" font-weight:600; color:#000000;">автоматическим связыванием</span>.<a name="building-the-example"></a> </p>
<p style="-qt-paragraph-type:empty; margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Сборка примера</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Препроцессор C++ заменяет или удаляет ключевые слова <span style=" font-family:'Courier New,courier';">signals</span>, <span style=" font-family:'Courier New,courier';">slots</span> и <span style=" font-family:'Courier New,courier';">emit</span> для того, чтобы компилятору был предоставлен код, соответствующий стандарту C++.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">С помощью <span style=" font-family:'Courier New'; color:#6a1009;">moc</span> обрабатываются определения классов, содержащих сигналы и слоты, и генерируются файлы реализации C++, которые будут скомпилированы и связаны с другими объектными файлами приложения. Если вы используете <span style=" font-family:'Courier New'; color:#6a1009;">qmake</span>, то в make-файл будет автоматически добавлен вызов <span style=" font-family:'Courier New,courier';">moc</span>.<a name="signals"></a> </p>
<p style="-qt-paragraph-type:empty; margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Сигналы</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Сигналы испускаются объектом, когда изменяется его внутреннее состояние, и если это может быть интересно его клиентам или владельцу. Только классы, содержащие определения сигналов, и их подклассы могут испускать сигналы.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">При испускании сигнала слоты, с ним связанные, исполняются немедленно, так же, как при обычном вызове функции. Когда это случается, механизм сигналов и слотов полностью независим от цикла обработки событий графического интерфейса пользователя. Выполнение кода, следующего за выражением <span style=" font-family:'Courier New,courier';">emit</span> продолжится, как только завершится выполнение всех слотов. В случае с <span style=" font-weight:600; color:#000000;">очередями соединений</span> ситуация несколько отлична; при этом исполнение кода, следующего за <span style=" font-family:'Courier New,courier';">emit</span>, продолжится немедленно, а слоты будут исполнены несколько позже.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если несколько слотов связаны с одним сигналом, то при испускании сигнала они будут выполнены один за другим в произвольном порядке.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Внимание!</span> Сигналы автоматически генерируются утилитой <span style=" font-family:'Courier New'; color:#6a1009;">moc</span>, и вы не должны включать их реализацию в <span style=" font-family:'Courier New,courier';">.cpp</span> файлы. Они не должны иметь возвращаемых типов (т.е. использовать <span style=" font-family:'Courier New'; color:#6a1009;">void</span>).</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">Замечание про аргументы:</span> наш опыт показывает, что сигналы и слоты более пригодны для повторного применения, если они не используют специальных типов. Если сигнал <span style=" font-family:'Courier New'; color:#6a1009;">QScrollBar::valueChanged()</span> должен использовать специальный тип, такой как гипотетический <span style=" font-family:'Courier New'; color:#6a1009;">QScrollBar::Range</span>, он может быть соединен только со слотами, спроектированными специально для <span style=" font-family:'Courier New'; color:#6a1009;">QScrollBar</span>. </p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Слоты</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Слот вызывается как только испускается соединенный с ним сигнал. Слоты - это обычные функции C++, они могут вызываться обычным образом; их единственная особенность - это то, что к ним могут быть присоединены сигналы.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Так как слоты являются обычными функциями-членами, они имеют права доступа, подобные обычным функциям-членам. Вместе с тем, в качестве слотов они могут быть вызваны любым компонентом независимо от уровня доступа посредством соединения сигнал-слот. Это означает, что сигнал, испускаемый объектом произвольного класса, может быть связан с закрытым (private) слотом и быть вызван в совершенно постороннем классе.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вы также можете определять виртуальные слоты, что мы находим очень полезным на практике.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">По сравнению с обратными вызовами, сигналы и слоты немного медленнее в связи с большей гибкостью, которую они предоставляют, но для реальных приложений это различие несущественно. Вообще, испускание сигнала, связанного с некоторыми слотами, примерно в десять раз медленнее, чем вызов невиртуальной функции приемника непосредственно. Так происходит, потому что требуется безопасно перебрать все соединения (т.е. проверить, чтобы последующие приемники не были разрушены во время испускания сигнала) и передать параметры положенным образом. Хотя &quot;десять вызовов невиртуальных функций&quot; кажется долгим, это меньше чем, например, операция <span style=" font-family:'Courier New,courier';">new</span> или <span style=" font-family:'Courier New,courier';">delete</span>. Если вы обрабатываете строку, вектор или список, то есть операции, которые требуют вызова <span style=" font-family:'Courier New,courier';">new</span> или <span style=" font-family:'Courier New,courier';">delete</span>, обработка сигналов и слотов становятся не самыми активными потребителями времени.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">То же самое происходит, когда система вызывает слот или косвенно вызываются более десятка функций. На i586-500 вы можете генерировать около 2,000,000 сигналов, связанных с одним слотом, в секунду, или около 1,200,000 сигналов, связанных с двумя слотами, в секунду. Простой и гибкий механизм сигналов и слотов является хорошей оболочкой для внутренней реализации, которую пользователи даже не будут замечать.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обратите внимание на то, что другие библиотеки, определяющие переменные с именем <span style=" font-family:'Courier New,courier';">signals</span> или <span style=" font-family:'Courier New,courier';">slots</span>, могут вызвать предупреждения и ошибки при компиляции с приложением, созданным на основе Qt. Решить эту проблему может директива препроцессора <span style=" font-family:'Courier New,courier';">#undef</span>.<a name="meta-object-information"></a> </p>
<p style="-qt-paragraph-type:empty; margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Мета-объектная информация</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Мета-объектный компилятор (<span style=" font-family:'Courier New'; color:#6a1009;">moc</span>) просматривает декларацию класса в файле C++ и генерирует код, инициализирующий мета-объект. Мета-объект содержит имена всех сигналов и слотов и указатели на их функции.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Мета-объект содержит дополнительную информацию, такую как <span style=" font-weight:600; color:#000000;">имя класса</span> объекта. Также вы можете проверить, является ли объект <span style=" font-weight:600; color:#000000;">наследником</span> определённого класса, например:</p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     if (widget-&gt;inherits(&quot;QAbstractButton&quot;)) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">         QAbstractButton *button = static_cast&lt;QAbstractButton *&gt;(widget);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">         button-&gt;toggle();</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     }</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Информация мета-объекта также используется в qobject_cast&lt;T&gt;(), который подобен <span style=" font-family:'Courier New'; color:#6a1009;">QObject::inherits()</span>, но менее подвержен ошибкам:</p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     if (QAbstractButton *button = qobject_cast&lt;QAbstractButton *&gt;(widget))</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">         button-&gt;toggle();</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для получения более подробной информации смотрите <span style=" font-weight:600; color:#000000;">Систему мета-объектов</span>.<a name="a-real-example"></a> </p>
<p style="-qt-paragraph-type:empty; margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Реальный пример</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Далее приведен простой пример виджета.</p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> #ifndef LCDNUMBER_H</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> #define LCDNUMBER_H</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> #include &lt;QFrame&gt;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> class LcdNumber : public QFrame</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> {</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     Q_OBJECT</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a1009;">LcdNumber</span> наследует <span style=" font-family:'Courier New'; color:#6a1009;">QObject</span>, который использует сигналы и слоты через <span style=" font-family:'Courier New'; color:#6a1009;">QFrame</span> и <span style=" font-family:'Courier New'; color:#6a1009;">QWidget</span>. Он немного похож на встроенный виджет <span style=" font-family:'Courier New'; color:#6a1009;">QLCDNumber</span>.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">При расширении препроцессором, макрос <span style=" font-family:'Courier New'; color:#6a1009;">Q_OBJECT</span> декларирует несколько функций-членов, которые реализуются <span style=" font-family:'Courier New'; color:#6a1009;">moc</span>; если вы получили сообщения об ошибках компилятора, подобные <span style=" font-family:'Courier New'; color:#6a1009;">&quot;undefined reference to vtable for LcdNumber&quot;</span>, вы, вероятно, забыли <span style=" color:#000000;">запустить </span><span style=" font-family:'Courier New'; color:#6a1009;">moc</span> или включить вывод moc в команду link.</p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> public:</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     LcdNumber(QWidget *parent = 0);</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a1009;">moc</span> явно не требует этого, но если вы наследуете <span style=" font-family:'Courier New'; color:#6a1009;">QWidget</span>, почти наверняка захотите иметь аргумент <span style=" font-family:'Courier New'; color:#6a1009;">parent</span> в вашем конструкторе и передать его в конструктор базового класса.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Некоторые деструкторы и функции-члены здесь опущены; <span style=" font-family:'Courier New'; color:#6a1009;">moc</span> игнорирует их.</p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> signals:</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     void overflow();</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a1009;">LcdNumber</span> испускает сигнал, когда его просят показать неверное значение.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если вы не заботитесь о том, выходит ли значение за установленные пределы, или считаете, что оно не может за них выйти, можете игнорировать сигнал <span style=" font-family:'Courier New'; color:#6a1009;">overflow()</span>, т.е. не соединять с ним ни какой слот.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если вы, напротив, хотите вызвать две функции при выходе значения за пределы диапазона, соедините сигнал с двумя слотами. Qt вызовет их оба (в произвольном порядке).</p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> public slots:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     void display(int num);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     void display(double num);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     void display(const QString &amp;str);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     void setHexMode();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     void setDecMode();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     void setOctMode();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     void setBinMode();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">     void setSmallDecimalPoint(bool point);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> };</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> #endif</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Слот обычно используется для получения информации об изменении состояния других виджетов. <span style=" font-family:'Courier New'; color:#6a1009;">LcdNumber</span> использует эту возможность, код, приведенный выше, показывает, как отобразить измененное значение. Так как <span style=" font-family:'Courier New'; color:#6a1009;">display()</span> является частью интерфейса между классом и остальной частью программы, то он является открытым (public) слотом.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В некоторых из примеров программ сигнал <span style=" font-family:'Courier New'; color:#6a1009;">valueChanged()</span> объекта <span style=" font-family:'Courier New'; color:#6a1009;">QScrollBar</span> соединяется со слотом <span style=" font-family:'Courier New'; color:#6a1009;">display()</span>, в результате LCD-номер непрерывно отображает значение полосы прокрутки.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обратите внимание на то, что <span style=" font-family:'Courier New'; color:#6a1009;">display()</span> перегружена; Qt выберет соответствующую версию во время соединения сигнала со слотом. При использовании обратных вызовов вы должны были бы завести пять различных названий и отслеживать используемые типы самостоятельно.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Некоторые несущественные функции-члены в данном примере были опущены.</p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:10pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:xx-large; font-weight:600;">Генерация HTTP запросов</span> </p>
<p align="right" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Антон Калмыков (Antonio)<br /><a href="http://r.codenet.ru/?http://detail.phpclub.net/"><span style=" text-decoration: underline; color:#0000ff;">http://detail.phpclub.net/</span></a>, 2001-03-26 </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В последнее время я все более часто наблюдаю в основном форуме РНРClub вопросы на тему создания POST и GET запросов, а так же вопросы на тему: "Как мне посредством функции header сформировать POST запрос". Я считаю, что уже давно назрела необходимость расставить точки над "и" в использовании данной технологии, поскольку начинающие программисты просто не понимают принципов работы веба, как такового. Итак, начнем наше путешествие по миру протокола HTTP. </p>
<ul style="-qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1. <a href="http://www.codenet.ru/webmast/php/HTTP-POST.php#part_1"><span style=" text-decoration: underline; color:#0000ff;">Протокол HTTP. Введение</span></a> </li>
<ul type="circle" style="-qt-list-indent: 2;"><li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1.1 <a href="http://www.codenet.ru/webmast/php/HTTP-POST.php#part_1_1"><span style=" text-decoration: underline; color:#0000ff;">Клиент и сервер</span></a> </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1.2 <a href="http://www.codenet.ru/webmast/php/HTTP-POST.php#part_1_2"><span style=" text-decoration: underline; color:#0000ff;">Пишем наш первый HTTP запрос</span></a> </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1.3 <a href="http://www.codenet.ru/webmast/php/HTTP-POST.php#part_1_3"><span style=" text-decoration: underline; color:#0000ff;">Структура запроса</span></a> </li></ul>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">2. <a href="http://www.codenet.ru/webmast/php/HTTP-POST.php#part_2"><span style=" text-decoration: underline; color:#0000ff;">Метод GET</span></a> </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">3. <a href="http://www.codenet.ru/webmast/php/HTTP-POST.php#part_3"><span style=" text-decoration: underline; color:#0000ff;">Метод POST</span></a> </li>
<ul type="circle" style="-qt-list-indent: 2;"><li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">3.1 <a href="http://www.codenet.ru/webmast/php/HTTP-POST.php#part_3_1"><span style=" text-decoration: underline; color:#0000ff;">Content-Type: application/x-www-form-urlencoded</span></a> </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">3.2 <a href="http://www.codenet.ru/webmast/php/HTTP-POST.php#part_3_2"><span style=" text-decoration: underline; color:#0000ff;">Content-Type: multipart/form-data</span></a> </li></ul>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">4. <a href="http://www.codenet.ru/webmast/php/HTTP-POST.php#part_4"><span style=" text-decoration: underline; color:#0000ff;">Постскриптум</span></a> </li></ul>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">1. Протокол HTTP. Введение</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Сразу хочу уточнить одну маленькую вещь. Страшное слово протокол есть не что иное, как соглашение множества людей, просто в один прекрасный момент люди решили: "Давайте будем делать так, и тогда все будет в порядке". Бояться нечего, все просто до безобразия и это безобразие мы сейчас будем вскрывать. Итак, что же это такое протокол HTTP и с чем его едят? </p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">1.1 Клиент и сервер</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Чудес в мире, а тем более в мире программизма и интернета не бывает! Усвойте это как незыблемую истину. И, если программа не работает или работает не так как хочется, то, значит, скорее всего, она либо написана не правильно, либо содержит ошибки. Итак, как же все-таки браузер просит сервер прислать ему хоть что-нибудь? Да очень просто! Надо только немного расслабиться и начать получать удовольствие от процесса :-) </p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">1.2. Пишем наш первый HTTP запрос</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если Вы думаете, что все слишком сложно, то Вы ошибаетесь. Человек так устроен, что просто не способен создавать что-то сложное, иначе он сам в этом запутается :-) Итак, есть браузер и есть Web-сервер. Инициатором обмена данными всегда выступает браузер. Web-сервер никому, никогда просто так ничего не пошлет, чтобы он что-нибудь отправил браузеру — надо, чтобы браузер об этом попросил. Простейший HTTP запрос моет выглядеть, например, так: </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">GET http://www.php.net/ HTTP/1.0\r\n\r\n </p>
<ul style="-qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:60px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">GET (В переводе с английского означает "получить") — тип запроса, тип запроса может быть разным, например POST, HEAD, PUT, DELETE (часть из них мы рассмотрим ниже). </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:60px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">http://www.php.net/ — URI (адрес) от которого мы хотим получить хоть какую-нибудь информацию (естественно мы надеемся подучить HTML страницу). </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:60px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">HTTP/1.0 — тип и версия протокола, который мы будем использовать в процессе общения с сервером. </li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:60px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">\r\n — конец строки, который необходимо повторить два раза, зачем, станет понятно немного позднее. </li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вы можете выполнить данный запрос очень просто. Запустите программу telnet.exe, введите в качестве хоста www.php.net, укажите порт 80, и просто наберите данный запрос, нажав два раза Enter в качестве \r\n\r\n. В ответ вы получите HTML код главной страницы сайта www.php.net.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="part_1_3"></a><span style=" font-size:x-large; font-weight:600;">1</span><span style=" font-size:x-large; font-weight:600;">.3 Структура запроса</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Рассмотрим, из чего состоит HTTP запрос. Все достаточно просто. Начнем с того, что HTTP запрос — это вполне осмысленный текст. Из чего же он состоит в общем случае? Будем рассматривать протокол HTTP 1.0. Итак: </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Request-Line <span style=" font-weight:600;">[ General-Header | Request-Header | Entity-Header ]\r\n[ Entity-Body ]</span> </p>
<ul style="-qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:60px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Request-Line</span> — строка запроса<br /></li>
<li style=" margin-top:12px; margin-bottom:12px; margin-left:60px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Формат: "Method Request-URI HTTP-Version\r\n" </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:60px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Method</span> — метод, которым будет обрабатываться ресурс Request-URI, может быть GET, POST, PUT, DELETE или HEAD. </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:60px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Request-URI</span> — относительная или абсолютная ссылка на страницу с набором параметров, например, /index.html или http://www.myhost.ru/index.html или /index.html?a=1&amp;b=qq. В последнем случае серверу будет передан запрос с набором переменных a и b с соответствующими значениями, а знак "&amp;" — амперсант служит разделителем между параметрами. </li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:60px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">HTTP-Version</span> — версия HTTP протокола, в нашем случае "HTTP/1.0". </li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Нам крайне интересны методы обработки GET и POST. Методом GET можно просто передать параметры в скрипт, а методом POST можно эмулировать submit формы. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для метода GET, Request-URI может выглядеть, например, так: <span style=" font-weight:600;">"/index.html?param1=1&amp;param2=2".</span> </p>
<ul style="-qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:60px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">General-Header</span> — главная часть заголовка. <br />Формат: [Date: value\n | Pragma: no-cache\n] <br />Может иметь только два параметра: Date или Pragma. Date — дата по Гринвичу в формате "День недели, Число Месяц Год ЧЧ:ММ:СС GMT", например, "Tue, 15 Nov 1994 08:12:31 GMT" — дата создания запроса. Pragma может иметь одно значение no-cache, которое запрещает кэширование страницы. <br /><br /></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:60px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Request-Header</span> — часть заголовка, описывающая запрос.<br /><br />Request-Header может иметь следующие параметры: <span style=" font-weight:600;">Allow, Authorization, From, If-Modified-Since, Referer, User-Agent</span>. <br />В данной главе мы не будем рассматривать параметр Autorization, так как он используется для доступа к закрытым ресурсам, что требуется не так уж часто. Вы можете самостоятельно изучить формирование заголовка для авторизованного доступа на сайте www.w3c.org. <br /><br /></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:60px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Allow</span> — задает допустимые методы обработки. <br />Формат: "Allow: GET | HEAD\n". <br />Параметр игнорируется при указании метода обработки POST в Request-Line. Задает допустимые методы обработки запроса. Прокси сервера не модифицируют параметр Allow и он в неизменном виде доходит до сервера. <br /><br /></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:60px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">From</span> — e-mail адрес, пославшего запрос. <br />Формат: "From: adderss\r\n". <br />Например, "From: myname@mailserver.ru\r\n". <br /><br /></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:60px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">If-Modified-Since</span> — указывает, что запрос не модифицировался с такого-то времени. <br />Формат: "If-Modified-Since: date\r\n" <br />Используется только для метода обработки GET. Дата указывается по Гринвичу в таком же формате, как и для параметра Date в General-Header. <br /><br /></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:60px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Referer</span> — абсолютная ссылка на страницу, с которой произошла инициация запроса, т. е. ссылка на страницу, с которой пользователь перешел на нашу. <br />Формат: "Referer: url\n". <br />Пример: "Referer: www.host.ru/index.html\n". </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:60px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">User-Agent</span> — тип браузера. <br />Например: "User-Agent: Mozilla/4.0\n" <br /><br /></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:60px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Entity-Header</span> — часть заголовка, описывающая данные Entity-Body. <br />В данной части запроса задаются параметры, которые описывают тело страницы. Entity-Header может содержать следующие параметры: <span style=" font-weight:600;">Allow, Content-Encoding, Content-Length, Content-Type, Expires, Last-Modified, extension-header</span>. <br /><br /></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:60px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Allow</span> — параметр аналогичный Allow из General-Header. <br /><br /></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:60px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Content-Encoding</span> — тип кодирования данных Entity-Body. <br />Формат: "Сontent-Encoding: x-gzip | x-compress | другой тип\n". <br />Пример: "Сontent-Encoding: x-gzip\n". Символ "|" означает слово "или", то есть то или то или то и.т.д. <br />Другой тип может указывать на способ кодирования данных, например, для метода POST: "Сontent-Encoding: application/x-www-form-urlencoded\n". <br /><br /></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:60px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Content-Length</span> — количество байт, пересылаемых в Entity-Body. Значение Content-Length имеет совсем другой смысл для данных, пересылаемых в формате MIME, где он выступает как параметр описания части данных — "external/entity-body". Допустимыми являются целые числа от нуля и больше. <br />Пример: "Content-Length: 26457\n". <br /><br /></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:60px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Content-Type</span> — тип передаваемых данных. <br />Например: "Content-Type: text/html\n". <br /><br /></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:60px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Expires</span> — Время, когда страница должна быть удалена из кэша браузера. <br />Формат: "Expires: date\n". Формат даты алогичен формату даты для параметра Date из General-Header. <br /><br /></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:60px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Last-Modified</span> — время последнего изменения пересылаемых данных. <br />Формат: "Last-Modified: date\n". Формат даты алогичен формату даты для параметра Date из General-Header. <br /><br /></li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:60px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Extention-header</span> — часть заголовка, которая может предназначаться, например, для обработки браузером, или другой программой, которая принимает документ. В данной части можно описывать свои параметры в формате "ParameterName: parametervalue\n". Данные параметры будут игнорироваться, если программа-клиент не знает, как их обработать. <br />Например: "Cookie: r=1\r\n" — устанавливает всем известные печеньки для страницы. </li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">А теперь после таких страшных слов давайте попробуем немного успокоиться и понять, что же нам надо? Понимать мы естественно будем на примерах. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Давайте представим, что нам надо получить страницу с сайта, передав Cookies (Печеньки), иначе нас просто пошлют как незванных гостей, и более того, известно, что на данную страницу пускают только после того, как Вы побывали на главной странице сайта. </p>
<p style="-qt-paragraph-type:empty; margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">2 Метод GET</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Напишем наш запрос. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">GET http://www.site.ru/news.html HTTP/1.0\r\n<br />Host: www.site.ru\r\n<br />Referer: http://www.site.ru/index.html\r\n<br />Cookie: income=1\r\n<br />\r\n </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Данный запрос говорит нам о том, что мы хотим получить содержимое страницы по адресу http://www.site.ru/news.html, использую метод GET. Поле Host говорит о том, что данная страница находится на сервере www.site.ru, поле Referer говорит о том, что за новостями мы пришли с главной страницы сайта, а поле Cookie говорит о том, что нам была присвоена такая-то кука. Почему так важны поля Host, Referer и Сookie? Потому что нормальные программисты при создании динамических сайтов проверяют данные поля, которые появляются в скриптах (РНР в том числе) в виде переменных. Для чего это надо? Для того, например, чтобы сайт не грабили, т.е. не натравливали на него программу для автоматического скачивания, или для того, чтобы зашедший на сайт человек всегда попадал бы на него только с главной страницы и.т.д. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Теперь давайте представим, что нам надо заполнить поля формы на странице и отправить запрос из формы, пусть в данной форме будет два поля: login и password (логин и пароль),- и, мы естественно знаем логин и пароль. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />GET http://www.site.ru/news.html?login=Petya%20Vasechkin&amp;password=qq HTTP/1.0\r\n<br />Host: www.site.ru\r\n<br />Referer: http://www.site.ru/index.html\r\n<br />Cookie: income=1\r\n<br />\r\n<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Логин у нас "Petya Vasechkin" Почему же мы должны писать Petya%20Vasechkin? Это из=за того, что специальные символы могут быть распознаны сервером, как признаки наличия нового параметра или конца запроса и.т.д. Поэтому существует алгоритм кодирования имен параметров и их значений, во избежание оштбочных ситуаций в запросе. Полное описание данного алгоритма можно найти <a href="http://r.codenet.ru/?http://teor.ysn.ru/CIE/RFC/1522/?M=A"><span style=" text-decoration: underline; color:#0000ff;">здесь</span></a>, а в PHP есть функции rawurlencode и rawurldecode для кодирования и декодирования соответственно. Хочу отметеить, что декодирование РНР делает сам, если в запросе были переданы закодированные параметры. На этом я закону первую главу знакомства c протоколом HTTP. В следуючей главе мы рассмотрим построение запросов типа POST (в переводе с английского — "отправить"), что будет гораздо интереснее, т.к. именно данный тип запросов используется при отправке данных из HTML форм. </p>
<p style="-qt-paragraph-type:empty; margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">3. Метод POST.</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В случае HTTP запроса типа POST существует два варианта передачи полей из HTML форм, а именно, используя алгоритм application/x-www-form-urlencoded и multipart/form-data. Различия между данными алгоритмами весьма существенные. Дело в том, что алгоритм первого типа создавался давным-давно, когда в языке HTML еще не предусматривали возможность передачи файлов через HTML формы. Итак, давайте рассмотрим эти алгоритмы на примерах. </p>
<p style="-qt-paragraph-type:empty; margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">3.1 Content-Type: application/x-www-form-urlencoded.</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Пишем запрос, аналогичный нашему запросу GET для передачи логина и пароля, который был рассмотрен в предыдущей главе: </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />POST http://www.site.ru/news.html HTTP/1.0\r\n <br />Host: www.site.ru\r\n <br />Referer: http://www.site.ru/index.html\r\n <br />Cookie: income=1\r\n <br />Content-Type: application/x-www-form-urlencoded\r\n<br />Content-Length: 35\r\n<br />\r\n<br />login=Petya%20Vasechkin&amp;password=qq<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Здесь мы видим пример использования Content-Type и Content-Length полей заголовка. Content-Length говорит, сколько байт будет занимать область данных, которая отделяется от заголовка еще одним переводом строки \r\n. А вот параметры, которые раньше для запроса GET помещались в Request-URI, теперь находятся в Entity-Body. Видно, что они формируются точно также, просто надо написать их после заголовка. Хочу отметить еще один важный момент, ничто не мешает, одновременно с набором параметров в Entity-Body, помещать параметры с другими именами в Request-URI, например: </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />POST http://www.site.ru/news.html?type=user HTTP/1.0\r\n <br />.....<br />\r\n<br />login=Petya%20Vasechkin&amp;password=qq<br /></p>
<p style="-qt-paragraph-type:empty; margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">3.2 Content-Type: multipart/form-data</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Как только интернет мир понял, что неплохо бы было через формы отсылать еще и файлы, так W3C консорциум взялся за доработку формата POST запроса. К тому времени уже достаточно широко применялся формат MIME (Multipurpose Internet Mail Extensions — многоцелевые расширения протокола для формирования Mail сообщений), поэтому, чтобы не изобретать велосипед заново, решили использовать часть данного формата формирования сообщений для создания POST запросов в протоколе HTTP. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Каковы же основные отличия этого формата от типа application/x-www-form-urlencoded? </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Главное отличие в том, что Entity-Body теперь можно поделить на разделы, которые разделяются границами (boundary). Что самое интересное — каждый раздел может иметь свой собственный заголовок для описания данных, которые в нем хранятся, т.е. в одном запросе можно передавать данные различных типов (как в Mail письме Вы одновременно с текстом можете передавать файлы). </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Итак, приступим. Рассмотрим опять все тот же пример с передачей логина и пароля, но теперь в новом формате. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />POST http://www.site.ru/news.html HTTP/1.0\r\n <br />Host: www.site.ru\r\n <br />Referer: http://www.site.ru/index.html\r\n <br />Cookie: income=1\r\n <br />Content-Type: multipart/form-data; boundary=1BEF0A57BE110FD467A\r\n<br />Content-Length: 209\r\n<br />\r\n<br />--1BEF0A57BE110FD467A<span style=" font-weight:600;">\r\n</span><br />Content-Disposition: form-data; name="login"<span style=" font-weight:600;">\r\n</span><br /><span style=" font-weight:600;">\r\n</span><br />Petya Vasechkin<span style=" font-weight:600;">\r\n</span><br />--1BEF0A57BE110FD467A<span style=" font-weight:600;">\r\n</span><br />Content-Disposition: form-data; name="password"<span style=" font-weight:600;">\r\n</span><br /><span style=" font-weight:600;">\r\n</span><br />qq<span style=" font-weight:600;">\r\n</span><br />--1BEF0A57BE110FD467A--<span style=" font-weight:600;">\r\n</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Теперь давайте разбираться в том что написано. :-) Я специально выделил некоторые символы \r\n жирным, чтобы они не сливались с данными. Присмотревшись внимательно можно заметить поле boundary после Content-Type. Это поле задает разделитель разделов — границу. В качестве границы может быть использована строка, состоящая из латинских букв и цифр, а так же из еще некоторых символов (к сожалению, не помню каких еще). В теле запроса в начало границы добавляется '--', а заканчивается запрос — границей, к которой символы '--' добавляются еще и в конец. В нашем запросе два раздела, первый описывает поле login, а второй поле password. Content-Disposition (тип данных в разделе) говорит, что это будут данные из формы, а в поле name задается имя поля. На этом заголовок раздела заканчивается и далее следует область данных раздела, в котором помещается значение поля (кодировать значение не требуется!). </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Хочу обратить Ваше внимание та то, что в заголовках разделов не надо использовать Content-Length, а вот в заголовке запроса надо и его значение является размером всего Entity-Body, стоящего после второго \r\n, следующего за Content-Length: 209\r\n. Т.е. Entity-Body отделяется от заголовка дополнительным переводом строки (что можно заметить и в разделах). </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">А теперь давайте напишем запрос для передачи файла. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">POST http://www.site.ru/postnews.html HTTP/1.0\r\n <br />Host: www.site.ru\r\n <br />Referer: http://www.site.ru/news.html\r\n <br />Cookie: income=1\r\n <br />Content-Type: multipart/form-data; boundary=1BEF0A57BE110FD467A\r\n<br />Content-Length: 491\r\n<br />\r\n<br />--1BEF0A57BE110FD467A</span><span style=" font-family:'Courier New'; font-weight:600;">\r\n</span><span style=" font-family:'Courier New';"><br />Content-Disposition: form-data; name="news_header"</span><span style=" font-family:'Courier New'; font-weight:600;">\r\n</span><span style=" font-family:'Courier New';"><br /></span><span style=" font-family:'Courier New'; font-weight:600;">\r\n</span><span style=" font-family:'Courier New';"><br />Пример новости</span><span style=" font-family:'Courier New'; font-weight:600;">\r\n</span><span style=" font-family:'Courier New';"><br />--1BEF0A57BE110FD467A</span><span style=" font-family:'Courier New'; font-weight:600;">\r\n</span><span style=" font-family:'Courier New';"><br />Content-Disposition: form-data; name="news_file"; filename="news.txt"</span><span style=" font-family:'Courier New'; font-weight:600;">\r\n</span><span style=" font-family:'Courier New';"><br />Content-Type: application/octet-stream</span><span style=" font-family:'Courier New'; font-weight:600;">\r\n</span><span style=" font-family:'Courier New';"><br />Content-Transfer-Encoding: binary</span><span style=" font-family:'Courier New'; font-weight:600;">\r\n</span><span style=" font-family:'Courier New';"><br /></span><span style=" font-family:'Courier New'; font-weight:600;">\r\n</span><span style=" font-family:'Courier New';"><br />А вот такая новость, которая лежит в файле news.txt</span><span style=" font-family:'Courier New'; font-weight:600;">\r\n</span><span style=" font-family:'Courier New';"><br />--1BEF0A57BE110FD467A--</span><span style=" font-family:'Courier New'; font-weight:600;">\r\n</span><span style=" font-family:'Courier New';"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В данном примере в первом разделе пересылается заголовок новости, а во втором разделе пересылается файл news.txt. Внимательный да увидит поля filename и Content-Type во втором разделе. Поле filename задает имя пересылаемого файла, а поле Content-Type — тип данного файла. Application/octet-stream говорит о том, что это стандартный поток данных, а Content-Transfer-Encoding: binary говорит на о том, что это бинарные данные, ничем не закодированные. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Очень важный момент. Большинство CGI скриптов написано умными людьми, поэтому они любят проверять тип пришедшего файла, который стоит в Content-Type. Зачем? Чаще всего закачка файлов на сайтах используется для получения картинок от посетителя. Так вот, браузер сам пытается определить что за файл посетитель хочет отправить и вставляет соответствующий Content-Type в запрос. Скрипт его проверяет при получении, и, например, если это не gif или не jpeg игнорирует данный файл. Поэтому при "ручном" формировании запроса позаботьтесь о значении Content-Type, чтобы оно было наиболее близким к формату передаваемого файла. </p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p>
<table border="1" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" align="center" cellspacing="0" cellpadding="3">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">image/gif</p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">для gif</p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">image/jpeg</p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">для jpeg</p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">image/png</p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">для png</p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">image/tiff</p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">для tiff (что используется крайне редко, уж больно емкий формат)</p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В нашем примере формируется запрос, в котором передается текстовый файл. Точно так же формируется запрос для передачи бинарного файла. </p>
<p style="-qt-paragraph-type:empty; margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">4. Постскриптум.</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Думаю, что о передаче запросов на сервер не стоит рассказывать подробно. Это уже дело чисто РНР техники :-). Достаточно внимательно прочитать раздел о функциях работы с сокетами, или о функциях модуля CURL в официальной документации РНР. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Из выше сказанного, надеюсь теперь понятно, почему вопрос: "Как мне сформировать POST запрос, используя функцию header?" — бессмысленен. Функция header(string) добавляет запись только в заголовок запроса, но никак не в тело запроса. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Есть еще один тип запросов — Content-Type: multipart/mixed, надеюсь после прочтения данной статьи Вы легко разберетесь с данным типом сами. Подробно изучить его можно <a href="http://r.codenet.ru/?http://www.w3.org/TR/REC-html40/interact/forms.html#form-content-type"><span style=" text-decoration: underline; color:#0000ff;">Здесь</span></a> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">О запросах других типов можно прочитать в официальной спецификации протокола HTTP 1.0 <a href="http://www.codenet.ru/webmast/http/rfc2068/"><span style=" text-decoration: underline; color:#0000ff;">здесь</span></a>.</p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p></body></html>
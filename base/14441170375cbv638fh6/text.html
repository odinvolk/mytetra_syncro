<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:10pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:xx-large; font-weight:600;">Миф №8: 32-х разрядная операционная система не может использовать все </span><span style=" font-family:'Courier New,courier'; font-size:xx-large; font-weight:600;">4</span><span style=" font-size:xx-large; font-weight:600;"> Гб оперативной памяти</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Максимальный для <span style=" font-family:'Courier New,courier';">32</span>-разрядных систем объем памяти – это <span style=" font-family:'Courier New,courier';">128</span> Гб, как указано в спецификации на Windows Server 2003 Datacenter Edition. <br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;">Такое ограничение связано с тем, что в более мощных системах структуры, применяемые диспетчером памяти для отслеживания физической памяти, потребляли бы слишком большую часть пространства виртуальных адресов. Диспетчер памяти отслеживает страницы памяти при помощи массива, называемого базой данных PFN, и в целях оптимизации производительности отображает все содержимое этой базы в виртуальную память. Так как каждая страница памяти представлена структурой данных объемом <span style=" font-family:'Courier New,courier';">28</span> байт, в системе с физической памятью емкостью <span style=" font-family:'Courier New,courier';">128</span> Гб для размещения базы данных PFN потребуется <span style=" font-family:'Courier New,courier';">930</span> Мб. В <span style=" font-family:'Courier New,courier';">32</span>-разрядных ОС Windows предусмотрено пространство виртуальных адресов объемом <span style=" font-family:'Courier New,courier';">4</span> Гб, зависящее от оборудования и по умолчанию распределяемое между текущим процессом пользовательского режима (например, блокнотом) и системой. В таких условиях база данных PFN объемом <span style=" font-family:'Courier New,courier';">980</span> Мб занимает почти половину из доступных <span style=" font-family:'Courier New,courier';">2</span> Гб системной части пространства виртуальных адресов, а значит, на отображение ядра, драйверов устройств, системного кэша и других структур данных системы остается всего <span style=" font-family:'Courier New,courier';">1</span> Гб:<br /><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><img src="image26815.png" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />По той же причине в таблице ограничений объема памяти указаны пониженные лимиты при загрузке в режиме <span style=" font-family:'Courier New,courier';">/3GB</span>. Дело в том, что для этого режима характерна такая схема разделения физической памяти, при которой процессам пользовательского режима достается <span style=" font-family:'Courier New,courier';">3</span> Гб, а системе – всего <span style=" font-family:'Courier New,courier';">1</span> Гб. В целях повышения производительности в ОС Windows Server 2008 для системных нужд резервируется более значимая доля адресного пространства. Для этого максимальный объем физической памяти, поддерживаемый в <span style=" font-family:'Courier New,courier';">32</span>-разрядных версиях ОС, сокращается до <span style=" font-family:'Courier New,courier';">64</span> Гб.</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Но разрушители легенд не были бы разрушителями легенд, если бы они верили на слово. Поэтому они должны это проверить.<br /><br />Берём виртуальную машину, устанавливаем ей количество ОЗУ в <span style=" font-family:'Courier New,courier';">4</span> Гб и запускаем. Что же мы видим?<br /><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image22329.png" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Что-то не очень похоже на обещанные <span style=" font-family:'Courier New,courier';">128</span> Гб. В чём же дело?<br /><br />Дело в том, что ограничение в <span style=" font-family:'Courier New,courier';">128</span> Гб - это ограничение <span style=" font-weight:600; font-style:italic;">серверных</span> ОС. <span style=" font-weight:600; font-style:italic;">Клиентские</span> ОС (а Windows XP и Windows 7 - это <span style=" font-style:italic;">клиентские</span> ОС) имеют ограничения в <span style=" font-family:'Courier New,courier';">4</span> Гб.<br /><br />Ну, это ничего не объясняет. Во-первых, почему такая разница? Это маркетинговый ход? Во-вторых: где же наши обещанные <span style=" font-family:'Courier New,courier';">4</span> Гб? Мы видим всего <span style=" font-family:'Courier New,courier';">3.5</span> Гб.<br /><br />Во-первых, в ходе тестирования Windows выяснилось, что если разрешить использование памяти более 4 Гб, то многие системы аварийно завершают работу, зависают и отказываются загружаться. Происходит это из-за того, что некоторые драйверы устройств (в особенности аудио- и видеоустройств) запрограммированы на работу с физическими адресами в пределах <span style=" font-family:'Courier New,courier';">4</span> Гб. Эти драйверы, оказывается, обрубают адреса свыше <span style=" font-family:'Courier New,courier';">4</span> Гб, что приводит к повреждению содержимого памяти со всеми вытекающими последствиями. В серверных же системах, которые, как правило, оснащаются менее специфичными устройствами с относительно простыми и надежными драйверами, подобные проблемы обнаружены не были. Выявленные недостатки экосистемы драйверов заставили применительно к клиентским версиям ОС отказаться от работы с памятью в объеме свыше <span style=" font-family:'Courier New,courier';">4</span> Гб, несмотря на то, что теоретически её адресация возможна (обращаю внимание, что речь идёт о физической памяти, а не о виртуальном адресном пространстве, которое даже теоретически не может быть больше <span style=" font-family:'Courier New,courier';">4</span> Гб в <span style=" font-family:'Courier New,courier';">32</span>-х разрядной системе).<br /><br />Во-вторых, фактический лимит поддержки объема памяти ниже. Кроме того, он зависит от набора микросхем и характеристик подключенных устройств. Дело в том, что в таблицу физических адресов включается не только оперативная память, но и память устройств. При этом, для совместимости с <span style=" font-family:'Courier New,courier';">32</span>-разрядными операционными системами, которые не способны обрабатывать адреса свыше <span style=" font-family:'Courier New,courier';">4</span> Гб, в системах <span style=" font-family:'Courier New,courier';">x86</span> и <span style=" font-family:'Courier New,courier';">x64</span> память устройств отображается ниже границы адресации <span style=" font-family:'Courier New,courier';">4</span> Гб. Предположим, что в системе установлено <span style=" font-family:'Courier New,courier';">4</span> Гб оперативной памяти, а окна в память сетевых адаптеров, аудио- и видеоустройств в сумме составляют <span style=" font-family:'Courier New,courier';">500</span> Мб, тогда <span style=" font-family:'Courier New,courier';">500</span> Мб из <span style=" font-family:'Courier New,courier';">4</span> Гб оперативной памяти окажутся за границей адресации - и мы получим доступные только <span style=" font-family:'Courier New,courier';">3.5</span> Гб физической памяти.<br /><br />Даже если система оснащена всего <span style=" font-family:'Courier New,courier';">2</span> Гб физической памяти, может случиться так, что часть её окажется недоступной под управлением <span style=" font-family:'Courier New,courier';">32</span>-разрядной версии Windows. Причиной тому – наборы микросхем, практикующие агрессивное резервирование областей памяти для устройств. Хотя такой сценарий, конечно, достаточно редок.<br /><br />Статус мифа: <span style=" font-weight:600; color:#008000;">plausible</span>.<br /><br /></p></body></html>
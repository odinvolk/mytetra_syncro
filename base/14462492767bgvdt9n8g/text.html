<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:10pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14pt; font-weight:600; color:#000000;">Управление Linux с помощью LIRC </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">Журнал «Системный администратор» №1-2 2010 г.</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если вы хотите использовать ваш ПК в качестве медиацентра, хотите смотреть фильмы и слушать музыку не вставая с дивана, вам нужен LIRC!</p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Что такое LIRC?</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">LIRC (Linux Infrared Remote Control) — набор драйверов и программ для ОС Linux, предназначенный для приема сигналов от инфракрасных пультов дистанционного управления (ПДУ), передачи таких сигналов, а также для управления другими программами с этих пультов. LIRC поддерживает большое количество приемников/передатчиков сигнала и почти любой ПДУ.<a name="more-74"></a> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Упрощенная схема работы LIRC изображена на рис.1:</p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1376576644.png" width="289" height="504" /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Рис. 1</p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Сигналы от ПДУ принимаются приемником и с помощью модуля ядра отображаются на виртуальное устройство /dev/lircX. Первый загруженный драйвер использует устройство /dev/lirc0, следующий — /dev/lirc1 и т.д. Эти сигналы декодируются демоном lircd, к которому могут подключаться другие программы через сокет /var/run/lirc/lircd. Программы, входящие в LIRC, такие как irexec, irxevent, а также любые другие, могут читать декодированные сигналы непосредственно из этого сокета а также с помощью библиотеки liblircclient.</p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Простейший приемник</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Тот, кто дружит с паяльником, без труда сможет собрать дешевый приемник ИК-сигналов, подключающийся к последовательному порту компьютера. Схема его изображена на рис.2 </p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image290293804.png" /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Рис. 2</p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Сигналы с ПДУ принимаются датчиком IC1 и поступают на вход DCD последовательного порта. Питание для датчика берется с выхода RTS порта, но поскольку ему нужно напряжение +5В, а на выходах стандартного COM-порта напряжение около 10-12 В, то на элементах IC2, R1, D1 и C1 собран преобразователь напряжения 12В — 5В (для работы IC2 нужно входное напряжение не менее 7В, поэтому на некоторых ноутбуках, где на выходах последовательного порта меньшее напряжение, схема работать не будет). На схеме приведена разводка разъема последовательного порта с 9 выводами, если у вас 25-портовый разъем, то на нем DCD — 8 вывод, GND — 7-й, а RTS — 4-й.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Датчик IC1 — марки TSOP 1738 или аналогичный (полный список можно найти на странице <a href="http://www.lirc.org/receivers.html"><span style=" text-decoration: underline; color:#0000ff;">http://www.lirc.org/receivers.html</span></a>), рис.3 </p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image778494705.png" /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Рис. 3</p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">(Инфракрасный датчик TSOP1738. Выпуклость должна быть обращена к источнику сигналов). Вместо 78L05 (IC2) можно взять советский аналог КР142ЕН5 (левый вывод — вход, правый — выход, средний — заземляем) (рис.4) </p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image251012914.png" /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Рис. 4</p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Диод D1 подойдет любой. </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Я собрал свой приемник навесным монтажом в корпусе старой мыши (рис.5):</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image895631234.png" /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Рис. 5</p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Установка</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для установки LIRC можно использовать два варианта: сборка из исходных текстов или установка из готовых пакетов вашего дистрибутива.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Установка из исходных текстов подробно описана в документации на странице <a href="http://www.lirc.org/install.html"><span style=" text-decoration: underline; color:#0000ff;">http://www.lirc.org/install.html</span></a>. Я же устанавливал LIRC на свой Ubuntu 9.10 из менеджера пакетов. Просто установите lirc и lirc-x со всеми зависимостями. Вы обнаружите у себя необходимые утилиты и демоны, а также документацию в каталоге /usr/share/doc/lirc/html. Драйверов в этих пакетах нет, они включены в стандартное ядро.</p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Настройка LIRC</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Настройка LIRC сводится к ручной правке некоторого количества конфигурационных файлов.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В первую очередь нужно определиться с модулем ядра принимающего устройства. В документации приведена таблица поддерживаемого оборудования (/usr/share/doc/lirc/html/table.html), где можно узнать необходимый вам модуль ядра, драйвер и типы ПДУ, которые данный приемник поддерживает (следует учесть, что некоторые приемники поддерживают любые пульты, а некоторые только те, которые поставляются с ними в комплекте, в таблице они обозначаются «bundled»).</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">К моему настольному компьютеру я подключал самодельный приемник, а на ноутбуке настраивал встроенный инфракрасный порт (IrDA).</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В первом случае нужно использовать модуль ядра lirc_serial:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">oleg@oleg-laptop:~$ sudo modprobe lirc_serial</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">По умолчанию используется первый последовательный порт /dev/ttyS0, но вы можете это изменить, задав явно адрес и прерывание порта:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="0" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1<br /></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">oleg@oleg-laptop:~$ sudo modprobe lirc_serial io=0x2f8 irq=3</p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Все параметры модуля можно посмотреть с помощью команды modinfo:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">oleg@oleg-laptop:~$ modinfo lirc_serial<br />filename: /lib/modules/2.6.31-16-generic/kernel/ubuntu/lirc/lirc_serial/lirc_serial.ko<br />license: GPL<br />author: Ralph Metzler, Trent Piepho, Ben Pfaff, Christoph Bartelmus, Andrei Tanas<br />description: Infra-red receiver driver for serial ports.<br />srcversion: B438F3E79E374F0A09BD6FC<br />depends: lirc_dev<br />vermagic: 2.6.31-16-generic SMP mod_unload modversions 586<br />parm: type:Hardware type (0 = home-brew, 1 = IRdeo, 2 = IRdeo Remote, 3 = AnimaX, 4 = IgorPlug) (int)<br />parm: io:I/O address base (0x3f8 or 0x2f8) (int)<br />parm: irq:Interrupt (4 or 3) (int)<br />parm: share_irq:Share interrupts (0 = off, 1 = on) (bool)<br />parm: sense:Override autodetection of IR receiver circuit (0 = active high, 1 = active low ) (bool)<br />parm: txsense:Sense of transmitter circuit (0 = active high, 1 = active low ) (bool)<br />parm: softcarrier:Software carrier (0 = off, 1 = on) (bool)<br />parm: debug:Enable debugging messages (bool)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Здесь есть важный параметр type, который определяет тип приемника, подключенного к последовательному порту (в нашем случае — 0). Один раз я долго не мог понять, почему не работает прием, пока явно не задал тип приемника.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Иногда модуль не загружается, поскольку последовательный порт уже занят:</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">oleg@oleg-laptop:~$ sudo modprobe lirc_serial<br />FATAL: Error inserting lirc_serial (/lib/modules/2.6.31-16-generic/kernel/ubuntu/lirc/lirc_serial/lirc_serial.ko): Device or resource busy</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В таком случае установите пакет setserial и попробуйте такую команду:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">oleg@oleg-laptop:~$ sudo setserial /dev/ttyS0 uart none</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">После этого модуль должен загрузиться.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Примечание:</span> Если вы используете команду fuser для того, чтобы определить, какой процесс блокирует последовательный порт, у вас ничего не выйдет. Как указано в документации к LIRC, ядро Linux использует для последовательных портов стандартный драйвер в виде модуля или встроенный в ядро. Этот драйвер «захватывает» все порты, которые обнаружит, и поэтому драйверы LIRC (модули ядра) не могут эти порты использовать. Можно загрузить модуль LIRC раньше модуля ядра для стандартного COM-порта, но проблема в том, что обычно стандартный драйвер последовательного порта не компилируется как модуль! Поэтому необходимо использовать setserial, который освобождает захваченный порт.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Однако, эти изменения сохраняются только до перезагрузки компьютера, а вам нужно будет обеспечить запуск setserial при каждой загрузке до запуска LIRC. Обычно это настраивается автоматически при установке пакета setserial, в таком случае в файл /var/lib/setserial/autoserial.conf добавьте строку:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">/dev/ttyS0 uart none</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если автоматическая настройка у вас не прошла, попробуйте другой способ, добавив «setserial /dev/ttyS0 uart none» в файл /etc/init.d/boot.local. Будьте внимательны — в некоторых дистрибутивах скрипт для запуска LIRC /etc/init.d/lirc запускает setserial самостоятельно.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для встроенного инфракрасного порта мне пришлось зайти в BIOS ноутбука и принудительно задать ему режим IrDA и второй последовательный порт (io=0x2f8). После чего загружаем модуль lirc_sir:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">oleg@oleg-laptop:~$ sudo modprobe lirc_sir io=0x2f8</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Проверяем, все ли нормально:</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">oleg@oleg-laptop:~$ lsmod | grep lirc<br />lirc_sir 15268 0<br />lirc_dev 10804 1 lirc_sir</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Как видите, должен автоматически загрузиться и модуль lirc_dev.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если вы передаете модулю параметры, то вам нужно сделать так, чтобы они задавались автоматически. Для этого в каталоге /etc/modprobe.d создайте файл имя_модуля.conf и пропишите в нем необходимые параметры, например /etc/modprobe.d/lirc_serial.conf:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">options lirc_serial io=0x2f8 type=0</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">После этого ваш модуль будет автоматически загружаться с заданными параметрами.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">После того, как модули были успешно загружены, можно проверить работоспособность приемника с помощью программ mode2 или xmode2:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">oleg@oleg-laptop:~$ sudo xmode2 -d /dev/lirc0</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Эти программы читают информацию из устройства, указанного вами, и отображают ее на экране, mode2 — в текстовом, а xmode2 — в графическом виде. У вас должно получиться примерно как на рис.6, это значит, что приемник работает!</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> </p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image562316114.png" /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Рис. 6</p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Теперь нам нужно настроить демон lircd, который занимается декодированием сигналов, поступающих с приемника, в названия нажатых клавиш ПДУ.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для конфигурации lircd используются два файла: /etc/lirc/hardware.conf, который отвечает за настройку приемника, и /etc/lirc/lircd.conf, содержащий профили ПДУ, использующиеся с приемником.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Файл /etc/lirc/hardware.conf простой и достаточно прокомментированный, поэтому настроить его не составит труда, у меня вышел такой файл (для IrDA, встроенного в ноутбук):</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">#Пульт, можно вписать любое название<br />REMOTE=&quot;panasonic&quot;<br />#Список автоматически загружаемых модулей<br />REMOTE_MODULES=&quot;lirc_sir&quot;<br />#Драйвер (см.таблицу /usr/share/doc/lirc/html/table.html)<br />REMOTE_DRIVER=&quot;default&quot;<br />#Устройство, с которого считывать сигнал<br />REMOTE_DEVICE=&quot;/dev/lirc0&quot;<br />REMOTE_SOCKET=&quot;&quot;<br />REMOTE_LIRCD_CONF=&quot;&quot;<br />REMOTE_LIRCD_ARGS=&quot;&quot;<br />#Передатчик<br />TRANSMITTER=&quot;None&quot;<br />TRANSMITTER_MODULES=&quot;&quot;<br />TRANSMITTER_DRIVER=&quot;&quot;<br />TRANSMITTER_DEVICE=&quot;&quot;<br />TRANSMITTER_SOCKET=&quot;&quot;<br />TRANSMITTER_LIRCD_CONF=&quot;&quot;<br />TRANSMITTER_LIRCD_ARGS=&quot;&quot;<br />#Запускать lircd?<br />START_LIRCD=&quot;true&quot;<br />#Автоматически загружать модули<br />LOAD_MODULES=&quot;true&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обязательно нужно задать параметры REMOTE_MODULES, REMOTE_DRIVER, REMOTE_DEVICE.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Файл /etc/lirc/lircd.conf должен соответствовать вашему ПДУ. Несколько готовых файлов устанавливаются вместе с пакетом lirc, также огромная база ПДУ есть на сайте LIRC (<a href="http://www.lirc.org/remotes/"><span style=" text-decoration: underline; color:#0000ff;">http://www.lirc.org/remotes/</span></a>). Возьмите файл с профилем вашего пульта и скопируйте его в файл /etc/lirc/lircd.conf. Если же вашего пульта в базе нет, не отчаивайтесь, вы можете настроить его вручную с помощью команды irrecord:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">oleg@oleg-laptop:~$ sudo irrecord -d /dev/lirc0 lg.conf -n</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вам будет предложено понажимать все клавиши на ПДУ, а затем задать название для каждой клавиши. Если что-то пойдет не так, попробуйте ту же команду с дополнительным параметром -f, который заставит irrecord не дешифровать коды, получаемые с пульта, что может помочь с некоторыми ПДУ. На выходе у вас будет файл, имя которого вы задали, вам останется всего лишь скопировать его в файл /etc/lirc/lircd.conf. Формат этого файла разбирать не будем, скажу лишь, что в нем может находиться описание сразу нескольких пультов, но у них должны быть разные названия.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Все готово, можно запускать демон lircd:</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">oleg@oleg-laptop:~$ sudo service lirc start<br />* Loading LIRC modules [ OK ]<br />* Starting remote control daemon(s) : LIRC [ OK ]</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если что-то пошло не так, еще раз проверьте конфигурационные файлы /etc/lirc/lircd.conf и /etc/lirc/hardware.conf.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если демон запустился, можно проверить его работу программой irw, которая читает из сокета /var/run/lirc/lircd названия нажатых клавиш пульта. Просто запустите программу и попробуйте понажимать клавиши:</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">oleg@oleg-laptop:~$ irw<br />0000bffbf6fffff6 00 stop panas<br />0000bffbf6ff3f36 00 ff panas<br />0000bffbf6ff535a 00 down panas<br />0000bffbf6ff939a 00 vtr/tv panas<br />0000bffbf6fffff6 00 stop panas<br />0000bffbf6fffff6 01 stop panas</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В выводе программы первая колонка — код клавиши из файла /etc/lirc/lircd.conf, вторая — количество повторений нажатия, третья — название клавиши, четвертая — название ПДУ.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Демон lircd настроен.</p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Использование LIRC</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Теперь нам нужно настроить программы, которые будут управляться вами при помощи пульта управления. Есть два типа таких программ: те, которые поддерживают управление через lirc, и те, которые о нем ничего не знают.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Проще всего настроить программы первого типа. Они используют библиотеку liblircclient и файл настройки ~/.lircrc. Этот файл состоит из таких секций:</p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">begin<br />    prog = ...<br />    remote = ...<br />    button = ...<br />    [button = ...]<br />    repeat = ...<br />    delay = ...<br />    config = ...<br />    [config = ...]<br />    mode = ...<br />    flags = ...<br />end</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">prog — имя программы, которая будет реагировать на эту секцию, например mplayer </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">remote — название ПДУ, которым посылается сигнал. Должно соответствовать названию пульта в файле /etc/lirc/lircd.conf. Можно в качестве имени пульта использовать знак звездочки (*), что будет означать любой ПДУ </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">button — название клавиши ПДУ. Должно соответствовать названию клавиши пульта в файле /etc/lirc/lircd.conf. Можно в качестве имени клавиши использовать *, что будет означать любую клавишу ПДУ. Секций button может быть несколько, что будет соответствовать последовательному нажатию нескольких клавиш </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">repeat — задает поведение программы, если клавиша повторяется (длинное нажатие клавиши). При значении 0 повторы клавиши игнорируются. При значении 1 действие выполняется каждый повтор, при 2 — каждый второй повтор и т.д </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">delay — пропустить указанное число повторов клавиши перед тем, как использовать конфигурацию repeat </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">config — строка, которая будет передана программе prog при нажатии соответствующих клавиш. Если задается несколько строк config, то они будут отсылаться программе по очереди, то есть при первом нажатии клавиши передается первая строка, при втором — вторая, при третьем — опять первая и т.д. Для каждой программы существуют свои управляющие строки, которые можно найти в документации к этой программе. </li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">mode — переводит программу в заданный режим. Вы можете группировать секции по режимам, причем эти секции будут выполняться только тогда, когда программа находится в соответствующем режиме:</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">begin mode<br />...<br />end mode</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">flag — флаги. Могут быть такими: </li></ul>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">once — секция выполняется один раз при входе в соответствующий режим mode </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">quit — прекращает обработку файла, дальнейшие секции рассматриваться не будут </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">mode — выйти из текущего режима </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">startup_mode — запустить программу в режиме mode, например:</li></ul>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">begin<br />    flags = startup_mode<br />    mode = browser<br />end</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Файл .lircrc может получиться достаточно объемным, поэтому удобно будет разбить его на части и подключать их при помощи директивы include:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="0" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1<br /></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">include ~/.lirc/xawtv</p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Давайте для примера сконфигурируем проигрыватель mplayer. Список команд для него можно получить, набрав</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">oleg@oleg-laptop:~$ mplayer -input cmdlist</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Запишем такой код в файл .lircrc (допустим, у нас есть пульт с названием ‘panas’):</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">begin<br />    remote = panas<br />    prog = mplayer<br />    button = operate<br />    config = quit<br />end<br />begin<br />    remote = panas<br />    prog = mplayer<br />    button = reset<br />    config = vo_fullscreen<br />end<br />begin<br />    remote = panas<br />    prog = mplayer<br />    button = up<br />    config = volume +10<br />    repeat = 1<br />end<br />begin<br />    remote = panas<br />    prog = mplayer<br />    button = down<br />    config = volume -10<br />    repeat = 1<br />end<br />begin<br />    remote = panas<br />    prog = mplayer<br />    button = pause<br />    config = pause<br />end<br />begin<br />    remote = panas<br />    prog = mplayer<br />    button = ff<br />    config = seek +30 0<br />    repeat = 1<br />end<br />begin<br />    remote = panas<br />    prog = mplayer<br />    button = rew<br />    config = seek -30 0<br />    repeat = 1<br />end</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Как вы видите, в каждой секции задается пульт строкой remote=panas, программа prog=mplayer, кнопка пульта button, и действие config, соответствующее указанной кнопке. Для повторяющихся кнопок, таких как увеличение и уменьшение громкости, обязательно задаем repeat=1, то есть когда мы держим кнопку нажатой, строка config передается в программу постоянно.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;">Примечание: если вы хотите облегчить создание файла конфигурации, попробуйте программу mythbuntu-lirc-generator. Она попытается самостоятельно создать конфигурационные файлы для программ mplayer, elisa, mythtv, totem, vlc, xine, xmame и xmess, используя файл конфигурации вашего ПДУ /etc/lirc/lircd.conf </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Все эти секции распознаются уже работающей программой mplayer, но ее еще нужно запустить. Тут нам на помощь придет программа irexec. Она предназначена для запуска других программ с помощью ПДУ.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Задайте в файле ~/.lircrc секцию для irexec следующим образом:</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">begin<br />    remote = panas<br />    button = vtr/tv<br />    prog = irexec<br />    config = gmplayer &amp;amp;;<br />end</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Далее, следует запустить саму программу irexec в режиме демона:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">oleg@oleg-laptop:~$ irexec -d</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Нам нужно сделать, чтобы она запускалась автоматически при входе в систему, например выбрав «Система — Параметры — Запускаемые приложения» в настройках Gnome и добавив в список запускаемых программ irexec -d.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Теперь при нажатии кнопки vtr/tv пульта panas будет запущен gmplayer.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Касательно программ, которые не поддерживают LIRC напрямую. Если они могут управляться с клавиатуры, то используем программу irxevent, если же нет, то в LIRC есть эмулятор мыши.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Программа irxevent позволяет эмулировать нажатие клавиш клавиатуры или кнопок мыши. Конфигурируется она опять же через файл ~/.lircrc таким образом: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">begin<br />    remote = panas<br />    button = display<br />    prog = irxevent<br />    config = Key F CurrentWindow<br />end</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier 10 Pitch'; color:#6a0e07;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">То есть в данном случае нажатие клавиши F отправляется в текущее окно</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Клавиши можно задавать так:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">[shift-][numlock-][ctrl-][alt-][meta-][mod3-][mod4-][scrlock-]Keyname</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Например: ctrl-c, SHIFT-KP_Subtract и т.д. Названия клавиш берутся из файла /usr/include/X11/keysymdef.h. Кроме того, можно посылать нажатия не только в текущее окно, но и в любое другое, поставив вместо CurrentWindow имя окна или его идентификатор. Их можно узнать с помощью программы xwininfo.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Нажатия кнопок мыши эмулируются так:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">config = Button 1 15 95 Mplayer</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">где 1 — номер кнопки мыши, а 15 и 95 — координаты курсора, в которых производится нажатие.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Опять же, программу irxevent после настройки следует запустить как демон:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">oleg@oleg-laptop:~$ irxevent -d</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Замечу, что irxevent работает не очень надежно, поэтому иногда лучше использовать xdotool. Она позволяет передавать целые строки другим программам, перемещать курсор мыши и даже переключать рабочие столы. Просто установите пакет xdotool и задайте конфигурацию для него через программу irexec: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">begin<br />    remote = panas<br />    button = display<br />    prog = irexec<br />    config = xdotool key ctrl+alt+n<br />end</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Здесь комбинация клавиш посылается в текущее окно. Если вам нужно отправить несколько клавиш в определенное окно, можно использовать xdotool в скриптах. Вот пример из документации, который позволяет вставить в адресную строку firefox содержимое буфера обмена:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">#!/bin/sh<br /># Activate firefox and paste the clipboard contents into the url bar.<br />wid=`xdotool search --title &quot;Mozilla Firefox&quot;`<br />xdotool windowactivate $wid<br />sleep 0.2<br />xdotool key &quot;ctrl+j&quot;<br />xdotool key &quot;BackSpace&quot;<br />xdotool key &quot;ctrl+v&quot;<br />xdotool key &quot;Return&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Ну и в совсем крайнем случае, если программа, которой вы хотите управлять, не поддерживает горячие клавиши, вам придется эмулировать мышь с помощью демона lircmd, для этого нужно будет повозиться, но результат этого стоит.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Сначала сконфигурируем lircd, добавив в файл /etc/hardware.conf строку</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">START_LIRCMD=&quot;true&quot;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Это заставить компьютер запускать lircmd при старте lircd.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Затем нужно составить файл конфигурации /etc/lirc/lircmd.conf для демона lircmd. Он состоит из следующих инструкций:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">PROTOCOL protocol</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выбор протокола мыши. Можно выбирать между MouseSystems, IntelliMouse и IMPS/2. Лучше выбрать IntelliMouse, так как он поддерживает колесо.</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">ACCELERATOR start max multiplier</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обычно курсор мыши передвигается на один пиксел при каждом нажатии кнопки на пульте, но это очень медленно. При использовании этой инструкции если вы будете удерживать кнопку управления курсором, то скорость перемещения будет увеличиваться после того, когда количество повторов достигнет значения start, до значения repeat*multiplier, но не более max.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">ACTIVATE remote button</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">или</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">TOGGLE_ACTIVATE remote button</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Задает кнопку пульта, после нажатия которой включается режим эмуляции мыши. При этом курсор проделает на экране небольшой круг, сигнализируя о включении режима. Если вы используете ACTIVATE, то режим отключается нажатием любой кнопки пульта, которая отсутствует в конфигурационном файле и не задействуется в эмуляции, если же используется TOGGLE_ACTIVATE, то выключение режима производится той же кнопкой, что и включение.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">MOVE_[ N [ E | W ] | E | S [ E | W ] | W ] remote button</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Задает кнопку пульта для перемещения курсора мыши в указанном направлении:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">NW N NE<br />W  X E<br />SW S SE<br />MOVE_[IN|OUT] remote button</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Задает кнопку пульта для вращения колеса мыши вверх и вниз соответственно.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">BUTTONx_CLICK remote button</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Назначает кнопку пульта для нажатия кнопки мыши (x=1 — левая кнопка, x=2 — средняя, x=3 — правая).</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В этом файле использование * вместо названия ПДУ означает выбор любого пульта для управления.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вот приблизительно что вышло у меня:</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">PROTOCOL IntelliMouse<br />ACCELERATOR 2 30 5<br />ACTIVATE * rec<br />MOVE_N * 2<br />MOVE_NE * 3<br />MOVE_E * 6<br />MOVE_SE * 9<br />MOVE_S * 8<br />MOVE_SW * 7<br />MOVE_W * 4<br />MOVE_NW * 1<br />BUTTON1_CLICK * recall<br />BUTTON2_CLICK * 0<br />BUTTON3_CLICK * enter<br />MOVE_IN * up<br />MOVE_OUT * down</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Можно перезапускать lirc:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">oleg@oleg-laptop:~$ sudo service lirc restart<br />* Stopping remote control mouse daemon: LIRCMD [fail]<br />* Stopping remote control daemon(s): LIRC [ OK ]<br />* Loading LIRC modules [ OK ]<br />* Starting remote control daemon(s) : LIRC [ OK ]<br />* Starting remote control mouse daemon : LIRCMD [ OK ]</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Но это еще не все, теперь осталось подключить нашу виртуальную мышь к серверу Xorg. Для этого добавим в файл /etc/X11/xorg.conf следующую секцию:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">Section &quot;InputDevice&quot;<br />Identifier &quot;LIRC-Mouse&quot;<br />Driver &quot;mouse&quot;<br />Option &quot;Device&quot; &quot;/var/run/lirc/lircm&quot;<br />Option &quot;Protocol&quot; &quot;IntelliMouse&quot;<br />Option &quot;SendCoreEvents&quot;<br />Option &quot;Buttons&quot; &quot;5&quot;<br />Option &quot;ZAxisMapping&quot; &quot;4 5&quot;<br />EndSection</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Затем в секцию ServerLayout нужно добавить такую строку к уже имеющимся:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">InputDevice &quot;LIRC-Mouse&quot;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">После чего в секцию ServerFlags добавим</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">Option &quot;AllowEmptyInput&quot; &quot;false&quot;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">У вас может возникнуть проблема в том, что последние версии Xorg работают вообще без конфигурационного файла, как у меня. Тогда нужно будет его создать. Выйдите из Xorg и запустите</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">oleg@oleg-laptop:~$ Xorg -configure</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В вашем домашнем каталоге появится файл xorg.conf.new, содержащий конфигурацию Xorg по умолчанию. Скопируйте его в файл /etc/X11/xorg.conf, внесите все необходимые правки и перезагрузите Xorg.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Можно пробовать виртуальную мышь. Сначала нажмите выбранную вами клавишу для включения режима эмуляции, затем попробуйте подвигать курсором. Если что-нибудь у вас не получается, в первую очередь проверьте, запустился ли lircmd, проверьте, существует ли файл /var/run/lircm, и наконец, проверьте логи Х-сервера.</p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Программы с графическим интерфейсом</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для Gnome есть программа для настройки LIRC в графическом режиме без правки конфигурационных файлов, но возможности ее зачаточны, и толком ничего настроить я не смог.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если вы используете KDE, попробуйте очень неплохую программу IrKick (находится в пакете kdelirc). Она позволяет назначать действия клавишам пультов в графическом режиме (рис.7), но lircd уже должен быть настроен, то есть IrKick можно рассматривать как замену ~/.lircrc+irexec+irxevent для KDE. </p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image412308324.png" /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Рис. 7</p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В ней можно использовать несколько пультов, для каждого из которых можно создать несколько режимов. Кроме запуска других программ, можно посылать сообщения по DBus запущенным приложениям KDE, для чего существует удобный мастер настройки; также есть модули расширения, позволяющие управлять Amarok, Konqueror, регулировать звук, выключать компьютер и др.</p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Передача инфракрасных сигналов</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если у вас есть не только приемник, но и передатчик ИК-сигналов, то с помощью LIRC можно и передавать инфракрасные сигналы управления, используя компьютер в качестве универсального ПДУ. К самодельному приемнику можно легко добавить ИК-диод, а если у вас IrDA-порт в ноутбуке, то передатчик у вас уже есть.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Передача сигналов реализуется программой irsend:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="0" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1<br /></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">irsend DIRECTIVE REMOTE BUTTON [BUTTON...]</p></td></tr></table>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Remote — пульт, нажатие кнопки которого эмулируется </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Button — собственно кнопка указанного пульта (как указано в файле /etc/lirc/lircd.conf) </li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Directive — может быть одним из вариантов: </li></ul>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">SEND_ONCE — послать нажатие кнопки один раз </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">SEND_START — нажать кнопку пульта (посылает повторяющиеся сигналы) </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">SEND_STOP — отпустить кнопку пульта</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Например:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="0" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1<br /></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">oleg@oleg-laptop:~$ irsend SEND_ONCE panas operate</p></td></tr></table>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">LIRC для Windows</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Существует реализация LIRC для Windows, которая называется WinLIRC. Правда, она давно не обновлялась, но работает. Существенный ее недостаток — это поддержка только самодельных приемников, подключаемых к последовательному порту. WinLIRC поддерживается некоторыми популярными программами, например, WinAMP, BSPlayer, VLC, LightAlloy и т.д.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Конфигурирование WinLIRC сводится к обучению ее вашему пульту. Если вы нашли подходящий конфигурационный файл для вашего ПДУ, можете попробовать его. WinLIRC сидит в трее и мигает значком при нажатии кнопок на пульте. Сторонние программы взаимодействуют с ней через TCP по адресу 127.0.0.1:8765.</p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">В заключение</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Надеюсь, ваша борьба с конфигурационными файлами LIRC завершится победой, и вы почувствуете неимоверное удобство этого инструмента. Пишите, постараюсь ответить на все вопросы. Успехов!</p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Ссылки</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.lirc.org/"><span style=" text-decoration: underline; color:#0000ff;">http://www.lirc.org</span></a> — официальный сайт LIRC, где можно загрузить исходные тексты, конфигурационные файлы для ПДУ и почитать документацию (на английском) </li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://winlirc.sourceforge.net/"><span style=" text-decoration: underline; color:#0000ff;">http://winlirc.sourceforge.net/</span></a> — здесь можно взять программу WinLIRC для Windows</li></ul>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>
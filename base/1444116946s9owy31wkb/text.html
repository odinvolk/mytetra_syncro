<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:10pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:xx-large; font-weight:600;">Миф №6: режим </span><span style=" font-family:'Courier New,courier'; font-size:xx-large; font-weight:600;">/3GB</span><span style=" font-size:xx-large; font-weight:600;"> позволит мне выделить </span><span style=" font-family:'Courier New,courier'; font-size:xx-large; font-weight:600;">1</span><span style=" font-size:xx-large; font-weight:600;"> гигантский блок памяти в </span><span style=" font-family:'Courier New,courier'; font-size:xx-large; font-weight:600;">3</span><span style=" font-size:xx-large; font-weight:600;"> Гб</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Просто то, что у вас есть аж <span style=" font-family:'Courier New,courier';">3</span> Гб виртуального адресного пространства, ещё не означает, что вы можете выделить один гигантский блок памяти размером <span style=" font-family:'Courier New,courier';">3</span> Гб. Мы уже видели (в мифе №3), что в виртуальное адресное пространство может быть фрагментировано, и вы не сможете выделить большой кусок за раз. <br /><br />Стандартные дыры в виртуальном адресном пространстве не изменились: это <span style=" font-family:'Courier New,courier';">64</span> Кб внизу и <span style=" font-family:'Courier New,courier';">64</span> Кб около границы в <span style=" font-family:'Courier New,courier';">2</span> Гб.<br /><br />Более того, системные DLL продолжают загружаться по их предпочтительным базовым адресам, которые лежат ниже границы <span style=" font-family:'Courier New,courier';">2</span> Гб. Куча процесса и другие типичные данные также откусывают понемногу от вашего виртуального адресного пространства.<br /><br />В результате то, что пользовательское виртуальное адресное пространство практически равно <span style=" font-family:'Courier New,courier';">3</span> Гб, ещё не значит, что всё свободное пространство представлено одним блоком. Дыры около границы <span style=" font-family:'Courier New,courier';">2</span> Гб не дают вам получить непрерывного участка даже в <span style=" font-family:'Courier New,courier';">2</span> Гб. <br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;">Примечание: некоторые люди могут захотеть попробовать переместить системные DLL по другим адресам, чтобы освободить побольше места, но это не сработает по нескольким причинам. Во-первых, конечно же, этим вы не избавитесь от пробела в <span style=" font-family:'Courier New,courier';">64</span> Кб около <span style=" font-family:'Courier New,courier';">2</span> Гб-ной границы. Во-вторых, система выделяет и другие данные, такие как блоки с информацией о потоках (thread information blocks) и переменные окружения, до того, как ваша программа получит шанс на выполнение; так что к тому времени, как ваша программа сможет выделять память, адресное пространство уже будет занято.<br /><br />Кроме того, системе действительно нужно, чтобы некоторые ключевые системные DLL были загружены по одним и тем же адресам во всех процессах. Например, ловушка <span style=" font-family:'Courier New,courier';">syscall</span> должна находиться в фиксированном месте, чтобы <a href="http://www.transl-gunsmoker.ru/2009/11/blog-post.html"><span style=" text-decoration: underline; color:#0000ff;">обработчик ловушки режима ядра опознал её как допустимую ловушку </span></a><a href="http://www.transl-gunsmoker.ru/2009/11/blog-post.html"><span style=" font-family:'Courier New,courier'; text-decoration: underline; color:#0000ff;">syscall</span></a><a href="http://www.transl-gunsmoker.ru/2009/11/blog-post.html"><span style=" text-decoration: underline; color:#0000ff;">, а не как недопустимую инструкцию</span></a>. Также этого требует отладчик, чтобы он мог использовать <a href="http://msdn.microsoft.com/en-us/library/ms682437(VS.85).aspx"><span style=" text-decoration: underline; color:#0000ff;">функцию </span></a><a href="http://msdn.microsoft.com/en-us/library/ms682437(VS.85).aspx"><span style=" font-family:'Courier New,courier'; text-decoration: underline; color:#0000ff;">CreateRemoteThread</span></a> для внедрения точки останова в процесс.</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Статус мифа: <span style=" font-weight:600; color:#ff0000;">busted</span>.<br /></p></body></html>
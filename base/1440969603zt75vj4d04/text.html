<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:10pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В связи с большим количеством однотипных вопросов от начинающих пользоваться <span style=" font-family:'Courier 10 Pitch'; color:#6a0e07;">QPainter</span>, и людей, задающихся вопросом &quot;Как нарисовать что-то своё на виджете&quot;, я распишу базовые понятия рисования.<br /><br />Итак, начнём с главного правила - рисовать на виджете можно переопределив его метод paintEvent(QPaintEvent *).<br /><br />Причина переопределения метода перерисовки в том, что код, выполняющийся в этой функции, будет запущен каждый раз, когда надо перерисовать внешний вид виджета. Перерисовка, на самом деле, требуется на так уж часто - когда изменяется геометрия виджета (например мы растянули окно, и вместе с ним растянулся наш виджет), когда виджет перекрывается/перестаёт_перекрываться/изменилось_перекрывание другими виджетами - вот основные причины для автоматического вызова перерисовки. <br /><br />Кстати говоря, автоматического вызова перерисовки не всегда достаточно, но мы можем сами вызвать перерисовку, вызвав метод update() для виджета.<br /><br />Подводя итог, можно сказать следующее: если мы хотим нарисовать что-то на виджете - нам надо создать свой собственный виджет, и переопределить его метод paintEvent(QPaintEvent *). После этого, мы создадим объект нашего класса.<br /><br /><span style=" font-weight:600;">1. Создаём наш виджет, который позволяет рисовать на себе: </span><br /><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; font-weight:600; color:#6a0e07;">qpaintwidget.h</span><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#006e28;">#ifndef QPAINTWIDGET_H</span><span style=" font-family:'monospace';"><br /></span><span style=" font-family:'monospace'; color:#006e28;">#define QPAINTWIDGET_H</span><span style=" font-family:'monospace';"><br /> <br /></span><span style=" font-family:'monospace'; color:#006e28;">#include &lt;QWidget&gt;</span><span style=" font-family:'monospace';"><br /> <br /></span><span style=" font-family:'monospace'; color:#0057ae;">class</span><span style=" font-family:'monospace';"> QPaintEvent</span><span style=" font-family:'monospace'; color:#006e28;">;</span><span style=" font-family:'monospace';"><br /> <br /></span><span style=" font-family:'monospace'; color:#0057ae;">class</span><span style=" font-family:'monospace';"> QPaintWidget </span><span style=" font-family:'monospace'; color:#006e28;">:</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#0057ae;">public</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#22aadd;">QWidget</span><span style=" font-family:'monospace';"><br /></span><span style=" font-family:'monospace'; color:#006e28;">{</span><span style=" font-family:'monospace';"><br />    </span><span style=" font-family:'monospace'; color:#0057ae;">Q_OBJECT</span><span style=" font-family:'monospace';"><br /></span><span style=" font-family:'monospace'; color:#0057ae;">public</span><span style=" font-family:'monospace'; color:#006e28;">:</span><span style=" font-family:'monospace';"><br />    QPaintWidget</span><span style=" font-family:'monospace'; color:#006e28;">(</span><span style=" font-family:'monospace'; color:#22aadd;">QWidget</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#006e28;">*</span><span style=" font-family:'monospace';"> parent </span><span style=" font-family:'monospace'; color:#006e28;">=</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#b08000;">0</span><span style=" font-family:'monospace'; color:#006e28;">);</span><span style=" font-family:'monospace';"><br /></span><span style=" font-family:'monospace'; color:#0057ae;">protected</span><span style=" font-family:'monospace'; color:#006e28;">:</span><span style=" font-family:'monospace';"><br />    </span><span style=" font-family:'monospace'; color:#0057ae;">void</span><span style=" font-family:'monospace';"> paintEvent</span><span style=" font-family:'monospace'; color:#006e28;">(</span><span style=" font-family:'monospace'; color:#22aadd;">QPaintEvent</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#006e28;">*);</span><span style=" font-family:'monospace';"><br /></span><span style=" font-family:'monospace'; color:#006e28;">};</span><span style=" font-family:'monospace';"><br /> <br /></span><span style=" font-family:'monospace'; color:#006e28;">#endif // QPAINTWIDGET_H</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier 10 Pitch'; font-weight:600; color:#6a0e07;">qpaintwidget.cpp</span><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#006e28;">#include &quot;qpaintwidget.h&quot;</span><span style=" font-family:'monospace';"><br /> <br /></span><span style=" font-family:'monospace'; color:#006e28;">#include &lt;QPainter&gt;</span><span style=" font-family:'monospace';"><br /> <br />QPaintWidget</span><span style=" font-family:'monospace'; color:#006e28;">::</span><span style=" font-family:'monospace'; color:#2b74c7;">QPaintWidget</span><span style=" font-family:'monospace'; color:#006e28;">(</span><span style=" font-family:'monospace'; color:#22aadd;">QWidget</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#006e28;">*</span><span style=" font-family:'monospace';"> parent</span><span style=" font-family:'monospace'; color:#006e28;">)</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#006e28;">:</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#22aadd;">QWidget</span><span style=" font-family:'monospace'; color:#006e28;">(</span><span style=" font-family:'monospace';">parent</span><span style=" font-family:'monospace'; color:#006e28;">)</span><span style=" font-family:'monospace';"><br /></span><span style=" font-family:'monospace'; color:#006e28;">{</span><span style=" font-family:'monospace';"><br /></span><span style=" font-family:'monospace'; color:#006e28;">}</span><span style=" font-family:'monospace';"><br /> <br /></span><span style=" font-family:'monospace'; color:#0057ae;">void</span><span style=" font-family:'monospace';"> QPaintWidget</span><span style=" font-family:'monospace'; color:#006e28;">::</span><span style=" font-family:'monospace'; color:#2b74c7;">paintEvent</span><span style=" font-family:'monospace'; color:#006e28;">(</span><span style=" font-family:'monospace'; color:#22aadd;">QPaintEvent</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#006e28;">*)</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#006e28;">{</span><span style=" font-family:'monospace';"><br />    </span><span style=" font-family:'monospace'; color:#22aadd;">QPainter</span><span style=" font-family:'monospace';"> p</span><span style=" font-family:'monospace'; color:#006e28;">(</span><span style=" font-family:'monospace'; font-weight:600; color:#000000;">this</span><span style=" font-family:'monospace'; color:#006e28;">);</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#888888;">// Создаём новый объект рисовальщика</span><span style=" font-family:'monospace';"><br />    p.</span><span style=" font-family:'monospace'; color:#2b74c7;">setPen</span><span style=" font-family:'monospace'; color:#006e28;">(</span><span style=" font-family:'monospace'; color:#22aadd;">QPen</span><span style=" font-family:'monospace'; color:#006e28;">(</span><span style=" font-family:'monospace';">Qt</span><span style=" font-family:'monospace'; color:#006e28;">::</span><span style=" font-family:'monospace'; color:#2b74c7;">red</span><span style=" font-family:'monospace'; color:#006e28;">,</span><span style=" font-family:'monospace'; color:#b08000;">1</span><span style=" font-family:'monospace'; color:#006e28;">,</span><span style=" font-family:'monospace';">Qt</span><span style=" font-family:'monospace'; color:#006e28;">::</span><span style=" font-family:'monospace'; color:#2b74c7;">SolidLine</span><span style=" font-family:'monospace'; color:#006e28;">));</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#888888;">// Настройки рисования</span><span style=" font-family:'monospace';"><br />    p.</span><span style=" font-family:'monospace'; color:#2b74c7;">drawLine</span><span style=" font-family:'monospace'; color:#006e28;">(</span><span style=" font-family:'monospace'; color:#b08000;">0</span><span style=" font-family:'monospace'; color:#006e28;">,</span><span style=" font-family:'monospace'; color:#b08000;">0</span><span style=" font-family:'monospace'; color:#006e28;">,</span><span style=" font-family:'monospace';">width</span><span style=" font-family:'monospace'; color:#006e28;">(),</span><span style=" font-family:'monospace';">height</span><span style=" font-family:'monospace'; color:#006e28;">());</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#888888;">// Рисование линии</span><span style=" font-family:'monospace';"><br /></span><span style=" font-family:'monospace'; color:#006e28;">}</span><span style=" font-family:'monospace';"><br /> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Пояснения:<br /><br />QPainter p(this); - создаём новый объект рисовальщика. Рисовать мы можем, по идее, на любом QPaintDevice, указав указатель на объект унаследованный от QPaintDevice в качестве параметра для создающегося QPainter объекта. (Подробнее о классах, на которых можно рисовать - QtAssitant::QPaintDevice;) В нашем случае мы передаём указатель на наш виджет - this. После этого наш объект QPainter класса может совершенно спокойно рисовать.<br /><br />p.setPen(QPen(Qt::red,1,Qt::SolidLine)); - настраиваем рисование. а точнее говорим, что рисовать надо красным цветом, сплошными линиями толщиной 1 пиксель.<br /><br />p.drawLine(0,0,width(),height()); - рисуем линию из точки с координатами (0,0) (по умолчанию это верхний левый угол виджета, однако это можно изменить) в точку с координатами (width,height). <br /><br />В результате, мы добъёмся того, что у нас на виджете всегда будет рисоваться диагональная красная линия.<br /><br /><br /><span style=" font-weight:600;">2. Небольшое пояснение о системах координат:</span><br /><br />По умолчанию виджет имеет систему координат с началом в верхнем левом углу (точка (0,0) ). Ось X направлена вправо, ось Y направлена вниз. Однако это всегда можно изменить функцией setWindow() - подробности в QtAssistant.<br /><br /><br /><span style=" font-weight:600;">3. Осталось создать объект нашего класса.</span><br /><br />Я создал стандартный проект с MainWindow  окном. Потом положил на него вертикальный лейаут (но, разумеется, можно любой, и вообще - это просто для удобства всего лишь один способ разместить виджет на другом виджете) что бы в него помещать наш виджет.</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Модифицированные строки выделены комментариями.<br /><br /><span style=" font-weight:600;">mainwindow.h</span><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#006e28;">#ifndef MAINWINDOW_H</span><span style=" font-family:'monospace';"><br /></span><span style=" font-family:'monospace'; color:#006e28;">#define MAINWINDOW_H</span><span style=" font-family:'monospace';"><br /> <br /></span><span style=" font-family:'monospace'; color:#006e28;">#include &lt;QMainWindow&gt;</span><span style=" font-family:'monospace';"><br /> <br /></span><span style=" font-family:'monospace'; color:#888888;">//nash class</span><span style=" font-family:'monospace';"><br /></span><span style=" font-family:'monospace'; color:#006e28;">#include &quot;qpaintwidget.h&quot;</span><span style=" font-family:'monospace';"><br /> <br /></span><span style=" font-family:'monospace'; color:#0057ae;">namespace</span><span style=" font-family:'monospace';"> Ui </span><span style=" font-family:'monospace'; color:#006e28;">{</span><span style=" font-family:'monospace';"><br />    </span><span style=" font-family:'monospace'; color:#0057ae;">class</span><span style=" font-family:'monospace';"> MainWindow</span><span style=" font-family:'monospace'; color:#006e28;">;</span><span style=" font-family:'monospace';"><br /></span><span style=" font-family:'monospace'; color:#006e28;">}</span><span style=" font-family:'monospace';"><br /> <br /></span><span style=" font-family:'monospace'; color:#0057ae;">class</span><span style=" font-family:'monospace';"> MainWindow </span><span style=" font-family:'monospace'; color:#006e28;">:</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#0057ae;">public</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#22aadd;">QMainWindow</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#006e28;">{</span><span style=" font-family:'monospace';"><br />    </span><span style=" font-family:'monospace'; color:#0057ae;">Q_OBJECT</span><span style=" font-family:'monospace';"><br /></span><span style=" font-family:'monospace'; color:#0057ae;">public</span><span style=" font-family:'monospace'; color:#006e28;">:</span><span style=" font-family:'monospace';"><br />    MainWindow</span><span style=" font-family:'monospace'; color:#006e28;">(</span><span style=" font-family:'monospace'; color:#22aadd;">QWidget</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#006e28;">*</span><span style=" font-family:'monospace';">parent </span><span style=" font-family:'monospace'; color:#006e28;">=</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#b08000;">0</span><span style=" font-family:'monospace'; color:#006e28;">);</span><span style=" font-family:'monospace';"><br />    ~MainWindow</span><span style=" font-family:'monospace'; color:#006e28;">();</span><span style=" font-family:'monospace';"><br /> <br /></span><span style=" font-family:'monospace'; color:#0057ae;">protected</span><span style=" font-family:'monospace'; color:#006e28;">:</span><span style=" font-family:'monospace';"><br />    </span><span style=" font-family:'monospace'; color:#0057ae;">void</span><span style=" font-family:'monospace';"> changeEvent</span><span style=" font-family:'monospace'; color:#006e28;">(</span><span style=" font-family:'monospace'; color:#22aadd;">QEvent</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#006e28;">*</span><span style=" font-family:'monospace';">e</span><span style=" font-family:'monospace'; color:#006e28;">);</span><span style=" font-family:'monospace';"><br /> <br /></span><span style=" font-family:'monospace'; color:#0057ae;">private</span><span style=" font-family:'monospace'; color:#006e28;">:</span><span style=" font-family:'monospace';"><br />    Ui</span><span style=" font-family:'monospace'; color:#006e28;">::</span><span style=" font-family:'monospace'; color:#2b74c7;">MainWindow</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#006e28;">*</span><span style=" font-family:'monospace';">ui</span><span style=" font-family:'monospace'; color:#006e28;">;</span><span style=" font-family:'monospace';"><br /> <br />    </span><span style=" font-family:'monospace'; color:#888888;">// Указатель на объект нашего класса</span><span style=" font-family:'monospace';"><br />    QPaintWidget </span><span style=" font-family:'monospace'; color:#006e28;">*</span><span style=" font-family:'monospace';">wgt</span><span style=" font-family:'monospace'; color:#006e28;">;</span><span style=" font-family:'monospace';"><br /></span><span style=" font-family:'monospace'; color:#006e28;">};</span><span style=" font-family:'monospace';"><br /> <br /></span><span style=" font-family:'monospace'; color:#006e28;">#endif // MAINWINDOW_H</span><span style=" font-family:'monospace';"><br /> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-weight:600;">mainwindow.cpp</span><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#006e28;">#include &quot;mainwindow.h&quot;</span><span style=" font-family:'monospace';"><br /></span><span style=" font-family:'monospace'; color:#006e28;">#include &quot;ui_mainwindow.h&quot;</span><span style=" font-family:'monospace';"><br /> <br />MainWindow</span><span style=" font-family:'monospace'; color:#006e28;">::</span><span style=" font-family:'monospace'; color:#2b74c7;">MainWindow</span><span style=" font-family:'monospace'; color:#006e28;">(</span><span style=" font-family:'monospace'; color:#22aadd;">QWidget</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#006e28;">*</span><span style=" font-family:'monospace';">parent</span><span style=" font-family:'monospace'; color:#006e28;">)</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#006e28;">:</span><span style=" font-family:'monospace';"><br />    </span><span style=" font-family:'monospace'; color:#22aadd;">QMainWindow</span><span style=" font-family:'monospace'; color:#006e28;">(</span><span style=" font-family:'monospace';">parent</span><span style=" font-family:'monospace'; color:#006e28;">),</span><span style=" font-family:'monospace';"><br />    ui</span><span style=" font-family:'monospace'; color:#006e28;">(</span><span style=" font-family:'monospace'; font-weight:600; color:#000000;">new</span><span style=" font-family:'monospace';"> Ui</span><span style=" font-family:'monospace'; color:#006e28;">::</span><span style=" font-family:'monospace'; color:#2b74c7;">MainWindow</span><span style=" font-family:'monospace'; color:#006e28;">)</span><span style=" font-family:'monospace';"><br /></span><span style=" font-family:'monospace'; color:#006e28;">{</span><span style=" font-family:'monospace';"><br />    ui</span><span style=" font-family:'monospace'; color:#006e28;">-&gt;</span><span style=" font-family:'monospace'; color:#2b74c7;">setupUi</span><span style=" font-family:'monospace'; color:#006e28;">(</span><span style=" font-family:'monospace'; font-weight:600; color:#000000;">this</span><span style=" font-family:'monospace'; color:#006e28;">);</span><span style=" font-family:'monospace';"><br /> <br />    </span><span style=" font-family:'monospace'; color:#888888;">// Создаем виджет</span><span style=" font-family:'monospace';"><br />    wgt </span><span style=" font-family:'monospace'; color:#006e28;">=</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; font-weight:600; color:#000000;">new</span><span style=" font-family:'monospace';"> QPaintWidget</span><span style=" font-family:'monospace'; color:#006e28;">(</span><span style=" font-family:'monospace'; font-weight:600; color:#000000;">this</span><span style=" font-family:'monospace'; color:#006e28;">);</span><span style=" font-family:'monospace';"><br /> <br />    </span><span style=" font-family:'monospace'; color:#888888;">// И кладём его в лайаут</span><span style=" font-family:'monospace';"><br />    ui</span><span style=" font-family:'monospace'; color:#006e28;">-&gt;</span><span style=" font-family:'monospace'; color:#2b74c7;">verticalLayout</span><span style=" font-family:'monospace'; color:#006e28;">-&gt;</span><span style=" font-family:'monospace'; color:#2b74c7;">addWidget</span><span style=" font-family:'monospace'; color:#006e28;">(</span><span style=" font-family:'monospace';">wgt</span><span style=" font-family:'monospace'; color:#006e28;">);</span><span style=" font-family:'monospace';"><br /></span><span style=" font-family:'monospace'; color:#006e28;">}</span><span style=" font-family:'monospace';"><br /> <br />MainWindow</span><span style=" font-family:'monospace'; color:#006e28;">::</span><span style=" font-family:'monospace'; color:#2b74c7;">~MainWindow</span><span style=" font-family:'monospace'; color:#006e28;">()</span><span style=" font-family:'monospace';"><br /></span><span style=" font-family:'monospace'; color:#006e28;">{</span><span style=" font-family:'monospace';"><br />    </span><span style=" font-family:'monospace'; color:#888888;">// Подчищаем</span><span style=" font-family:'monospace';"><br />    wgt</span><span style=" font-family:'monospace'; color:#006e28;">-&gt;</span><span style=" font-family:'monospace'; color:#2b74c7;">deleteLater</span><span style=" font-family:'monospace'; color:#006e28;">();</span><span style=" font-family:'monospace';"><br />    </span><span style=" font-family:'monospace'; font-weight:600; color:#000000;">delete</span><span style=" font-family:'monospace';"> ui</span><span style=" font-family:'monospace'; color:#006e28;">;</span><span style=" font-family:'monospace';"><br /></span><span style=" font-family:'monospace'; color:#006e28;">}</span><span style=" font-family:'monospace';"><br /> <br /></span><span style=" font-family:'monospace'; color:#0057ae;">void</span><span style=" font-family:'monospace';"> MainWindow</span><span style=" font-family:'monospace'; color:#006e28;">::</span><span style=" font-family:'monospace'; color:#2b74c7;">changeEvent</span><span style=" font-family:'monospace'; color:#006e28;">(</span><span style=" font-family:'monospace'; color:#22aadd;">QEvent</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#006e28;">*</span><span style=" font-family:'monospace';">e</span><span style=" font-family:'monospace'; color:#006e28;">)</span><span style=" font-family:'monospace';"><br /></span><span style=" font-family:'monospace'; color:#006e28;">{</span><span style=" font-family:'monospace';"><br />    </span><span style=" font-family:'monospace'; color:#22aadd;">QMainWindow</span><span style=" font-family:'monospace'; color:#006e28;">::</span><span style=" font-family:'monospace'; color:#2b74c7;">changeEvent</span><span style=" font-family:'monospace'; color:#006e28;">(</span><span style=" font-family:'monospace';">e</span><span style=" font-family:'monospace'; color:#006e28;">);</span><span style=" font-family:'monospace';"><br />    </span><span style=" font-family:'monospace'; font-weight:600; color:#000000;">switch</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#006e28;">(</span><span style=" font-family:'monospace';">e</span><span style=" font-family:'monospace'; color:#006e28;">-&gt;</span><span style=" font-family:'monospace'; color:#2b74c7;">type</span><span style=" font-family:'monospace'; color:#006e28;">())</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#006e28;">{</span><span style=" font-family:'monospace';"><br />    </span><span style=" font-family:'monospace'; font-weight:600; color:#000000;">case</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#22aadd;">QEvent</span><span style=" font-family:'monospace'; color:#006e28;">::</span><span style=" font-family:'monospace'; color:#2b74c7;">LanguageChange</span><span style=" font-family:'monospace'; color:#006e28;">:</span><span style=" font-family:'monospace';"><br />        ui</span><span style=" font-family:'monospace'; color:#006e28;">-&gt;</span><span style=" font-family:'monospace'; color:#2b74c7;">retranslateUi</span><span style=" font-family:'monospace'; color:#006e28;">(</span><span style=" font-family:'monospace'; font-weight:600; color:#000000;">this</span><span style=" font-family:'monospace'; color:#006e28;">);</span><span style=" font-family:'monospace';"><br />        break</span><span style=" font-family:'monospace'; color:#006e28;">;</span><span style=" font-family:'monospace';"><br />    </span><span style=" font-family:'monospace'; font-weight:600; color:#000000;">default</span><span style=" font-family:'monospace'; color:#006e28;">:</span><span style=" font-family:'monospace';"><br />        break</span><span style=" font-family:'monospace'; color:#006e28;">;</span><span style=" font-family:'monospace';"><br />    </span><span style=" font-family:'monospace'; color:#006e28;">}</span><span style=" font-family:'monospace';"><br /></span><span style=" font-family:'monospace'; color:#006e28;">}</span><span style=" font-family:'monospace';"><br /> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;"><br />4. Вот и всё.</span><br /><br />Что же происходит? Cоздаётся виджет <span style=" font-family:'monospace';">QPaintWidget </span><span style=" font-family:'monospace'; color:#006e28;">*</span><span style=" font-family:'monospace';">wgt</span>, его размером управляет лейаут. Как только произошло изменение размеров, у виджета вызывается метод paintEvent(QPaintEvent *), в котором мы на этом виджете рисуем диагональную линию красным цветом.<span style=" font-style:italic;"><br /></span><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">5. Послесловие</span><br /><br />Разумеется, этого редко бывает достаточно. Если мы действительно хотим что-то рисовать на виджете (например, графики), то в ход идут немного другие алгоритмы. <br /><br />Например:<br /><br />5.1. В нашем виджете создаём QImage объект и пишем функции синхронизации размеров этого объкта с размерами виджета. Это будет наш, так называемый, Back Buffer - фоновый буффер для рисования.<br /><br />5.2. Когда нам надо что-то нарисовать - мы рисуем именно на этой &quot;картинке&quot;. Рисование может занимать долгое время, может короткое - мы можем вынести этот код в отдельный поток - это не проблема. Просто результатом потока будет объект QImage на котором будет нарисовано всё что надо (а пока будет расчитываться и рисоваться - мы будем сигналить процент прогресса).<br /><br />5.3. При необходимости рисования мы один раз рисуем фоновый буфер на наш виджет (QImage объект на котором УЖЕ нарисовано всё что нам надо) методом QPainter::drawImage(...) внутри функции paintEvent(QPaintEvent *). Тем самым мы добъёмся того, что бы отрисовка происходила плавно и не загружала основной поток.<br /><br />Надеюсь, этот маленький HOWTO резко сократит количество вопросов по рисованию с QPainter. </p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>
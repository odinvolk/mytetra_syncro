<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Здесь описывается использование Bluetooth Low Energy API provided в Qt. <a name="result_box"></a>На стороне клиента API позволяет создавать подключения к периферийным устройствам, обнаруживать их службы, а также считывать и записывать данные, хранящиеся на устройстве. На стороне сервера API позволяет настраивать службы, рекламировать их и получать уведомления, когда клиент записывает характеристики. Примеры кода, приведенные ниже, берутся из примеров сервера Heart Rate Game и Heart Rate Server.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Установка соединения</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">To be able to read and write the characteristics of the Bluetooth Low Energy peripheral device, it is necessary to find and connect the device. This requires the peripheral device to advertise its presence and services. We start the device discovery with the help of the <a href="qbluetoothdevicediscoveryagent.html"><span style=" text-decoration: underline; color:#0000ff;">QBluetoothDeviceDiscoveryAgent</span></a> class. We connect to its <a href="qbluetoothdevicediscoveryagent.html#deviceDiscovered"><span style=" text-decoration: underline; color:#0000ff;">QBluetoothDeviceDiscoveryAgent::deviceDiscovered</span></a>() signal and start the search with <a href="qbluetoothdevicediscoveryagent.html#start"><span style=" text-decoration: underline; color:#0000ff;">start()</span></a>:</p>
<p style="-qt-paragraph-type:empty; margin-top:15px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;">  m_deviceDiscoveryAgent </span><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">= new </span><a href="qbluetoothdevicediscoveryagent.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothDeviceDiscoveryAgent</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">(this);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  m_deviceDiscoveryAgent-&gt;setLowEnergyDiscoveryTimeout(5000);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  connect(m_deviceDiscoveryAgent, &amp;</span><a href="qbluetoothdevicediscoveryagent.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothDeviceDiscoveryAgent</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::deviceDiscovered, this, &amp;DeviceFinder::addDevice);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  connect(m_deviceDiscoveryAgent, static_cast&lt;void (</span><a href="qbluetoothdevicediscoveryagent.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothDeviceDiscoveryAgent</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::*)(</span><a href="qbluetoothdevicediscoveryagent.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothDeviceDiscoveryAgent</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::Error)&gt;(&amp;</span><a href="qbluetoothdevicediscoveryagent.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothDeviceDiscoveryAgent</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::error),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          this, &amp;DeviceFinder::scanError);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  connect(m_deviceDiscoveryAgent, &amp;</span><a href="qbluetoothdevicediscoveryagent.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothDeviceDiscoveryAgent</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::finished, this, &amp;DeviceFinder::scanFinished);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  connect(m_deviceDiscoveryAgent, &amp;</span><a href="qbluetoothdevicediscoveryagent.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothDeviceDiscoveryAgent</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::canceled, this, &amp;DeviceFinder::scanFinished);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  m_deviceDiscoveryAgent-&gt;start(</span><a href="qbluetoothdevicediscoveryagent.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothDeviceDiscoveryAgent</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::LowEnergyMethod);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:15px; margin-bottom:10px; margin-left:15px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Since we are only interested in Low Energy devices we filter the device type within the receiving slot. The device type can be ascertained using the <a href="qbluetoothdeviceinfo.html#coreConfigurations"><span style=" text-decoration: underline; color:#007330;">QBluetoothDeviceInfo::coreConfigurations</span></a>() flag:</p>
<p style="-qt-paragraph-type:empty; margin-top:15px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;">  </span><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">void DeviceFinder::addDevice(const </span><a href="qbluetoothdeviceinfo.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothDeviceInfo</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;"> &amp;device)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      // If device is LowEnergy-device, add it to the list</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      if (device.coreConfigurations() &amp; </span><a href="qbluetoothdeviceinfo.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothDeviceInfo</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::LowEnergyCoreConfiguration) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          m_devices.append(new DeviceInfo(device));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          setInfo(tr(&quot;Low Energy device found. Scanning more...&quot;));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      //...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:15px; margin-bottom:10px; margin-left:15px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Once the address of the peripheral device is known we use the <a href="qlowenergycontroller.html"><span style=" text-decoration: underline; color:#007330;">QLowEnergyController</span></a> class. This class is the entry point for all Bluetooth Low Energy development. The constructor of the class accepts the remote device's <a href="qbluetoothaddress.html"><span style=" text-decoration: underline; color:#007330;">QBluetoothAddress</span></a>. Finally we set up the customary slots and directly connect to the device using <a href="qlowenergycontroller.html#connectToDevice"><span style=" text-decoration: underline; color:#007330;">connectToDevice()</span></a>:</p>
<p style="-qt-paragraph-type:empty; margin-top:15px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;">  m_control </span><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">= new </span><a href="qlowenergycontroller.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyController</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">(m_currentDevice-&gt;getDevice(), this);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  connect(m_control, &amp;</span><a href="qlowenergycontroller.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyController</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::serviceDiscovered,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          this, &amp;DeviceHandler::serviceDiscovered);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  connect(m_control, &amp;</span><a href="qlowenergycontroller.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyController</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::discoveryFinished,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          this, &amp;DeviceHandler::serviceScanDone);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  connect(m_control, static_cast&lt;void (</span><a href="qlowenergycontroller.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyController</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::*)(</span><a href="qlowenergycontroller.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyController</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::Error)&gt;(&amp;</span><a href="qlowenergycontroller.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyController</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::error),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          this, [this](</span><a href="qlowenergycontroller.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyController</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::Error error) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      Q_UNUSED(error);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      setError(&quot;Cannot connect to remote device.&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  });</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  connect(m_control, &amp;</span><a href="qlowenergycontroller.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyController</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::connected, this, [this]() {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      setInfo(&quot;Controller connected. Search services...&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      m_control-&gt;discoverServices();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  });</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  connect(m_control, &amp;</span><a href="qlowenergycontroller.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyController</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::disconnected, this, [this]() {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      setError(&quot;LowEnergy controller disconnected&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  });</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  // Connect</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  m_control-&gt;connectToDevice();</span></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><a name="service-search"></a><span style=" font-family:'monospace';"> </span></p>
<p style=" margin-top:30px; margin-bottom:30px; margin-left:6px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Service Search</span></p>
<p style=" margin-top:15px; margin-bottom:10px; margin-left:15px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">The above code snippet how the application initiates the service discovery once the connection has been established.</p>
<p style=" margin-top:15px; margin-bottom:10px; margin-left:15px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">The <span style=" font-family:'Courier,monospace';">serviceDiscovered()</span> slot below is triggered as a result of the <a href="qlowenergycontroller.html#serviceDiscovered"><span style=" text-decoration: underline; color:#007330;">QLowEnergyController::serviceDiscovered</span></a>() signal and provides an intermittent progress report. Since we are talking about the heart listener app which monitors HeartRate devices in the vicinity we ignore any service that is not of type <a href="qbluetoothuuid.html#ServiceClassUuid-enum"><span style=" text-decoration: underline; color:#007330;">QBluetoothUuid::HeartRate</span></a>.</p>
<p style="-qt-paragraph-type:empty; margin-top:15px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;">  </span><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">void DeviceHandler::serviceDiscovered(const </span><a href="qbluetoothuuid.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothUuid</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;"> &amp;gatt)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      if (gatt == </span><a href="qbluetoothuuid.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothUuid</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">(</span><a href="qbluetoothuuid.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothUuid</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::HeartRate)) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          setInfo(&quot;Heart Rate service discovered. Waiting for service scan to be done...&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          m_foundHeartRateService = true;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:15px; margin-bottom:10px; margin-left:15px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Eventually the <a href="qlowenergycontroller.html#discoveryFinished"><span style=" text-decoration: underline; color:#007330;">QLowEnergyController::discoveryFinished</span></a>() signal is emitted to indicate the successful completion of the service discovery. Provided a HeartRate service was found, a <a href="qlowenergyservice.html"><span style=" text-decoration: underline; color:#007330;">QLowEnergyService</span></a> instance is created to represent the service. The returned service object provides the required signals for update notifications and the discovery of service details is triggered using <a href="qlowenergyservice.html#discoverDetails"><span style=" text-decoration: underline; color:#007330;">QLowEnergyService::discoverDetails</span></a>():</p>
<p style="-qt-paragraph-type:empty; margin-top:15px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;">      </span><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">// If heartRateService found, create new service</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      if (m_foundHeartRateService)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          m_service = m_control-&gt;createServiceObject(</span><a href="qbluetoothuuid.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothUuid</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">(</span><a href="qbluetoothuuid.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothUuid</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::HeartRate), this);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      if (m_service) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          connect(m_service, &amp;</span><a href="qlowenergyservice.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyService</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::stateChanged, this, &amp;DeviceHandler::serviceStateChanged);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          connect(m_service, &amp;</span><a href="qlowenergyservice.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyService</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::characteristicChanged, this, &amp;DeviceHandler::updateHeartRateValue);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          connect(m_service, &amp;</span><a href="qlowenergyservice.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyService</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::descriptorWritten, this, &amp;DeviceHandler::confirmedDescriptorWrite);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          m_service-&gt;discoverDetails();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      } else {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          setError(&quot;Heart Rate Service not found.&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:15px; margin-bottom:10px; margin-left:15px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">During the detail search the service's <a href="qlowenergyservice.html#state"><span style=" text-decoration: underline; color:#007330;">state()</span></a> transitions from <a href="qlowenergyservice.html#ServiceState-enum"><span style=" text-decoration: underline; color:#007330;">DiscoveryRequired</span></a> to <a href="qlowenergyservice.html#ServiceState-enum"><span style=" text-decoration: underline; color:#007330;">DiscoveringServices</span></a> and eventually ends with <a href="qlowenergyservice.html#ServiceState-enum"><span style=" text-decoration: underline; color:#007330;">ServiceDiscovered</span></a>:</p>
<p style="-qt-paragraph-type:empty; margin-top:15px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;">  </span><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">void DeviceHandler::serviceStateChanged(</span><a href="qlowenergyservice.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyService</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::ServiceState s)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      switch (s) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      case </span><a href="qlowenergyservice.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyService</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::DiscoveringServices:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          setInfo(tr(&quot;Discovering services...&quot;));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          break;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      case </span><a href="qlowenergyservice.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyService</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::ServiceDiscovered:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          setInfo(tr(&quot;Service discovered.&quot;));</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          const </span><a href="qlowenergycharacteristic.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyCharacteristic</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;"> hrChar = m_service-&gt;characteristic(</span><a href="qbluetoothuuid.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothUuid</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">(</span><a href="qbluetoothuuid.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothUuid</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::HeartRateMeasurement));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          if (!hrChar.isValid()) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">              setError(&quot;HR Data not found.&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">              break;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          m_notificationDesc = hrChar.descriptor(</span><a href="qbluetoothuuid.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothUuid</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::ClientCharacteristicConfiguration);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          if (m_notificationDesc.isValid())</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">              m_service-&gt;writeDescriptor(m_notificationDesc, </span><a href="../qtcore/qbytearray.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QByteArray</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::fromHex(&quot;0100&quot;));</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          break;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      default:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          //nothing for now</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          break;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      emit aliveChanged();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  }</span></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><a name="interaction-with-the-peripheral-device"></a><span style=" font-family:'monospace';"> </span></p>
<p style=" margin-top:30px; margin-bottom:30px; margin-left:6px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Interaction with the Peripheral Device</span></p>
<p style=" margin-top:15px; margin-bottom:10px; margin-left:15px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">In the code example above, the desired characteristic is of type <a href="qbluetoothuuid.html#CharacteristicType-enum"><span style=" text-decoration: underline; color:#007330;">HeartRateMeasurement</span></a>. Since the application measures the heart rate changes, it must enable change notifications for the characteristic. Note that not all characteristics provide change notifications. Since the HeartRate characteristic has been standardized it is possible to assume that notifications can be received. Ultimately <a href="qlowenergycharacteristic.html#properties"><span style=" text-decoration: underline; color:#007330;">QLowEnergyCharacteristic::properties</span></a>() must have the <a href="qlowenergycharacteristic.html#PropertyType-enum"><span style=" text-decoration: underline; color:#007330;">QLowEnergyCharacteristic::Notify</span></a> flag set and a descriptor of type <a href="qbluetoothuuid.html#DescriptorType-enum"><span style=" text-decoration: underline; color:#007330;">QBluetoothUuid::ClientCharacteristicConfiguration</span></a> must exist to confirm the availability of an appropriate notification.</p>
<p style=" margin-top:15px; margin-bottom:10px; margin-left:15px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Finally, we process the value of the HeartRate characteristic, as per Bluetooth Low Energy standard:</p>
<p style="-qt-paragraph-type:empty; margin-top:15px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;">  </span><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">void DeviceHandler::updateHeartRateValue(const </span><a href="qlowenergycharacteristic.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyCharacteristic</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;"> &amp;c, const </span><a href="../qtcore/qbytearray.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QByteArray</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;"> &amp;value)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      // ignore any other characteristic change -&gt; shouldn't really happen though</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      if (c.uuid() != </span><a href="qbluetoothuuid.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothUuid</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">(</span><a href="qbluetoothuuid.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothUuid</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::HeartRateMeasurement))</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          return;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      const </span><a href="../qtcore/qtglobal.html#quint8-typedef"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">quint8</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;"> *data = reinterpret_cast&lt;const </span><a href="../qtcore/qtglobal.html#quint8-typedef"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">quint8</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;"> *&gt;(value.constData());</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      </span><a href="../qtcore/qtglobal.html#quint8-typedef"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">quint8</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;"> flags = data[0];</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      //Heart Rate</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      int hrvalue = 0;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      if (flags &amp; 0x1) // HR 16 bit? otherwise 8 bit</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          hrvalue = (int)</span><a href="../qtcore/qtendian.html#qFromLittleEndian"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">qFromLittleEndian</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">&lt;</span><a href="../qtcore/qtglobal.html#quint16-typedef"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">quint16</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">&gt;(data[1]);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          hrvalue = (int)data[1];</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      addMeasurement(hrvalue);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:15px; margin-bottom:10px; margin-left:15px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">In general a characteristic value is a series of bytes. The precise interpretation of those bytes depends on the characteristic type and value structure. A significant number has been standardized by the <a href="https://developer.bluetooth.org/gatt/services/Pages/ServicesHome.aspx"><span style=" text-decoration: underline; color:#007330;">Bluetooth SIG</span></a> whereas others may follow a custom protocol. The above code snippet demonstrates how to the read the standardized HeartRate value.<a name="advertising-services"></a> </p>
<p style=" margin-top:30px; margin-bottom:30px; margin-left:6px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Advertising Services</span></p>
<p style=" margin-top:15px; margin-bottom:10px; margin-left:15px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">If we are implementing a GATT server application on a peripheral device, we need to define the services we want to offer to central devices and advertise them:</p>
<p style="-qt-paragraph-type:empty; margin-top:15px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;">  </span><a href="qlowenergyadvertisingdata.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyAdvertisingData</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;"> advertisingData;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  advertisingData.setDiscoverability(</span><a href="qlowenergyadvertisingdata.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyAdvertisingData</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::DiscoverabilityGeneral);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  advertisingData.setIncludePowerLevel(true);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  advertisingData.setLocalName(&quot;HeartRateServer&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  advertisingData.setServices(</span><a href="../qtcore/qlist.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QList</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">&lt;</span><a href="qbluetoothuuid.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothUuid</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">&gt;() &lt;&lt; </span><a href="qbluetoothuuid.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothUuid</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::HeartRate);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  const </span><a href="../qtcore/qscopedpointer.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QScopedPointer</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">&lt;</span><a href="qlowenergycontroller.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyController</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">&gt; leController(</span><a href="qlowenergycontroller.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyController</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::createPeripheral());</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  const </span><a href="../qtcore/qscopedpointer.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QScopedPointer</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">&lt;</span><a href="qlowenergyservice.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyService</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">&gt; service(leController-&gt;addService(serviceData));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  leController-&gt;startAdvertising(</span><a href="qlowenergyadvertisingparameters.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyAdvertisingParameters</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">(), advertisingData,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">                                 advertisingData);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:15px; margin-bottom:10px; margin-left:15px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Now potential clients can connect to our device, discover the provided service and register themselves to get notified of changes to the characteristic value. This part of the API was already covered by the above sections.<a name="implementing-a-service-on-the-peripheral-device"></a> </p>
<p style=" margin-top:30px; margin-bottom:30px; margin-left:6px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Implementing a Service on the Peripheral Device</span></p>
<p style=" margin-top:15px; margin-bottom:10px; margin-left:15px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">The first step is to define the service, its characteristics and descriptors. This is achieved using the <a href="qlowenergyservicedata.html"><span style=" text-decoration: underline; color:#007330;">QLowEnergyServiceData</span></a>, <a href="qlowenergycharacteristicdata.html"><span style=" text-decoration: underline; color:#007330;">QLowEnergyCharacteristicData</span></a> and <a href="qlowenergydescriptordata.html"><span style=" text-decoration: underline; color:#007330;">QLowEnergyDescriptorData</span></a> classes. These classes act as containers or building blocks for the essential information that comprises the to-be-defined Bluetooth Low Energy service. The code snippet below defines a simple HeartRate service which publishes the measured beats per minute. An example where such a service could be used is a wrist watch.</p>
<p style="-qt-paragraph-type:empty; margin-top:15px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;">  </span><a href="qlowenergycharacteristicdata.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyCharacteristicData</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;"> charData;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  charData.setUuid(</span><a href="qbluetoothuuid.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothUuid</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::HeartRateMeasurement);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  charData.setValue(</span><a href="../qtcore/qbytearray.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QByteArray</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">(2, 0));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  charData.setProperties(</span><a href="qlowenergycharacteristic.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyCharacteristic</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::Notify);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  const </span><a href="qlowenergydescriptordata.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyDescriptorData</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;"> clientConfig(</span><a href="qbluetoothuuid.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothUuid</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::ClientCharacteristicConfiguration,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">                                              </span><a href="../qtcore/qbytearray.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QByteArray</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">(2, 0));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  charData.addDescriptor(clientConfig);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  </span><a href="qlowenergyservicedata.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyServiceData</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;"> serviceData;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  serviceData.setType(</span><a href="qlowenergyservicedata.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyServiceData</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::ServiceTypePrimary);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  serviceData.setUuid(</span><a href="qbluetoothuuid.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothUuid</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::HeartRate);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  serviceData.addCharacteristic(charData);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:15px; margin-bottom:10px; margin-left:15px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">The resulting <span style=" font-family:'Courier,monospace';">serviceData</span> object can be published as described in the <a href="qtbluetooth-le-overview.html#advertising-services"><span style=" text-decoration: underline; color:#007330;">Advertising Services</span></a> section above. Despite the partial information overlap between the information wrapped by <a href="qlowenergyservicedata.html"><span style=" text-decoration: underline; color:#007330;">QLowEnergyServiceData</span></a> and <a href="qlowenergyadvertisingdata.html"><span style=" text-decoration: underline; color:#007330;">QLowEnergyAdvertisingData</span></a> the two classes serve two very different tasks. The advertising data is published to nearby devices and often limited in scope due to its size restriction of 29 bytes. Therefore they are not always 100% complete. By comparison the service data contained inside of <a href="qlowenergyservicedata.html"><span style=" text-decoration: underline; color:#007330;">QLowEnergyServiceData</span></a> provides the complete set of service data and only becomes visible to the connecting client when a connection with an active service discovery has been performed.</p>
<p style=" margin-top:15px; margin-bottom:10px; margin-left:15px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">The next section demonstrates how the service can update the heart rate value. Depending on the nature of the service it may have to comply with the official service definition as defined on <a href="https://www.bluetooth.org"><span style=" text-decoration: underline; color:#007330;">https://www.bluetooth.org</span></a>. Other services may be completely custom. The heart rate service was adopted and its specification can be found under <a href="https://www.bluetooth.com/specifications/adopted-specifications"><span style=" text-decoration: underline; color:#007330;">https://www.bluetooth.com/specifications/adopted-specifications</span></a>.</p>
<p style="-qt-paragraph-type:empty; margin-top:15px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;">  </span><a href="../qtcore/qtimer.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QTimer</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;"> heartbeatTimer;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  </span><a href="../qtcore/qtglobal.html#quint8-typedef"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">quint8</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;"> currentHeartRate = 60;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  enum ValueChange { ValueUp, ValueDown } valueChange = ValueUp;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  const auto heartbeatProvider = [&amp;service, &amp;currentHeartRate, &amp;valueChange]() {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      </span><a href="../qtcore/qbytearray.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QByteArray</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;"> value;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      value.append(char(0)); // Flags that specify the format of the value.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      value.append(char(currentHeartRate)); // Actual value.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      </span><a href="qlowenergycharacteristic.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QLowEnergyCharacteristic</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;"> characteristic</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">              = service-&gt;characteristic(</span><a href="qbluetoothuuid.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QBluetoothUuid</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::HeartRateMeasurement);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      Q_ASSERT(characteristic.isValid());</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      service-&gt;writeCharacteristic(characteristic, value); // Potentially causes notification.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      if (currentHeartRate == 60)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          valueChange = ValueUp;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      else if (currentHeartRate == 100)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          valueChange = ValueDown;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      if (valueChange == ValueUp)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          ++currentHeartRate;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">      else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">          --currentHeartRate;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  };</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  </span><a href="../qtcore/qobject.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QObject</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::connect(&amp;heartbeatTimer, &amp;</span><a href="../qtcore/qtimer.html"><span style=" font-family:'Courier,monospace'; font-weight:600; text-decoration: underline; color:#5caa15; vertical-align:top;">QTimer</span></a><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">::timeout, heartbeatProvider);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; background-color:#f0f0f0;"><span style=" font-family:'Courier,monospace'; font-weight:600; vertical-align:top;">  heartbeatTimer.start(1000);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:35px; margin-right:85px; -qt-block-indent:0; text-indent:0px; font-family:'Courier,monospace'; font-weight:600; background-color:#f0f0f0; vertical-align:top;"><br /></p>
<p style=" margin-top:15px; margin-bottom:10px; margin-left:15px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">In general characteristic and descriptor value updates on the peripheral device use the same methods as connecting Bluetooth Low Energy devices. </p></body></html>
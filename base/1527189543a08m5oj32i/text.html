<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Зачем?</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#000000;">В </span><a href="mytetra://note/1527189472rbt8ecyx9b"><span style=" text-decoration: underline; color:#0000ff;">прошлой заметке</span></a><span style=" color:#000000;"> мы с</span>обрали под Windows минималистичный комплект библиотек Qt 4.8.6 для статической компоновки со своими программами. А что делать, если нужны новые возможности Qt 5? Мне вот, например, понадобился модуль QtNetworkAuth, который был добавлен в Qt 5.8 и в последующих версиях <a href="http://www.prog.org.ru/index.php?topic=25815.msg235109#msg235109"><span style=" text-decoration: underline; color:#0000ff;">активно правился</span></a>. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Итак, соберём последнюю на сегодня Qt 5.10. Компилятор возьмём MinGW 5.3.0 (т.е. тот же самый, который кутешники поставляют с уже готовой сборкой qt-opensource-windows-x86-5.10.0.exe). </p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Что новенького?</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В целом процесс сборки похож на описанный в предыдущей заметке, но имеются и отличия:</p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для сборки Qt теперь нужен Python 2 (не 3!). Вероятно, это как раз плата за возможность обойти без сувания configure.exe в исходники. Интерпретатор Питона надо включить в PATH. Если Вы программист и время от времени сношаетесь работаете с разными фреймворками и тулкитами, вполне возможно, что подходящий python.exe у Вас уже есть (в моём примере как раз так). В противном случае - поставьте его отдельно и укажите путь.</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вместо configure.exe теперь поставляется configure.bat. Чтобы после configure отработал make, в пакетном файле configure надо вызвать через call.</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">По той же причине у configure не работает ключ /? - для составления списка ключей надо писать configure.bat /help &gt;configure-options.txt.</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Явное указание QMAKESPEC=win32-g++ не нужно и более того, не работает. Вымарываем (как и несколько устаревших ключей самого configure).</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для сборки надо явно указать способ поддержки openGL, иначе Qt не соберётся. Наиболее общий способ для обычной винды - ключ -opengl desktop. Если нужна эффективная работа с openGL, целесообразнее использовать -opengl es2 (в Windows является режимом по умолчанию), но при этом придётся доустанавилвать заголовки и библиотеки для GL ES2, но с этим вариантом я ещё не разбирался.</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">По окончании работы необходимо выполнить make install. </li></ol>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">С учётом написанного, наш новый пакетный файл, <span style=" font-weight:600;">buildstat-510.bat</span>, примет примерно такой вид: </p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-style:italic;">SET QTDIR=c:\Qt\5.10.0.st</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-style:italic;">SET MINGWDIR=C:\Qt\5.10.0\Tools\mingw530_32</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-style:italic;">SET PYTHON2DIR=C:\QNX650\host\win32\x86\unsupported\Python25</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-style:italic;">SET PATH=%PATH%;%QTDIR%\bin;%MINGWDIR%\bin;%PYTHON2DIR%</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-style:italic;">call configure -I &quot;c:\Qt\3dparty\openssl-1.0.2m\include&quot; -L &quot;c:\Qt\3dparty\openssl-1.0.2m&quot; -opensource -confirm-license -platform win32-g++ -static -release -opengl desktop -qt-zlib -qt-libpng -qt-libjpeg -openssl -nomake examples -prefix %QTDIR%</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-style:italic;">mingw32-make</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-style:italic;">mingw32-make install</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Но я рекомендую пойти дальше и собрать OpenSSL более новой версии, благо Qt5 с ними уже вполне совместима.</p></body></html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:10pt; font-weight:400; font-style:normal;">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Беседы о Qt. Парадигма Model-View</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Мы остановились на необходимости ознакомиться с парадигмой «Модель Вид» (Model View). </p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image594871597.png" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="more-15191"></a>Можно рассматривать модель как средство предоставления данных некоторым образом, а вид — как средство их отображения. Например, есть стандартная модель для списка строк — QStringListModel. А также есть модель, отражающая содержимое файловой системы, -QDirModel. QStandardItemModel — это многофункциональная модель. С последним классом мы и будем разбираться. Вот простейший пример использования этой модели — строим на ее основе список строк: </p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">QStandardltemModel </span><span style=" font-family:'monospace'; color:#000040;">*</span><span style=" font-family:'monospace';">model </span><span style=" font-family:'monospace'; color:#000080;">=</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#0000dd;">new</span><span style=" font-family:'monospace';"> QStandardItemModel </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#0000dd;">this</span><span style=" font-family:'monospace'; color:#008000;">)</span><span style=" font-family:'monospace'; color:#008080;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">model</span><span style=" font-family:'monospace'; color:#000040;">-</span><span style=" font-family:'monospace'; color:#000080;">&gt;</span><span style=" font-family:'monospace';">appendRow </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#0000dd;">new</span><span style=" font-family:'monospace';"> QStandardltem </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#ff0000;">&quot;one&quot;</span><span style=" font-family:'monospace'; color:#008000;">))</span><span style=" font-family:'monospace'; color:#008080;">;</span><span style=" font-family:'monospace';"> model</span><span style=" font-family:'monospace'; color:#000040;">-</span><span style=" font-family:'monospace'; color:#000080;">&gt;</span><span style=" font-family:'monospace';">appendRow </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#0000dd;">new</span><span style=" font-family:'monospace';"> QStandardItem </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#ff0000;">&quot;two&quot;</span><span style=" font-family:'monospace'; color:#008000;">))</span><span style=" font-family:'monospace'; color:#008080;">;</span><span style=" font-family:'monospace';"> model</span><span style=" font-family:'monospace'; color:#000040;">-</span><span style=" font-family:'monospace'; color:#000080;">&gt;</span><span style=" font-family:'monospace';">appendRow </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#0000dd;">new</span><span style=" font-family:'monospace';"> QStandardltem </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#ff0000;">&quot;three&quot;</span><span style=" font-family:'monospace'; color:#008000;">))</span><span style=" font-family:'monospace'; color:#008080;">;</span><span style=" font-family:'monospace';"> model</span><span style=" font-family:'monospace'; color:#000040;">-</span><span style=" font-family:'monospace'; color:#000080;">&gt;</span><span style=" font-family:'monospace';">appendRow </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#0000dd;">new</span><span style=" font-family:'monospace';"> QStandardItem </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#ff0000;">&quot;four&quot;</span><span style=" font-family:'monospace'; color:#008000;">))</span><span style=" font-family:'monospace'; color:#008080;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">QTreeView </span><span style=" font-family:'monospace'; color:#000040;">*</span><span style=" font-family:'monospace';">tv </span><span style=" font-family:'monospace'; color:#000080;">=</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#0000dd;">new</span><span style=" font-family:'monospace';"> QTreeView </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#0000dd;">this</span><span style=" font-family:'monospace'; color:#008000;">)</span><span style=" font-family:'monospace'; color:#008080;">;</span><span style=" font-family:'monospace';"> tv</span><span style=" font-family:'monospace'; color:#000040;">-</span><span style=" font-family:'monospace'; color:#000080;">&gt;</span><span style=" font-family:'monospace';">setModel </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace';">model</span><span style=" font-family:'monospace'; color:#008000;">)</span><span style=" font-family:'monospace'; color:#008080;">;</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Итак, вначале создается экземпляр модели, затем в нее добавляются четыре элемента со строковыми значениями one, two, three, four. После этого создается виджет отображения модели (экземпляр QTreeView) и модель назначается ему. Обратите внимание: вместо QTreeView можно использовать и другой виджет представления — QListView:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">QListView *lv = new QListView (this);</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">lv-&gt;setModel (model);</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Разница — в том, что QListView не умеет отображать сложные списки (например, деревья или состоящие из нескольких колонок). Зато в QListView есть два режима отображения: обычным списком строк и в виде иконок. Но вернемся к модели и посмотрим на вызов функции: </p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">model</span><span style=" font-family:'monospace'; color:#000040;">-</span><span style=" font-family:'monospace'; color:#000080;">&gt;</span><span style=" font-family:'monospace';">appendRow </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#0000dd;">new</span><span style=" font-family:'monospace';"> QStandardltem </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#ff0000;">&quot;one&quot;</span><span style=" font-family:'monospace'; color:#008000;">))</span><span style=" font-family:'monospace'; color:#008080;">;</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Функция appendRow() добавляет в модель новый ряд с элементом, переданным в качестве параметра. Можно передать несколько элементов — список, — таким образом создается ряд с несколькими колонками.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Пример:</span> </p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">QList</span><span style=" font-family:'monospace'; color:#000080;">&lt;</span><span style=" font-family:'monospace';">QStandardItem </span><span style=" font-family:'monospace'; color:#000040;">*</span><span style=" font-family:'monospace'; color:#000080;">&gt;</span><span style=" font-family:'monospace';"> items</span><span style=" font-family:'monospace'; color:#008080;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">items.</span><span style=" font-family:'monospace'; color:#007788;">append</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#0000dd;">new</span><span style=" font-family:'monospace';"> QStandardltem </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#ff0000;">&quot;column 0&quot;</span><span style=" font-family:'monospace'; color:#008000;">))</span><span style=" font-family:'monospace'; color:#008080;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">items.</span><span style=" font-family:'monospace'; color:#007788;">append</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#0000dd;">new</span><span style=" font-family:'monospace';"> QStandardltem </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#ff0000;">&quot;column 1&quot;</span><span style=" font-family:'monospace'; color:#008000;">))</span><span style=" font-family:'monospace'; color:#008080;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">items.</span><span style=" font-family:'monospace'; color:#007788;">append</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#0000dd;">new</span><span style=" font-family:'monospace';"> QStandardltem </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#ff0000;">&quot;column 2&quot;</span><span style=" font-family:'monospace'; color:#008000;">))</span><span style=" font-family:'monospace'; color:#008080;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">model</span><span style=" font-family:'monospace'; color:#000040;">-</span><span style=" font-family:'monospace'; color:#000080;">&gt;</span><span style=" font-family:'monospace';">appendRow </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace';">items</span><span style=" font-family:'monospace'; color:#008000;">)</span><span style=" font-family:'monospace'; color:#008080;">;</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Замечу, что это следует отображать в QTreeView. Пример у нас — весьма упрощенный. Что будет, если требуется особо оформить каждый элемент, например первую колонку выводить жирным шрифтом?</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">QList items;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">QStandardltem *item = new QStandardItem («column 0″);</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">QFont f = item-&gt;font(); f.setBold (true); item-&gt;setFont(f); items. append (item);</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">items.append (new QStandardItem («column 1″)); items.append (new QStandardItem («column 2″));</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">model-&gt;appendRow (items);</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Как видно, с экземпляром QStandardltem можно проделывать разные интересные вещи: менять его шрифт, цвет, устанавливать флаги доступа:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">item-&gt;setFlags (Qt:: ItemIsSelectable | Qt:: ItemIsEnabled);</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В этом примере мы разрешаем выделение элемента. Можем и запретить, не указывая флаг Qt::ItemIsSelectable. QStandardltem оснащен теми же методами, что и модель — в него тоже добавляются ряды и колонки. Давайте создадим вложенный элемент для первой колонки: </p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">QList</span><span style=" font-family:'monospace'; color:#000080;">&lt;</span><span style=" font-family:'monospace';">QStandardItem </span><span style=" font-family:'monospace'; color:#000040;">*</span><span style=" font-family:'monospace'; color:#000080;">&gt;</span><span style=" font-family:'monospace';"> items</span><span style=" font-family:'monospace'; color:#008080;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">QStandardItem </span><span style=" font-family:'monospace'; color:#000040;">*</span><span style=" font-family:'monospace';">item </span><span style=" font-family:'monospace'; color:#000080;">=</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#0000dd;">new</span><span style=" font-family:'monospace';"> QStandardItem </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#ff0000;">&quot;item 0&quot;</span><span style=" font-family:'monospace'; color:#008000;">)</span><span style=" font-family:'monospace'; color:#008080;">;</span><span style=" font-family:'monospace';"> item</span><span style=" font-family:'monospace'; color:#000040;">-</span><span style=" font-family:'monospace'; color:#000080;">&gt;</span><span style=" font-family:'monospace';">appendRow </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#0000dd;">new</span><span style=" font-family:'monospace';"> QStandardItem </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#ff0000;">&quot;subitem 0&quot;</span><span style=" font-family:'monospace'; color:#008000;">))</span><span style=" font-family:'monospace'; color:#008080;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">items. </span><span style=" font-family:'monospace'; color:#007788;">append</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace';">item</span><span style=" font-family:'monospace'; color:#008000;">)</span><span style=" font-family:'monospace'; color:#008080;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">items.</span><span style=" font-family:'monospace'; color:#007788;">append</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#0000dd;">new</span><span style=" font-family:'monospace';"> QStandardItem </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#ff0000;">&quot;item 1&quot;</span><span style=" font-family:'monospace'; color:#008000;">))</span><span style=" font-family:'monospace'; color:#008080;">;</span><span style=" font-family:'monospace';"> items.</span><span style=" font-family:'monospace'; color:#007788;">append</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#0000dd;">new</span><span style=" font-family:'monospace';"> QStandardItem </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#ff0000;">&quot;item 2&quot;</span><span style=" font-family:'monospace'; color:#008000;">))</span><span style=" font-family:'monospace'; color:#008080;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">model</span><span style=" font-family:'monospace'; color:#000040;">-</span><span style=" font-family:'monospace'; color:#000080;">&gt;</span><span style=" font-family:'monospace';">appendRow </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace';">items</span><span style=" font-family:'monospace'; color:#008000;">)</span><span style=" font-family:'monospace'; color:#008080;">;</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Итак, вызовом:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">item-&gt;appendRow (new QStandardItem («subitem 0″));</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">мы добавляем новый элемент subitem 0 как ряд к элементу item. В свою очередь к новосозданному элементу тоже можно добавлять элементы — так получается древовидная иерархия. Вот еще одна, более классическая иерархия — два корневых элемента, у каждого из которых есть внутренние элементы:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">QStandardItem *item = new QStandardItem («animals»); item-&gt;appendRow (new QStandardItem («dog»)); item-&gt;appendRow (new QStandardItem («cat»)); item-&gt;appendRow (new QStandardItem («cow»)); model-&gt;appendRow (item);</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">item = new QStandardItem («games»); item-&gt;appendRow (new QStandardItem («Fallout»)); item-&gt;appendRow (new QStandardItem («Doom»)); item-&gt;appendRow (new QStandardItem («Quake»)); model-&gt;appendRow (item);</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Экземпляры QStandardItem весьма универсальны, и в большинстве случаев нет нужды создавать свои классы для представления элементов. Объект QStandardItem может содержать текст, иконку или checkbox. Как уже сообщалось, у такого объекта можно менять значения свойств вроде цвета, шрифта.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">С созданием и наполнением модели мы немного разобрались. Теперь посмотрим, как получать данные — например, выделенный элемент и тому подобное.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Во-первых, научимся получать из модели нужные нам элементы. Для «плоского» списка строк сделать это довольно просто: достаточно обратиться к функции QStandardItemModel::findItems(), которая возвращает список элементов, текст коих соответствует заданному вами критерию. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В примере ниже мы получаем такой список (критерий — текст column 1), проходим по нему в цикле и выводим текст найденных элементов:</p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">QList list = model-&gt;findItems («column 1″, J Qt::MatchExactly | Qt::MatchRecursive);</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">foreach (QStandardItem *item, list) qDebug() &lt;&lt; item-&gt;text();</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обратите внимание на флаг Qt::MatchRecursive. Он указывает, что поиск будет проводиться по всей иерархии, а не только в элементах корневого уровня.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Теперь представим, что мы хотим сделать текущим элемент с заданной надписью: </p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">QList</span><span style=" font-family:'monospace'; color:#000080;">&lt;</span><span style=" font-family:'monospace';">QStandardItem </span><span style=" font-family:'monospace'; color:#000040;">*</span><span style=" font-family:'monospace'; color:#000080;">&gt;</span><span style=" font-family:'monospace';"> list </span><span style=" font-family:'monospace'; color:#000080;">=</span><span style=" font-family:'monospace';"> model</span><span style=" font-family:'monospace'; color:#000040;">-</span><span style=" font-family:'monospace'; color:#000080;">&gt;</span><span style=" font-family:'monospace';">findItems </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace'; color:#ff0000;">&quot;dog&quot;</span><span style=" font-family:'monospace';">, J Qt</span><span style=" font-family:'monospace'; color:#008080;">::</span><span style=" font-family:'monospace'; color:#007788;">MatchExactly</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000040;">|</span><span style=" font-family:'monospace';"> Qt</span><span style=" font-family:'monospace'; color:#008080;">::</span><span style=" font-family:'monospace'; color:#007788;">MatchRecursive</span><span style=" font-family:'monospace'; color:#008000;">)</span><span style=" font-family:'monospace'; color:#008080;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">QModelIndex index</span><span style=" font-family:'monospace'; color:#008080;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#0000ff;">if</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace';">list.</span><span style=" font-family:'monospace'; color:#007788;">size</span><span style=" font-family:'monospace'; color:#008000;">()</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">&gt;</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#0000dd;">0</span><span style=" font-family:'monospace'; color:#008000;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">index </span><span style=" font-family:'monospace'; color:#000080;">=</span><span style=" font-family:'monospace';"> model</span><span style=" font-family:'monospace'; color:#000040;">-</span><span style=" font-family:'monospace'; color:#000080;">&gt;</span><span style=" font-family:'monospace';">indexFromItem </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace';">list</span><span style=" font-family:'monospace'; color:#008000;">[</span><span style=" font-family:'monospace'; color:#0000dd;">0</span><span style=" font-family:'monospace'; color:#008000;">])</span><span style=" font-family:'monospace'; color:#008080;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">tv</span><span style=" font-family:'monospace'; color:#000040;">-</span><span style=" font-family:'monospace'; color:#000080;">&gt;</span><span style=" font-family:'monospace';">selectionModel</span><span style=" font-family:'monospace'; color:#008000;">()</span><span style=" font-family:'monospace'; color:#000040;">-</span><span style=" font-family:'monospace'; color:#000080;">&gt;</span><span style=" font-family:'monospace';">setCurrentIndex </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace';">index, J QItemSelectionModel</span><span style=" font-family:'monospace'; color:#008080;">::</span><span style=" font-family:'monospace'; color:#007788;">Select</span><span style=" font-family:'monospace'; color:#008000;">)</span><span style=" font-family:'monospace'; color:#008080;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">tv</span><span style=" font-family:'monospace'; color:#000040;">-</span><span style=" font-family:'monospace'; color:#000080;">&gt;</span><span style=" font-family:'monospace';">scrollTo </span><span style=" font-family:'monospace'; color:#008000;">(</span><span style=" font-family:'monospace';">index</span><span style=" font-family:'monospace'; color:#008000;">)</span><span style=" font-family:'monospace'; color:#008080;">;</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Думаю, всё ясно: получаем список элементов, на которых написано dog (а такой элемент у нас один). Далее нам для элемента понадобился соответствующий ему объект QModelIndex. QModelIndex — это служебный класс для работы с положением элемента в иерархии. Поскольку у нас пример простой и мы заранее знаем, что искомый элемент у нас только один — значит, он находится в первом элементе списка, то есть доступен в list[0]. Вызываем с ним model-&gt;indexFromItem(), получаем модельный индекс. Что с ним делать дальше? У QTreeView есть особая модель для операций с выделением элементов. В QStandardItemModel нет таких функций, а вот у QItemSelectionModel они есть. И для обращения к указателю на экземпляр этой модели мы воспользовались функцией selectionModel():</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">tv-&gt;selectionModel()-&gt;setCurrentIndex (index, J QItemSelectionModel::Select);</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Таким образом, мы вызвали функцию QItemSelectionModel:: setCurrentIndex(), чтобы сделать текущим элемент по модельному индексу index. И последний росчерк пера — вызов QTreeView:: scrollTo() для прокрутки видимой области к заданному индексу:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">tv-&gt;scrollTo (index);</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Класс QItemSelectionModel пригодится также, чтобы узнать индекс текущего элемента — он возвращается функцией currentIndex(). Получим текст выделенного элемента:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">QModelIndex index = tv-&gt;selectionModel()-&gt;currentIndex();</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">QString item_ string = index.data().toString();</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для обращения к множеству выделенных элементов существуют функции selectedColumns (колонки по указанному ряду), selectedRows (индексы по колонке) и selectedIndexes (без критерия). Например, если модель представляет список файлов, то каждый ряд состоит из столбцов «имя файла», «размер», «дата», но вам нужно получить только выделенные имена (без размера и даты), то пишем примерно такой код:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">QModelIndexList il = tree_view-&gt;selectionModel()-&gt; J QItemSelectionModel::selectedRows (0);</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">foreach (QModelIndex index, il)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">{</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">qDebug() &lt;&lt; index.data() .toString();</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">}</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Функция selectedRows() вернула нам в виде QModelIndexList список выделенных индексов из нулевой колонки - именно в ней имена файлов. Затем в цикле проходим по списку и выводим на консоль названия элементов. Не буду описывать сигналы, которые посылает QTreeView при выборе элемента, и тому подобное - для этого есть документация. Коснусь тонкостей работы с моделью и представлением.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Перед любыми действиями с моделью, если она уже подключена к виджету отображения, модель лучше отключить от этого виджета. Вот так:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">tree_view-&gt;setModel (0);</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">А обновив модель, потом снова подключить:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">tree_view-&gt;setModel (model);</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Зачем? Каждое изменение модели приводит к отрисовке виджета отображения. Представьте теперь, что вы в цикле заполняете модель тысячью элементов. Виджет обновится тысячу раз. А при отключенной модели вы спокойно обновляете модель, затем подключаете ее к виджету, и тогда-то он рисует разом все элементы. После такого подключения обязательно снова переназначьте все сигналы, связанные с моделью selectionModel() виджета просмотра. Например:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">connect (tree_view-&gt;selectionModel(), SIGNAL(currentChanged J (const QModellndex &amp;, const QModellndex &amp;)), this, J SLOT(my_currentChanged ( const QModellndex &amp;, J const QModellndex &amp;)));</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для управления шириной колонок используйте объект-заголовок, возвращаемый виджетом отображения через функцию header(). Например:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">tree_view-&gt;header()-&gt;setResizeMode J (QHeaderView: :ResizeToContents);</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Функция header() у QTreeView возвращает указатель на используемый в виджете заголовок. Он является экземпляром класса QHeaderView. Изучите его подробно, потому что именно в нем заключены многие функции отображения не просто заголовка, но и содержимого модели вообще. Например, если вызвать функцию setStretchLastSection с параметром true, то последняя колонка в списке будет растянута до конца рабочей области виджета.</p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:10pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:xx-large; font-weight:600;">Модуль Apache mod_rewrite</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Реализует механизм основанный на правилах для преобразования на лету для запрошенных URLs Расширение mod_rewrite. c rewrite_module Доступен в Apache 1. 3 и более поздних версиях </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;">«Главное преимущество mod_rewrite — настраиваемость и гибкость Sendmail. Обратная сторона mod_rewrite — настраиваемость и гибкость Sendmail». </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;">-- Brian Behlendorf<br />Apache Group</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;">«Несмотря на тонны примеров и документацию, mod_rewrite это Вуду. Чертовски клёвый Вуду, но все-таки Вуду. &quot; </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;">-- Brian Moore<br />bem@news. cmc. net</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Добро пожаловать в мир mod_rewrite, швейцарский нож URL преобразований! </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Данный модуль представляет собой основанный на правилах механизм (синтаксический анализатор с применением регулярных выражений), выполняющий URL преобразования на лету. Модуль поддерживает неограниченное количество правил и связанных с каждым правилом условий, реализуя действительно гибкий и мощный механизм управления URL. URL преобразования могут использовать разные источники данных, например переменные сервера, переменные окружения, HTTP заголовки, время и даже запросы к внешним базам данных в разных форматах, — для получения URL нужного вам вида. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Этот модуль оперирует с полными URL (включая path-info) и в контексте сервера (<span style=" font-family:'Courier New,courier';">httpd.conf</span>) и в контексте каталога (<span style=" font-family:'Courier New,courier';">.htaccess</span>) и даже может генерировать части строки запроса в качестве результата. Преобразованный результат может приводить к внутренней обработке, внешнему перенаправлению запроса или даже к прохождению через внутренний прокси модуль. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Но, вся эта функциональность и гибкость имеет свой недостаток - сложность. Поэтому, не думайте что вы поймете работу модуля за один день. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Этот модуль был придуман и написан в апреле 1996 и эксклюзивно подарен The Apache Group в июле 1997 </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#000000;">Ralf S. Engelschall<br />rse@engelschall.com<br />www.engelschall.com </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000;"><br /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="Internal"></a><span style=" font-size:x-large; font-weight:600;">В</span><span style=" font-size:x-large; font-weight:600;">нутренние процессы</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Внутренние процессы в этом модуле очень сложны, однако, их нужно объяснить хотя бы раз, и даже обычному пользователю, во избежание распространённых ошибок и раскрытия всей его функциональности. </p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="InternalAPI"></a><span style=" font-size:large; font-weight:600;">Ф</span><span style=" font-size:large; font-weight:600;">азы API</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для начала, нужно просто понять, что обработку какого-либо HTTP запроса, сервер Apache делает в фазах. Перехватчик этих фаз обеспечивается Apache API. Mod_rewrite использует 2 из этих перехватчиков: транслятор из URL в имя файла используемый после считывания HTTP запроса, но до начала какой-либо авторизации и перехватчик адресной привязки начинающий работать после фаз авторизации и считывания конфигурационных файлов каталога (<span style=" font-family:'Courier New,courier';">.htaccess</span>), но до активизации обработчика содержания. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Поэтому, после поступления запроса и определения Apache'ем соответствующего сервера (или виртуального сервера) механизм преобразований начинает обработку всех директив mod_rewrite из конфигурационного файла сервера в фазе трансляции из URL в имя файла. Несколько шагов спустя, когда находятся каталоги с конечными данными, конфигурационные директивы mod_rewrite запускаются в фазе адресной привязки. В обоих этих ситуациях mod_rewrite преобразует URL, либо в новые URL, либо в имена файлов, хотя между ними нет объективных различий. При создании API, не предполагалось его использование таким образом, однако что касается Apache 1.x это единственный возможный способ работы mod_rewrite. Чтобы внести больше ясности запомните 2 вещи: </p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Хотя mod_rewrite и преобразует URL в URL, URL в имена файлов и даже имена файлов в имена файлов, в настоящий момент API предоставляет только перехватчик для преобразования URL в имя файла. Во 2-м Apache будут добавлены 2 отсутствующих перехватчика для того, чтобы сделать этот процесс более логичным. Однако это никак не влияет на пользователя, - просто этот факт надо запомнить: Apache в перехватчике URL имя файла делает больше нежели чем это подразумевается в API. </li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Бесподобный mod_rewrite проделывает URL преобразования и в контексте каталога, <span style=" font-style:italic;">т.е.</span> в файлах <span style=" font-family:'Courier New,courier';">.htaccess</span>, хотя они и обрабатываются намного позже трансляции URL в имена файлов. Так должно быть, потому что <span style=" font-family:'Courier New,courier';">.htaccess</span> файлы находятся в файловой системе, и поэтому обработка уже дошла до этой стадии. Другими словами: Согласно фазам API, - в это время уже слишком поздно управлять URL. Чтобы решить проблему курицы и яйца, mod_rewrite использует хитрость: когда вы манипулируете URL/именем файла в контексте каталога, mod_rewrite сначала преобразует имя файла обратно, к соответствующему ему URL (что обычно невозможно, однако, смотрите директиву <span style=" font-family:'Courier New,courier';">RewriteBase</span> чуть ниже, где написано как это сделать) и затем инициирует новый внутренний подзапрос с этим новым URL. Это перезапускает процесс обработки фаз API. </li></ol>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">И снова mod_rewrite упорно пытается сделать этот сложный шаг полностью прозрачным для пользователя, однако здесь вам следует запомнить: в то время как манипуляции с URL контексте сервера действительно быстры и эффективны, манипуляции в контексте каталога медленны и неэффективны из-за проблемы курицы и яйца. Однако, с другой стороны это единственный возможный путь работы mod_rewrite (локально ограниченный) для URL преобразований, доступный обычному пользователю. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Не забывайте 2 эти вещи! </p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="InternalRuleset"></a><span style=" font-size:large; font-weight:600;">О</span><span style=" font-size:large; font-weight:600;">бработка наборов правил</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Запускаясь в этих двух фазах API, mod_rewrite считывает конфигурационные наборы правил из своей конфигурационной структуры (создаваемой либо один раз при запуске сервера, - для контекста сервера, либо каждый раз при обходе ядром Apache каталогов, - для контекста каталога). Затем запускается механизм URL преобразований с уже имеющимся набором правил (правило(а) вместе со своими условиями). Функционирование самого механизма преобразований в точности одинаково для обоих контекстов конфигурации. Различаются только конечные результы обработки. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Порядок правил в наборе важен потому что механизм преобразований обрабатывает их в специальном (и не очень очевидном) порядке. <a href="http://www.egoroff.spb.ru/portfolio/mod_rewrite.html#rewriterule"><span style=" font-family:'Courier New,courier'; text-decoration: underline; color:#0000ff;">RewriteRule</span></a> директивы просматриваются механизмом преобразований строчка за строчкой и при нахождении соответствия конкретному правилу просматриваются относящиеся к этому правилу условия (<span style=" font-family:'Courier New,courier';">RewriteCond</span> директивы). По историческим причинам условия находятся перед правилами, отсюда длиннее последовательность выполнения команд. На рис. 1 это показано подробнее.</p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image445619397.png" /><br /><span style=" font-weight:600; font-style:italic;">Рисунок 1:</span>Последовательность выполнения комад при обработке набора правил </p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Как вы можете видеть, сначала URL сравнивается с <span style=" font-style:italic;">Шаблон</span> для каждого из правил. При неудаче mod_rewrite сразу же останавливает обработку этого правила и продолжает работу, используя следующее правило. Если <span style=" font-style:italic;">Шаблон</span> совпадает, mod_rewrite ищет соответствующие этому правилу условия. Если их нет, он просто заменяет URL новой величиной полученной из строки <span style=" font-style:italic;">Подстановка</span> и продолжает дальше обрабатывать правила. Однако если существуют условия, запускается внутренний цикл для их обработки в том порядке в котором они перечислены. Для условий эта логика другая: мы не сравниваем URL на соответствие какому-либо шаблону. Вместо этого мы сначала создаем строку <span style=" font-style:italic;">СравниваемаяСтрока</span> дополняя её переменными, обратными ссылками, запросами в базы данных, <span style=" font-style:italic;">и т.д.</span> и затем пытаемся проверять на соответствие с <span style=" font-style:italic;">Условие</span>. Если шаблон не соответствует, весь набор условий и соответствующих правил считается несоответствующим условию. Если есть соответствие шаблону, в этом случае производится обработка следующего условия до тех пор пока они будут не исчерпаны. Если все условия совпадают, процесс обработки продолжается с использованием для URL подстановки данных из поля <span style=" font-style:italic;">Подстановка</span>. </p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="quoting"></a><span style=" font-size:large; font-weight:600;">Э</span><span style=" font-size:large; font-weight:600;">кранирование специальных символов</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Что касается Apache 1.3.20, специальные символы в <span style=" font-style:italic;">СравниваемаяСтрока</span> и <span style=" font-style:italic;">Подстановка</span> строках могут быть экранированы (имеется ввиду, отношение к ним как к нормальным символам без их обычного специального значения) путем предшествующего им символа слеша ('\'). Другими словами, вы можете включать символ доллара в строку <span style=" font-style:italic;">Подстановка</span> используя '<span style=" font-family:'Courier New,courier';">\$</span>'; это не позволит mod_rewrite относиться к нему как к обратной ссылке. </p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="InternalBackRefs"></a><span style=" font-size:large; font-weight:600;">Н</span><span style=" font-size:large; font-weight:600;">аличие обратных связей в регулярных выражениях</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Здесь нужно запомнить одну важную вещь: Всякий раз, когда вы используете круглые скобки в <span style=" font-style:italic;">Шаблон</span> или в одном из <span style=" font-style:italic;">Условие</span>, создаются внутренние обратные связи которые могут быть использованы со строками <span style=" font-family:'Courier New,courier';">$N</span> и <span style=" font-family:'Courier New,courier';">%N</span> (см. ниже). Они полезны при создании строк <span style=" font-style:italic;">Подстановка</span> и <span style=" font-style:italic;">СравниваемаяСтрока</span>. Рисунок 2 показывает в какие места при дополнении (строк <span style=" font-style:italic;">Подстановка</span> и <span style=" font-style:italic;">СравниваемаяСтрока</span>) перемещаются обратные связи.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> </p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image4401468.png" /><br /><span style=" font-weight:600; font-style:italic;">Рисунок 2:</span> Движение обратных связей в правиле. </p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Итак, - это был неподъёмный курс по внутренним механизмам mod_rewrite, но он вам сильно поможет при дальнейшем чтении документации по данному модулю. </p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="EnvVar"></a><span style=" font-size:x-large; font-weight:600;">П</span><span style=" font-size:x-large; font-weight:600;">еременные окружения</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Этот модуль отслеживает две дополнительные (нестандартные) переменные окружения CGI/SSI называемые <span style=" font-family:'Courier New,courier';">SCRIPT_URL</span> и <span style=" font-family:'Courier New,courier';">SCRIPT_URI</span>. Они содержат <span style=" font-style:italic;">логическое</span> представление текущего ресурса, т.е. то, каким вы видите это в адресной строке браузера, в то время как стандартные переменные CGI/SSI <span style=" font-family:'Courier New,courier';">SCRIPT_NAME</span> и <span style=" font-family:'Courier New,courier';">SCRIPT_FILENAME</span> содержат <span style=" font-style:italic;">физическое</span> или системное представление. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Замечание: эти переменные содержат URI/URL <span style=" font-style:italic;">в том виде, в котором они были первоначально запрошены</span>, <span style=" font-style:italic;">т.е.</span>, <span style=" font-style:italic;">перед</span> тем как были сделаные какие-либо преобразования. Это важно, ибо процесс преобразования в первую очередь используется для преобразования логических URL в физические пути к конкретным файлам. </p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Пример</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">SCRIPT_NAME=/sw/lib/w3s/tree/global/u/rse/.www/index.html</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">SCRIPT_FILENAME=/u/rse/.www/index.html</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">SCRIPT_URL=/u/rse/</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">SCRIPT_URI=http://en1.engelschall.com/u/rse/ </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="Solutions"></a><span style=" font-size:x-large; font-weight:600;">П</span><span style=" font-size:x-large; font-weight:600;">рактические решения</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В <a href="http://www.egoroff.spb.ru/portfolio/apache/rewriteguide.html"><span style=" text-decoration: underline; color:#0000ff;">Руководстве по преобразованиям URL</span></a> представлена коллекция практических решений проблем URL преобразований. Там можно найти наборы правил взятые из реальной жизни и дополнительную информацию о mod_rewrite. </p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="rewriteengine"></a><span style=" font-size:x-large; font-weight:600;">Д</span><span style=" font-size:x-large; font-weight:600;">иректива RewriteEngine</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Описание: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Включает или выключает работу механизма преобразования</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Синтаксис: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">RewriteEngine on|off</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Значение по умолчанию: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteEngine off</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Контекст: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">server configvirtual host directory.htaccess</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Разрешение: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">FileInfo</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Статус: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Расширение</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Модуль: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">mod_rewrite </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Директива <span style=" font-family:'Courier New,courier';">RewriteEngine</span> включает или выключает работу механизма преобразований. Если она установлена в положение <span style=" font-family:'Courier New,courier';">off</span> этот модуль совсем не работает. Он даже не обновляет переменные окружения <span style=" font-family:'Courier New,courier';">SCRIPT_URx</span>. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Используйте эту директиву для выключения этого модуля вместо простого закомментирования директив <a href="http://www.egoroff.spb.ru/portfolio/mod_rewrite.html#rewriterule"><span style=" font-family:'Courier New,courier'; text-decoration: underline; color:#0000ff;">RewriteRule</span></a>! </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Отметьте, что по-умолчанию, настройки преобразований не наследуются. Это означает что вы должны иметь <span style=" font-family:'Courier New,courier';">RewriteEngine on</span> директиву для каждого виртуального хоста в котором вы хотите использовать этот модуль. </p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="rewriteoptions"></a><span style=" font-size:x-large; font-weight:600;">Д</span><span style=" font-size:x-large; font-weight:600;">иректива RewriteOptions</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Описание: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Устанавливает кое-какие специальные опции для механизма преобразований</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Синтаксис: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">RewriteOptions <span style=" font-style:italic;">Options</span> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Значение по умолчанию: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">None</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Контекст: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">server configvirtual host directory.htaccess</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Разрешение: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">FileInfo</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Статус: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Расширение</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Модуль: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">mod_rewrite </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Директива <span style=" font-family:'Courier New,courier';">RewriteOptions</span> устанавливает некоторые специальные опции для текущей конфигурации в контексте сервера или каталога. Строки <span style=" font-style:italic;">Option</span> могут иметь следующий вид: </p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-family:'Courier New,courier'; font-weight:600;">inherit</span>'<br />Это приводит в действие наследование текущей конфигурацией конфигурации родителя. В контексте виртуального сервера это означает что ассоциативные массивы, условия и правила основного сервера наследуются. В контексте каталога это означает что условия и правила в конфигурационных файлах <span style=" font-family:'Courier New,courier';">.htaccess</span> родительских каталогов наследуются. </li></ul>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="rewritelog"></a><span style=" font-size:x-large; font-weight:600;">Д</span><span style=" font-size:x-large; font-weight:600;">иректива RewriteLog</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Описание: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Устанавливает имя файла используемое для ведения журнала механизма преобразования</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Синтаксис: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">RewriteLog <span style=" font-style:italic;">file-path</span> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Контекст: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">server configvirtual host </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Статус: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Расширение</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Модуль: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">mod_rewrite </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Директива <span style=" font-family:'Courier New,courier';">RewriteLog</span> устанавливает имя файла а котором сервер ведет журнал любых происходящих действий по преобразованиям URL. Если это имя не начинается со слэша ('<span style=" font-family:'Courier New,courier';">/</span>') в этом случае путь считается от <span style=" font-style:italic;">Server Root</span>. В конфигурационном файле сервера эта директива должна встречаться только один раз. </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для отключения ведения журнала преобразований не рекомендуется устанавливать <span style=" font-style:italic;">Filename</span> в <span style=" font-family:'Courier New,courier';">/dev/null</span>, потому что хотя механизм преобразований и не производит вывод в файл журнала в этом случае, внутри он все еще ведет журнализацию. <span style=" font-weight:600;">Это замедлит сервер без каких-либо преимуществ для администратора!</span> Для отключения ведения журнала, либо удалите, либо закомментируйте директиву <span style=" font-family:'Courier New,courier';">RewriteLog</span> либо используйте <span style=" font-family:'Courier New,courier';">RewriteLogLevel 0</span>! </p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Безопасность</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Смотрите <a href="http://httpd.apache.org/docs/current/misc/security_tips.html"><span style=" text-decoration: underline; color:#0000ff;">Apache Security Tips</span></a> документ в котором есть более подробная информация о том, почему вы можете быть уязвимы если разрешили запись в каталоги с файлами журналов кому угодно, кроме пользователя от имени которого запускается сервер. </p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Пример</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteLog &quot;/usr/local/var/apache/logs/rewrite.log&quot; </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="rewriteloglevel"></a><span style=" font-size:x-large; font-weight:600;">Д</span><span style=" font-size:x-large; font-weight:600;">иректива RewriteLogLevel</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Описание: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Устанавливает уровень детализации при журнализации действий механизма преобразований</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Синтаксис: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">RewriteLogLevel <span style=" font-style:italic;">Level</span> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Значение по умолчанию: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteLogLevel 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Контекст: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">server configvirtual host </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Статус: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Расширение</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Модуль: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">mod_rewrite </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Директива <span style=" font-family:'Courier New,courier';">RewriteLogLevel</span> устанавливает уровень детализации журнала механизма преобразований. По-умолчанию уровень 0 означающий что журнализация не ведется, в то время как 9 или более означает что записываются практически все действия. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для отключения журнализации действий механизма преобразований просто установите <span style=" font-style:italic;">уровень</span> на 0. Это отключает ведение журнала для всех действий по преобразованиям. </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Использование больших значений <span style=" font-style:italic;">уровня</span> очень сильно замедлит ваш сервер Apache! Используйте журнал преобразований на <span style=" font-style:italic;">уровне</span> большем чем 2 только для отладочных целей! </p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Пример</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteLogLevel 3 </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="rewritelock"></a><span style=" font-size:x-large; font-weight:600;">Д</span><span style=" font-size:x-large; font-weight:600;">иректива RewriteLock</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Описание: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Устанавливает имя файла используемого для RewriteMap синхронизации</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Синтаксис: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">RewriteLock <span style=" font-style:italic;">file-path</span> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Значение по умолчанию: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">None</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Контекст: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">server config</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Статус: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Расширение</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Модуль: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">mod_rewrite </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Эта директива определяет имя файла синхронизации который нужен mod_rewrite для связи с <a href="http://www.egoroff.spb.ru/portfolio/mod_rewrite.html#rewritemap"><span style=" font-family:'Courier New,courier'; text-decoration: underline; color:#0000ff;">RewriteMap</span></a> <span style=" font-style:italic;">программами</span>. Сделайте этот файл локальным (размещенным не на NFS-смонтированном ресурсе) когда вы хотите использовать программу для создания ассоциативного массива преобразований. Это не является обязательным для других типов таких массивов. </p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="rewritemap"></a><span style=" font-size:x-large; font-weight:600;">Д</span><span style=" font-size:x-large; font-weight:600;">иректива RewriteMap</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Описание: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Определяет функцию создания ассоциативного массива для поиска по ключу</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Синтаксис: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">RewriteMap <span style=" font-style:italic;">MapName</span> <span style=" font-style:italic;">MapType</span>:<span style=" font-style:italic;">MapSource</span> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Значение по умолчанию: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">нет</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Контекст: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">server configvirtual host </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Статус: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Расширение</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Модуль: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">mod_rewrite</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Совместимость: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выбор разных типов dbm доступен в Apache 2.0.41 и более поздних версиях </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Директива <span style=" font-family:'Courier New,courier';">RewriteMap</span> <span style=" font-style:italic;">ассоциативный массив преобразований</span>, который может быть использован в правилах преобразований и использующий соответствующие функции для вставки/извлечения элементов, для поиска по ключу соответствующих значений. Источник этого поиска может иметь различный тип. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.egoroff.spb.ru/portfolio/mod_rewrite.html"><span style=" font-style:italic; text-decoration: underline; color:#0000ff;">MapName</span></a> это имя массива которое будет использоваться для поиска соответствующего значения из массива в правиле преобразования через один из следующих конструкторов: </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-weight:600;">${</span><span style=" font-weight:600;"> </span><span style=" font-weight:600; font-style:italic;">MapName</span><span style=" font-weight:600;"> </span><span style=" font-family:'Courier New,courier'; font-weight:600;">:</span><span style=" font-weight:600;"> </span><span style=" font-weight:600; font-style:italic;">LookupKey</span><span style=" font-weight:600;"> </span><span style=" font-family:'Courier New,courier'; font-weight:600;">}</span><span style=" font-weight:600;"><br /></span><span style=" font-family:'Courier New,courier'; font-weight:600;">${</span><span style=" font-weight:600;"> </span><span style=" font-weight:600; font-style:italic;">MapName</span><span style=" font-weight:600;"> </span><span style=" font-family:'Courier New,courier'; font-weight:600;">:</span><span style=" font-weight:600;"> </span><span style=" font-weight:600; font-style:italic;">LookupKey</span><span style=" font-weight:600;"> </span><span style=" font-family:'Courier New,courier'; font-weight:600;">|</span><span style=" font-weight:600;"> </span><span style=" font-weight:600; font-style:italic;">DefaultValue</span><span style=" font-weight:600;"> </span><span style=" font-family:'Courier New,courier'; font-weight:600;">}</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Когда встречается подобная конструкция, происходит обращение к массиву <span style=" font-style:italic;">MapName</span> и поиск значения сопоставленного ключу <span style=" font-style:italic;">LookupKey</span>. Если найдено искомое значение ключа, происходит извлечение значения <span style=" font-style:italic;">SubstValue</span> с помощью соответствующей функции. Если ключ не найден тогда происходит подстановка <span style=" font-style:italic;">DefaultValue</span> или пустой строки если не указана <span style=" font-style:italic;">DefaultValue</span>. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Могут быть использованы следующие комбинации типа функции - <span style=" font-style:italic;">MapType</span> для вставки/извлечения элементов массива и <span style=" font-style:italic;">MapSource</span> - самого ассоциативного массива: </p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Простой текст</span><br />MapType: <span style=" font-family:'Courier New,courier';">txt</span>, MapSource: Путь к существующему файлу в файловой системе Unix </li>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">Это стандартная опция для создания ассоциативного массива где <span style=" font-style:italic;">MapSource</span> это простой текстовый ASCII файл содержащий либо пустый строчки, строчки комментариев (начинающиеся с символа '#') либо пары подобные следующим - одна в строчке: </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-weight:600; font-style:italic;">MatchingKey</span><span style=" font-weight:600;"> </span><span style=" font-weight:600; font-style:italic;">SubstValue</span> </p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Пример</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">##</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">##  map.txt -- массив преобразований</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">##</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Ralf.S.Engelschall    rse   # Bastard Operator From Hell</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Mr.Joe.Average        joe   # Mr. Average </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteMap real-to-user txt:/path/to/file/map.txt </span></p>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Произвольный простой текст</span><br />MapType: <span style=" font-family:'Courier New,courier';">rnd</span>, MapSource: Путь к существующему файлу в файловой системе Unix </li>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">Этот вариант идентичен варианту с простым текстом приведённом выше но со специальной особенностью пост-обработки: После нахождения какую-либо величину производится её анализ на предмет нахождения символов &quot;<span style=" font-family:'Courier New,courier';">|</span>&quot; которые имеют значение логического &quot;или&quot;. Другими словами они означают набор альтернативных вариантов и выбор возвращаемой величины из них производится произвольно. Хотя это кажется безумием и абсолютно бесполезным, это в действительности используется для балансировки нагрузки в ситуациях с обратным прокси где происходит поиск имен серверов. Например: </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">##</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">##  map.txt -- массив преобразований</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">##</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">static   www1|www2|www3|www4</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">dynamic  www5|www6 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteMap servers rnd:/path/to/file/map.txt </span></p>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Хэш файл</span><br />MapType: <span style=" font-family:'Courier New,courier';">dbm[=</span><span style=" font-family:'Courier New,courier'; font-style:italic;">type</span><span style=" font-family:'Courier New,courier';">]</span>, MapSource: Путь к существующему файлу в файловой системе Unix </li>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">Здесь, источник - это двоичный файл DBM формата содержащий то же самое содержимое что и <span style=" font-style:italic;">простой текстовый</span> файл, однако в специальном виде, оптимизированном для действительно быстрого поиска. Этот <span style=" font-style:italic;">тип</span> может быть sdbm, gdbm, ndbm, или db в зависимости от <a href="http://www.egoroff.spb.ru/install.html#dbm"><span style=" text-decoration: underline; color:#0000ff;">настроек при компиляции</span></a>. Если <span style=" font-style:italic;">тип</span> опущен, выбирается тип установленный по-умолчанию при компиляции. Вы можете создавать такой файл любой утилитой DBM или следующим Perl скриптом. Убедитесь что он настроен для создания требуемого типа DBM файла. Этот пример создает файл NDBM. </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">#!/path/to/bin/perl</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">##</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">##  txt2dbm -- convert txt map to dbm format</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">##</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">use NDBM_File;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">use Fcntl;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">($txtmap, $dbmmap) = @ARGV;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">open(TXT, &quot;&lt;$txtmap&quot;) or die &quot;Couldn't open $txtmap!\n&quot;;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">tie (%DB, 'NDBM_File', $dbmmap,O_RDWR|O_TRUNC|O_CREAT, 0644)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  or die &quot;Couldn't create $dbmmap!\n&quot;;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">while (&lt;TXT&gt;) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  next if (/^\s*#/ or /^\s*$/);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  $DB{$1} = $2 if (/^\s*(\S+)\s+(\S+)/);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">untie %DB;</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">close(TXT); </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">$ txt2dbm map.txt map.db </span></p>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Внутренняя функция</span><br />MapType: <span style=" font-family:'Courier New,courier';">int</span>, MapSource: внутренняя функция Apache </li>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">Здесь, источник - это какая-либо внутренняя функция Apache. В настоящее время вы не можете создавать свои собственные функции, однако уже существуют следующие функции: </p>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">toupper</span>:<br />Преобразует ключ поиска в верхний регистр. </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">tolower</span>:<br />Преобразует ключ поиска в нижний регистр. </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">escape</span>:<br />Транслирует специальные символы в ключе поиска в их числовые коды. </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">unescape</span>:<br />Транслирует числовые коды в ключе поиска обратно в специальные символы. </li></ul>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Внешняя программа преобразования</span><br />MapType: <span style=" font-family:'Courier New,courier';">prg</span>, MapSource: Путь к существующему файлу в файловой системе Unix </li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">Здесь, источник - это программа, а не файл с ассоциативным массивом. Для её создания вы можете использовать любой выбранный язык, однако результат должен быть исполняемым файлом (<span style=" font-style:italic;">т.е.</span>, либо объектным кодом либо скриптом с магической первой строчкой '<span style=" font-family:'Courier New,courier';">#!/path/to/interpreter</span>'). </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">Эта программа запускается один раз при запуске сервера Apache и затем взаимодействует с механизмом преобразований через файловые обработчики <span style=" font-family:'Courier New,courier';">stdin</span>(поток ввода) и <span style=" font-family:'Courier New,courier';">stdout</span>(поток вывода). Для каждого поиска в массиве, соответствующий ключ для поиска, будет получаться в виде строки, подаваемой на <span style=" font-family:'Courier New,courier';">stdin</span> и оканчивающейся символом перевода строки. Затем эта программа должна вернуть значение найденной величины в <span style=" font-family:'Courier New,courier';">stdout</span> в виде строки оканчивающейся символом перевода строки либо строкой из четырёх символов &quot;<span style=" font-family:'Courier New,courier';">NULL</span>&quot; если поиск неудачен (<span style=" font-style:italic;">т.е.</span>, для соответствующего значения ключа не найдено никакого значения). Тривиальная программа реализующая массив 1:1 (<span style=" font-style:italic;">т.е.</span>, ключ == значение) может выглядеть так: </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">#!/usr/bin/perl</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">$| = 1;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">while (&lt;STDIN&gt;) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    # ...put here any transformations or lookups...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    print $_;</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">} </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">Однако будьте очень осторожны: </p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">&quot;<span style=" font-style:italic;">Keep it simple, stupid</span>&quot; (KISS) - делай это проще, дурачок, потому что если эта программа зависнет - это повесит сервер Apache когда встретится правило использующее этот массив (создаваемый внешней программой). </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для избежания распространенной ошибки: никогда не делайте буферизованный ввод/вывод для <span style=" font-family:'Courier New,courier';">stdout</span>! Это вызовет бесконечное зацикливание! Отсюда &quot;<span style=" font-family:'Courier New,courier';">$|=1</span>&quot; в вышеприведенном примере... </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Используйте директиву <a href="http://www.egoroff.spb.ru/portfolio/mod_rewrite.html#rewritelock"><span style=" font-family:'Courier New,courier'; text-decoration: underline; color:#0000ff;">RewriteLock</span></a> для определения файла блокировок который mod_rewrite может использовать для синхронизации связи с этой программой. По-умолчанию такая синхронизация не производится. </li></ol>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Директива <span style=" font-family:'Courier New,courier';">RewriteMap</span> может встречаться более одного раза. Для каждого массива используйте одну <span style=" font-family:'Courier New,courier';">RewriteMap</span> директиву для объявления файла с массивом преобразований. В то время как вы не можете <span style=" font-weight:600;">определять</span> массив в контексте каталога, его использование в этом контексте конечно же возможно. </p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Замечание</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для простого текстового и DBM файлов ключи поиска кэшируются ядром до тех пор пока не изменится тип <span style=" font-family:'Courier New,courier';">mtime</span> файла с массивом или пока не произойдет рестарт сервера. Таким образом, вы можете использовать ассоциативные массивы в правилах которые используются для <span style=" font-weight:600;">каждого</span> запроса. Это не проблема, потому что внешний поиск происходит только один раз! </p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="rewritebase"></a><span style=" font-size:x-large; font-weight:600;">Д</span><span style=" font-size:x-large; font-weight:600;">иректива RewriteBase</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Описание: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Устанавливает базовый URL для преобразований в контексте каталога</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Синтаксис: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">RewriteBase <span style=" font-style:italic;">URL-path</span> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Значение по умолчанию: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Смотри использование для более подробной информации.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Контекст: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">directory.htaccess </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Разрешение: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">FileInfo</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Статус: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Расширение</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Модуль: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">mod_rewrite </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Директива <span style=" font-family:'Courier New,courier';">RewriteBase</span> устанавливает конкретный, базовый URL для преобразований в контексте каталога. Как вы увидите ниже, <a href="http://www.egoroff.spb.ru/portfolio/mod_rewrite.html#rewriterule"><span style=" font-family:'Courier New,courier'; text-decoration: underline; color:#0000ff;">RewriteRule</span></a> может быть использовано в конфигурационных файлах каталогов (<span style=" font-family:'Courier New,courier';">.htaccess</span>). Это будет работать локально, <span style=" font-style:italic;">т.е.</span>, префикс локального каталога отбрасывается на этом этапе обработки и ваши правила преобразований работают только в оставшейся части. В конце он автоматически добавляется обратно к пути. Настройка по-умолчанию; <span style=" font-family:'Courier New,courier';">RewriteBase</span> <span style=" font-style:italic;">physical-directory-path</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Когда, для какого-нибудь нового URL происходит подстановка(преобразование), этот модуль должен заново вовлечь этот URL в обработку. Для того чтобы иметь возможность сделать это, нужно знать какие у него префикс или база URL. По-умолчанию этот префикс равен самому пути. <span style=" font-weight:600;">Однако на большинстве сайтов URL'ы НЕ прямо соответствуют физическим путям, поэтому это допущение обычно окажется неверным!</span> В этом случае вы должны использовать директиву <span style=" font-family:'Courier New,courier';">RewriteBase</span> для указания правильного префикса URL. </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если URL вашего сервера <span style=" font-weight:600;">не</span> соответствуют физическим путям к файлам, вы должны использовать <span style=" font-family:'Courier New,courier';">RewriteBase</span> в каждом из <span style=" font-family:'Courier New,courier';">.htaccess</span> файлов где вы хотите использовать директивы <a href="http://www.egoroff.spb.ru/portfolio/mod_rewrite.html#rewriterule"><span style=" font-family:'Courier New,courier'; text-decoration: underline; color:#0000ff;">RewriteRule</span></a>. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Например, предположим следующий конфигурационный файл каталога: </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">#</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">#  /abc/def/.htaccess -- конфигурационный файл каталога /abc/def</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">#  Помните: /abc/def это физический путь /xyz, </span><span style=" font-family:'Courier New,courier'; font-style:italic;">т.е.</span><span style=" font-family:'Courier New,courier';">, у сервера есть</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">#            директива 'Alias /xyz /abc/def' </span><span style=" font-family:'Courier New,courier'; font-style:italic;">к примеру</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">#</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteEngine On</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">#  даем серверу знать что мы работаем через /xyz а не</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">#  через префикс физического пути /abc/def</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteBase   /xyz</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">#  теперь правила преобразований</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteRule   ^oldstuff\.html$  newstuff.html </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В примере выше, запрос к <span style=" font-family:'Courier New,courier';">/xyz/oldstuff.html</span> корректно преобразуется в физический файл <span style=" font-family:'Courier New,courier';">/abc/def/newstuff.html</span>. </p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Для любителей поковыряться в Apache</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Следующий список дает подробную информацию об этапах внутренней работы:</p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Запрос:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  /xyz/oldstuff.html</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Внутренняя работа:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  /xyz/oldstuff.html     -&gt; /abc/def/oldstuff.html  (per-server Alias)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  /abc/def/oldstuff.html -&gt; /abc/def/newstuff.html  (per-dir    RewriteRule)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  /abc/def/newstuff.html -&gt; /xyz/newstuff.html      (per-dir    RewriteBase)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  /xyz/newstuff.html     -&gt; /abc/def/newstuff.html  (per-server Alias)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Результат:</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  /abc/def/newstuff.html </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Это кажется очень сложным однако это корректная внутренняя работа Apache, из-за того что преобразования в контексте каталога происходят слишком поздно в этом процессе. Поэтому, когда это происходит (преобразование), запрос должен быть возвращен обратно ядру Apache! НО: В то время как это кажется серъёзным накладным расходом, в действительности это не так, потому что этот возврат происходит целиком внутри сервера Apache и та же самая процедура используется многими другими операциями внутри Apache. Поэтому, вы можете быть уверены что дизайн и реализация правильные. </p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="rewritecond"></a><span style=" font-size:x-large; font-weight:600;">Д</span><span style=" font-size:x-large; font-weight:600;">иректива RewriteCond</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Описание: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Определяет условие при котором происходит преобразование </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Синтаксис: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">RewriteCond <span style=" font-style:italic;">СравниваемаяСтрока</span> <span style=" font-style:italic;">Условие</span> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Значение по умолчанию: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">None</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Контекст: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">server configvirtual host directory.htaccess</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Разрешение: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">FileInfo</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Статус: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Расширение</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Модуль: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">mod_rewrite </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Директива <span style=" font-family:'Courier New,courier';">RewriteCond</span> определяет условия для какого-либо правила. Перед директивой <a href="http://www.egoroff.spb.ru/portfolio/mod_rewrite.html#rewriterule"><span style=" font-family:'Courier New,courier'; text-decoration: underline; color:#0000ff;">RewriteRule</span></a> располагаются одна или несколько директив <span style=" font-family:'Courier New,courier';">RewriteCond</span>. Следующее за ними правило преобразования используется только тогда, когда URI соответствует условиям этой директивы <span style=" font-weight:600;">и</span> также условиям этих дополительных директив. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">СравниваемаяСтрока</span> строка которая может содержать следующие дополнительные конструкции в дополении к простому тексту: </p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">RewriteRule обратные_связи</span>: Это обратные связи вида </li>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-weight:600;">$N</span> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">(0 &lt;= N &lt;= 9) предоставляющие доступ к сгруппированным частям (в круглых скобках!) шаблона из соответствующей директивы <span style=" font-family:'Courier New,courier';">RewriteRule</span> (единственной, следующей сразу за текущим набором директив <span style=" font-family:'Courier New,courier';">RewriteCond</span>). </p>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">RewriteCond обратные_связи</span>: Это обратные связи вида </li>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-weight:600;">%N</span> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">(1 &lt;= N &lt;= 9) предоставляющие доступ к сгруппированным частям (в круглых скобках!) шаблона из соответствующей директивы <span style=" font-family:'Courier New,courier';">RewriteCond</span> в текущем наборе условий. </p>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">RewriteMap расширения</span>: Это расширения вида </li>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-weight:600;">${mapname:key|default}</span> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">Смотрите <a href="http://www.egoroff.spb.ru/portfolio/mod_rewrite.html#mapfunc"><span style=" text-decoration: underline; color:#0000ff;">документацию по RewriteMap</span></a> для получения более подробной информации. </p>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Переменные сервера</span>: Это переменные вида </li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-weight:600;">%{</span><span style=" font-weight:600;"> </span><span style=" font-weight:600; font-style:italic;">NAME_OF_VARIABLE</span><span style=" font-weight:600;"> </span><span style=" font-family:'Courier New,courier'; font-weight:600;">}</span> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">где <span style=" font-style:italic;">NAME_OF_VARIABLE</span> может быть строкой взятой из следующего списка: </p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">HTTP заголовки:</span></p></td>
<td>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">соединение &amp; запрос:</span></p></td>
<td></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">HTTP_USER_AGENT<br />HTTP_REFERER<br />HTTP_COOKIE<br />HTTP_FORWARDED<br />HTTP_HOST<br />HTTP_PROXY_CONNECTION<br />HTTP_ACCEPT<br /></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">REMOTE_ADDR<br />REMOTE_HOST<br />REMOTE_USER<br />REMOTE_IDENT<br />REQUEST_METHOD<br />SCRIPT_FILENAME<br />PATH_INFO<br />QUERY_STRING<br />AUTH_TYPE<br /></p></td>
<td></td></tr>
<tr>
<td>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">внутренние сервера:</span></p></td>
<td>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">системные:</span></p></td>
<td>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">специальные:</span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">DOCUMENT_ROOT<br />SERVER_ADMIN<br />SERVER_NAME<br />SERVER_ADDR<br />SERVER_PORT<br />SERVER_PROTOCOL<br />SERVER_SOFTWARE<br /></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">TIME_YEAR<br />TIME_MON<br />TIME_DAY<br />TIME_HOUR<br />TIME_MIN<br />TIME_SEC<br />TIME_WDAY<br />TIME<br /></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">API_VERSION<br />THE_REQUEST<br />REQUEST_URI<br />REQUEST_FILENAME<br />IS_SUBREQ<br /></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">Эти переменные полностью соответствуют названным похожим образом MIME-заголовкам HTTP , Си переменным сервера Apache или полям <span style=" font-family:'Courier New,courier';">struct tm</span> систем Unix. Большинство из них документрованны в других местах руководства или в спецификации CGI. Те, что являются для mod_rewrite специальными включают: </p>
<p style=" margin-top:8px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">IS_SUBREQ</span> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">Будет содержать текст &quot;true&quot; если запрос выполняется в текущий момент как подзапрос, &quot;false&quot; в другом случае. Подзапросы могут быть сгенерированны модулями которым нужно иметь дело с дополнительными файлами или URI для того чтобы выполнить собственные задачи. </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">API_VERSION</span> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">Это версия API модуля Apache (внутренний интерфейс между сервером и модулем) в текущей сборке сервера, что определено в include/ap_mmn.h. API версия модуля соответствует используемой версии Apache (для версии Apache 1.3.14, к примеру это 19990320:10), однако это в основном интересно авторам модулей. </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">THE_REQUEST</span> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">Полная строка HTTP запроса отправленная браузером серверу (т.е., &quot;<span style=" font-family:'Courier New,courier';">GET /index.html HTTP/1.1</span>&quot;). Она не включает какие-либо дополнительные заголовки отправляемые браузером. </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">REQUEST_URI</span> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">Ресурс, запрошенный в строке HTTP запроса. (В примере выше, это было бы &quot;/index.html&quot;.) </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">REQUEST_FILENAME</span> </p>
<p style=" margin-top:0px; margin-bottom:8px; margin-left:30px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">Полный путь в файловой системе сервера к файлу или скрипту соответствующим этому запросу. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Специальные примечания: </p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Переменные SCRIPT_FILENAME и REQUEST_FILENAME содержат одинаковые значения, <span style=" font-style:italic;">т.е.</span>, значение поля <span style=" font-family:'Courier New,courier';">filename</span> внутренней структуры <span style=" font-family:'Courier New,courier';">request_rec</span> сервера Apache. Первое имя это просто широко известное имя переменной CGI в то время как второе это постоянная копия REQUEST_URI (содержащая значение поля <span style=" font-family:'Courier New,courier';">uri</span> структуры <span style=" font-family:'Courier New,courier';">request_rec</span>). </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Есть специальный формат: <span style=" font-family:'Courier New,courier';">%{ENV:переменная}</span> где <span style=" font-style:italic;">переменная</span> может быть любой переменной окружения. Это ищется во внутренних структурах Apache и (если там нет) с помощью вызова <span style=" font-family:'Courier New,courier';">getenv()</span> из процесса Apache сервера. </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Есть специальный формат: <span style=" font-family:'Courier New,courier';">%{HTTP:заголовок}</span> где <span style=" font-style:italic;">заголовок</span> может быть любым именем HTTP MIME-заголовка. Это ищется в HTTP запросе. Пример: <span style=" font-family:'Courier New,courier';">%{HTTP:Proxy-Connection}</span> значение HTTP заголовка &quot;<span style=" font-family:'Courier New,courier';">Proxy-Connection:</span>&quot;. </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Есть специальный формат <span style=" font-family:'Courier New,courier';">%{LA-U:переменная}</span> опережающих запросов которые производятся внутренним (основанном на URL) подзапросом для определения конечного значения <span style=" font-style:italic;">переменной</span>. Используйте это когда вы хотите использовать переменную для преобразований, которая реально определяется позднее, в какой-либо фазе API, и таким образом недоступна на данном этапе. Для примера когда вы хотите преобразовать соответственно переменной <span style=" font-family:'Courier New,courier';">REMOTE_USER</span> из контекста сервера (файл <span style=" font-family:'Courier New,courier';">httpd.conf</span>) вы должны использовать <span style=" font-family:'Courier New,courier';">%{LA-U:REMOTE_USER}</span> потому что эта переменная устанавливается в фазах авторизации которые идут <span style=" font-style:italic;">после</span> фазы трансляции URL в которой и работает mod_rewrite. С другой стороны, по причине реализации работы mod_rewrite в контексте каталога (файл <span style=" font-family:'Courier New,courier';">.htaccess</span>) через Fixup фазу API и из-за того, фазы авторизации идут <span style=" font-style:italic;">до</span> этой фазы, вы просто можете там использовать <span style=" font-family:'Courier New,courier';">%{REMOTE_USER}</span>. </li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Есть специальный формат: <span style=" font-family:'Courier New,courier';">%{LA-F:переменная}</span> который создает внутренний (основанный на имени файла) подзапрос для определения конечного значения <span style=" font-style:italic;">переменной</span>. В основном это то же самое что и формат LA-U приведенный выше . </li></ol>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">Условие</span> это шаблон условия, <span style=" font-style:italic;">т.е.</span>, какое-либо регулярное выражение применяемое к текущему экземпляру <span style=" font-style:italic;">СравниваемаяСтрока</span>, <span style=" font-style:italic;">т.е.</span>, <span style=" font-style:italic;">СравниваемаяСтрока</span> просматривается на поиск соответствия <span style=" font-style:italic;">Условие</span>. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Помните:</span> <span style=" font-style:italic;">Условие</span> это <span style=" font-style:italic;">perl совместимое регулярное выражение</span> с некоторыми дополнениями: </p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вы можете предварять строку шаблона префиксом '<span style=" font-family:'Courier New,courier';">!</span>' (восклицательный знак) для указания <span style=" font-weight:600;">не</span>соответствия шаблону. </li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Есть некоторые специальные варианты <span style=" font-style:italic;">Условиеs</span>. Вместо обычных строк с регулярными выражениями можно также использовать один из следующих вариантов: </li></ol>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-weight:600;">&lt;Условие</span>' (лексически меньше)<br /><span style=" font-style:italic;">Условие</span> считается простой строкой и лексически сравнивается с <span style=" font-style:italic;">СравниваемаяСтрока</span>. Истинно если <span style=" font-style:italic;">СравниваемаяСтрока</span> лексически меньше чем <span style=" font-style:italic;">Условие</span>. </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-weight:600;">&gt;Условие</span>' (лексически больше)<br /><span style=" font-style:italic;">Условие</span> считается простой строкой и лексически сравнивается с <span style=" font-style:italic;">СравниваемаяСтрока</span>. Истинно если <span style=" font-style:italic;">СравниваемаяСтрока</span> лексически больше чем <span style=" font-style:italic;">Условие</span>. </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-weight:600;">=Условие</span>' (лексически равно)<br /><span style=" font-style:italic;">Условие</span> считается простой строкой и лексически сравнивается с <span style=" font-style:italic;">СравниваемаяСтрока</span>. Истинно если <span style=" font-style:italic;">СравниваемаяСтрока</span> лексически равно <span style=" font-style:italic;">Условие</span>, т.е. эти две строки полностью одинаковы (символ в символ). Если <span style=" font-style:italic;">Условие</span> имеет вид <span style=" font-family:'Courier New,courier';">&quot;&quot;</span> (два знака дюйма идущих подряд) это сравнивает <span style=" font-style:italic;">СравниваемаяСтрока</span> с пустой строкой. </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-weight:600;">-d</span>' (является ли каталогом)<br /><span style=" font-style:italic;">СравниваемаяСтрока</span> считается путем, проверяется существование этого пути и то что этот путь является каталогом. </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-weight:600;">-f</span>' (является ли обычным файлом)<br /><span style=" font-style:italic;">СравниваемаяСтрока</span> считается путем, проверяется существование этого пути и то что этот путь является обычным файлом. </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-weight:600;">-s</span>' (является ли обычным файлом с ненулевым размером)<br /><span style=" font-style:italic;">СравниваемаяСтрока</span> считается путем, проверяется существование этого пути и то что этот путь является обычным файлом, размер которого больше нуля. </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-weight:600;">-l</span>' (является ли символической ссылкой)<br /><span style=" font-style:italic;">СравниваемаяСтрока</span> считается путем, проверяется существование этого пути и то что этот путь является символической ссылкой. </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-weight:600;">-F</span>' (проверка существования файла через подзапрос)<br />Проверяет через все списки контроля доступа сервера, существующие в настоящий момент, является ли <span style=" font-style:italic;">СравниваемаяСтрока</span> существующим файлом, доступным по этому пути. Для этой проверки используется внутренний подзапрос, поэтому используйте эту опцию с осторожностью - это отрицательно сказывается на производительности сервера! </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-weight:600;">-U</span>' (проверка существования URL через подзапрос)<br />Проверяет через все списки контроля доступа сервера, существующие в настоящий момент, является ли <span style=" font-style:italic;">СравниваемаяСтрока</span> существующим URL, доступным по этому пути. Для этой проверки используется внутренний подзапрос, поэтому используйте эту опцию с осторожностью - это отрицательно сказывается на производительности сервера! </li></ul>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Замечание</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">Все эти проверки также могут быть предварены префиксом восклицательный знак ('!') для инвертирования их значения. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Дополнительно вы можете устанавливать специальные флаги для <span style=" font-style:italic;">Условие</span> добавляя </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-weight:600;">[</span><span style=" font-weight:600; font-style:italic;">flags</span><span style=" font-family:'Courier New,courier'; font-weight:600;">]</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">третьим аргументом в директиву <span style=" font-family:'Courier New,courier';">RewriteCond</span>. <span style=" font-style:italic;">Flags</span> список следующих флагов разделенных запятыми: </p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-family:'Courier New,courier'; font-weight:600;">nocase|NC</span>' (регистронезависимо)<br />Регистр не имеет значение, <span style=" font-style:italic;">т.е.</span>, нет различий между 'A-Z' и 'a-z' как в дополнении <span style=" font-style:italic;">СравниваемаяСтрока</span> так и <span style=" font-style:italic;">Условие</span>. Этот флаг эффективен только для сравнений между <span style=" font-style:italic;">СравниваемаяСтрока</span> и <span style=" font-style:italic;">Условие</span>. Он не работает при проверках в файловой системе и в подзапросах. </li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-family:'Courier New,courier'; font-weight:600;">ornext|OR</span>' (либо следующее условие)<br />Используйте для комбинирования условий в правилах OR вместо AND. Типичный пример: </li></ul>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteCond %{REMOTE_HOST}  ^host1.*  [OR]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteCond %{REMOTE_HOST}  ^host2.*  [OR]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteCond %{REMOTE_HOST}  ^host3.*</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteRule ...some special stuff for any of these hosts...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">Без этого флага вы должны были бы написать это условие/правило три раза. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Пример:</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для выдачи главной страницы какого-либо сайта согласно &quot;<span style=" font-family:'Courier New,courier';">User-Agent:</span>&quot; заголовку запроса, вы можете использовать следующие директивы: </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteCond  %{HTTP_USER_AGENT}  ^Mozilla.*</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteRule  ^/$                 /homepage.max.html  [L]</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteCond  %{HTTP_USER_AGENT}  ^Lynx.*</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteRule  ^/$                 /homepage.min.html  [L]</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteRule  ^/$                 /homepage.std.html  [L] </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Интерпретация: Если у вас Netscape Navigator (который идентифицируется как 'Mozilla'), вы выдаете максимально навороченную страницу, с фреймами, <span style=" font-style:italic;">и т.д.</span> Если у вас Lynx (текстовый браузер), вы выдаете наименее навороченную страницу, без рисунков, таблиц <span style=" font-style:italic;">и т.д.</span> Если любой другой браузер, выдаете стандартную страницу. </p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="rewriterule"></a><span style=" font-size:x-large; font-weight:600;">Д</span><span style=" font-size:x-large; font-weight:600;">иректива RewriteRule</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Описание: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Определяет правила для механизма преобразований</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Синтаксис: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">RewriteRule <span style=" font-style:italic;">Шаблон</span> <span style=" font-style:italic;">Подстановка</span> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Значение по умолчанию: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">None</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Контекст: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">server configvirtual host directory.htaccess</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Разрешение: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">FileInfo</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Статус: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Расширение</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Модуль: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">mod_rewrite</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Совместимость: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Флаг cookie доступен в Apache 2.0.40 и более поздних. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Директива <span style=" font-family:'Courier New,courier';">RewriteRule</span> и есть настоящая рабочая лошадка преобразований. Эта директива может встречаться более одного раза. Каждая директива, в этом случае, определяет одно правило преобразования. <span style=" font-weight:600;">Порядок определений</span> этих правил <span style=" font-weight:600;">важен</span>, потому что этот порядок используется при обработке правил во время работы. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.egoroff.spb.ru/portfolio/mod_rewrite.html"><span style=" font-style:italic; text-decoration: underline; color:#0000ff;">Шаблон</span></a> это perl совместимое <a href="http://www.egoroff.spb.ru/portfolio/mod_rewrite.html"><span style=" text-decoration: underline; color:#0000ff;">регулярное выражение</span></a> которое применяется к текущему URL. Здесь под &quot;текущим&quot; подразумевается значение URL когда применяется это правило. Этот URL не обязательно совпадает с первоначально запрошенным URL, потому что любое количество правил возможно уже были применены к нему и соответственно преобразовали его. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Некоторые указания по синтаксису регулярных выражений: </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-weight:600;">Текст:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; font-weight:600;">.</span><span style=" font-family:'Courier New,courier';">           Любой одиночный символ</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; font-weight:600;">[</span><span style=" font-family:'Courier New,courier';">chars</span><span style=" font-family:'Courier New,courier'; font-weight:600;">]</span><span style=" font-family:'Courier New,courier';">     Класс симвлолв: Один из символов</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; font-weight:600;">[^</span><span style=" font-family:'Courier New,courier';">chars</span><span style=" font-family:'Courier New,courier'; font-weight:600;">]</span><span style=" font-family:'Courier New,courier';">    Класс симвлолв: Ни один из символов</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  text1</span><span style=" font-family:'Courier New,courier'; font-weight:600;">|</span><span style=" font-family:'Courier New,courier';">text2 Альтернатива: text1 или text2</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-weight:600;">Кванторы (символы для обозначения количественных отношений):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; font-weight:600;">?</span><span style=" font-family:'Courier New,courier';">           0 или 1 из предшествующего текста</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; font-weight:600;">*</span><span style=" font-family:'Courier New,courier';">           0 или N из предшествующего текста (N &gt; 0)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; font-weight:600;">+</span><span style=" font-family:'Courier New,courier';">           1 или N из предшествующего текста (N &gt; 1)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-weight:600;">Группировка:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; font-weight:600;">(</span><span style=" font-family:'Courier New,courier';">text</span><span style=" font-family:'Courier New,courier'; font-weight:600;">)</span><span style=" font-family:'Courier New,courier';">      Группировка текста</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">              (либо установка границ альтернативы или</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">              для создания обратных связей где </span><span style=" font-family:'Courier New,courier'; font-weight:600;">N</span><span style=" font-family:'Courier New,courier';"> группа, которая </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">              может быть использована в RHS директивы RewriteRule с $</span><span style=" font-family:'Courier New,courier'; font-weight:600;">N</span><span style=" font-family:'Courier New,courier';">)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-weight:600;">Маркеры:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; font-weight:600;">^</span><span style=" font-family:'Courier New,courier';">           Маркер начала строки</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; font-weight:600;">$</span><span style=" font-family:'Courier New,courier';">           Маркер конца строки</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-weight:600;">Экранирование:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; font-weight:600;">\</span><span style=" font-family:'Courier New,courier';">char       экранирование конкретного символа</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">              (к примеру для указания символов &quot;.[]()&quot; </span><span style=" font-family:'Courier New,courier'; font-style:italic;">и т.д.</span><span style=" font-family:'Courier New,courier';">) </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Более подробную информацию о регулярных выражениях, смотрите в документации по регулярным выражениям Perl (&quot;<a href="http://www.perldoc.com/perl5.6.1/pod/perlre.html"><span style=" text-decoration: underline; color:#0000ff;">perldoc perlre</span></a>&quot;). Если вы заинтересованы в ещё более детальной информации о регулярных выражениях и их диалектах (POSIX <span style=" font-style:italic;">и т.д.</span>), смотрите следующую, специально написанную по этой теме книгу: </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">Mastering Regular Expressions</span><br />Jeffrey E.F. Friedl<br />Nutshell Handbook Series<br />O'Reilly &amp; Associates, Inc. 1997<br />ISBN 1-56592-257-3<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Кроме того, в mod_rewrite символ отрицания (NOT) ('<span style=" font-family:'Courier New,courier';">!</span>') - допускаемый префикс в шаблоне. Это даёт вам возможность инвертировать действие шаблона; ну к примеру скажем: &quot;<span style=" font-style:italic;">если текущий URL </span><span style=" font-weight:600; font-style:italic;">не</span><span style=" font-style:italic;"> совпадает с этим шаблоном</span>&quot;. Это может быть использовано в особых случаях, когда проще найти шаблон для несоответствия, или в качестве последнего правила, работающего по умолчанию. </p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Примечание</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">При использовании символа NOT (не) для инвертирования действия шаблона вы не можете иметь сгруппированные части групповых символов в шаблоне. Это невозможно потому что когда нет соответствия шаблону, для групп нет никакого содержимого. В результате, если используются шаблоны с отрицанием, вы не можете использовать <span style=" font-family:'Courier New,courier';">$N</span> в строках подстановок! </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.egoroff.spb.ru/portfolio/mod_rewrite.html"><span style=" font-style:italic; text-decoration: underline; color:#0000ff;">Подстановка</span></a> в правиле преобразования это строка будет подставляться (или будет заменять) вместо оригинального URL, для которого естьсовпадение <span style=" font-style:italic;">Шаблону</span>. Кроме простого текста вы можете использовать </p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">обратные связи <span style=" font-family:'Courier New,courier';">$N</span> на шаблоны в RewriteRule </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">обратные связи <span style=" font-family:'Courier New,courier';">%N</span> на последний соответствующий шаблон в RewriteCond </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">переменные сервера в качестве проверяемых строк в условиях правил (<span style=" font-family:'Courier New,courier';">%{VARNAME}</span>) </li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">вызовы <a href="http://www.egoroff.spb.ru/portfolio/mod_rewrite.html#mapfunc"><span style=" text-decoration: underline; color:#0000ff;">запросов к массиву</span></a> (<span style=" font-family:'Courier New,courier';">${mapname:key|default}</span>) </li></ol>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обратные связи это <span style=" font-family:'Courier New,courier';">$</span><span style=" font-weight:600;">N</span> (<span style=" font-weight:600;">N</span>=0..9) идентификаторы которые заменяются содержимым <span style=" font-weight:600;">N</span>-й группы подходящего <span style=" font-style:italic;">Шаблона</span>. Переменные сервера Это тоже самое что и <span style=" font-style:italic;">СравниваемаяСтрока</span> директивы <span style=" font-family:'Courier New,courier';">RewriteCond</span>. Запросы к массиву пришли из директивы <span style=" font-family:'Courier New,courier';">RewriteMap</span> там они и объяснены. Эти три типа переменных рассматриваются в порядке, в котором они идут в вышеприведенном списке. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Как уже было упомянуто выше, все правила преобразований применяются с использованием <span style=" font-style:italic;">Подстановки</span> (в порядке, в котором они определены в конфигурационном файле). URL <span style=" font-weight:600;">полностью заменяется</span> <span style=" font-style:italic;">Подстановкой</span> и процесс преобразования идет до тех пор, пока не останется больше никаких правил, если только он не прерван специально, с помощью флага <span style=" font-family:'Courier New,courier'; font-weight:600;">L</span> - см. ниже. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Существует специальная строка подстановки вида '<span style=" font-family:'Courier New,courier';">-</span>' которая означает: <span style=" font-weight:600;">НЕТ подстановки</span>! Звучит глупо? Нет, это полезно для правил преобразования которые <span style=" font-weight:600;">только</span> проверяют некоторые URL однако не производят подстановок, <span style=" font-style:italic;">т.е.</span>, в связке с флагом <span style=" font-weight:600;">C</span> (цепочка) возможно иметь более чем один шаблон, применяемый перед проведением непосредственно самой подстановки. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Ещё одно замечание: Вы даже можете создавать URL, содержащие строку запроса, в строке подстановки. Просто используйте вопросительный знак внутри строки подстановки для указания того, следующее за ним содержимое должно быть преобразовано в QUERY_STRING (строку запроса). Когда вы хотите убрать существующую строку запроса, завершайте строку подстановки просто вопросительным знаком. </p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Примечание</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Есть одна особенность: Когда вы предваряете поле подстановки строкой <span style=" font-family:'Courier New,courier';">http://</span><span style=" font-style:italic;">thishost</span>[<span style=" font-style:italic;">:thisport</span>], - <span style=" font-weight:600;">mod_rewrite</span> отрезает её автоматически. Это автоматическое усечение подразумеваемое при внешнем редиректе URL полезная и важная особенность при использовании в связке с запросами к массивам преобразований генерирующих имя хоста. Взгляните на первый пример, в разделе примеров ниже, чтобы понять это. </p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Помните</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Безусловный внешний редирект на ваш собственный сервер не будет работать с префиксом <span style=" font-family:'Courier New,courier';">http://thishost</span> из-за этой особенности. Чтобы использовать такой саморедирект, Вы должны использовать флаг <span style=" font-weight:600;">R</span>(см. ниже). </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В <span style=" font-style:italic;">подстановке</span> вы можете использовать, в том числе, и специальные флаги путем добавления следующей конструкции: </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-weight:600;">[</span><span style=" font-weight:600; font-style:italic;">флаги</span><span style=" font-family:'Courier New,courier'; font-weight:600;">]</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">в качестве третьего аргумента директивы <span style=" font-family:'Courier New,courier';">RewriteRule</span>. <span style=" font-style:italic;">Флаги</span> - это разделённый запятыми, следующий список флагов: </p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-family:'Courier New,courier'; font-weight:600;">redirect|R</span><span style=" font-weight:600;"> [=</span><span style=" font-weight:600; font-style:italic;">code</span><span style=" font-weight:600;">]</span>' (вызывает <a href="http://www.egoroff.spb.ru/portfolio/mod_rewrite.html"><span style=" font-weight:600; text-decoration: underline; color:#0000ff;">р</span></a><a href="http://www.egoroff.spb.ru/portfolio/mod_rewrite.html"><span style=" text-decoration: underline; color:#0000ff;">едирект</span></a>)<br />Префикс в <span style=" font-style:italic;">Подстановке</span> вида <span style=" font-family:'Courier New,courier';">http://thishost[:thisport]/</span> (создающий новый URL из какого-либо URI) запускает внешний редирект (перенаправление). Если нет накакого <span style=" font-style:italic;">кода</span> в подстановке ответ будет с HTTP статусом 302 (ВРЕМЕННО ПЕРЕМЕЩЕН). Если вы хотите использовать дркгие коды ответов в диапазоне 300-400, просто напишите их в виде числа или используйте одно из следующих символических имён: <span style=" font-family:'Courier New,courier';">temp</span> (по-умолчанию), <span style=" font-family:'Courier New,courier';">permanent</span>, <span style=" font-family:'Courier New,courier';">seeother</span>. Используйте это в директивах, которые должны преобразовывать некие виртуальные URL в реальные и возвращать их клиенту, <span style=" font-style:italic;">например</span>, преобразовывать &quot;<span style=" font-family:'Courier New,courier';">/~</span>&quot; в &quot;<span style=" font-family:'Courier New,courier';">/u/</span>&quot; или всегда добавлять слэш к <span style=" font-family:'Courier New,courier';">/u/</span><span style=" font-style:italic;">user</span>, и т.д.<br /></li>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-weight:600;">Примечание:</span> При использовании этого флага, убедитесь, что поле подстановки, это работающий URL! Если это не так, вы перенаправляете в никуда! И помните, что сам по себе этот флаг, только дополняет URL строкой <span style=" font-family:'Courier New,courier';">http://thishost[:thisport]/</span>, и процесс преобразования продолжается. Также, обычно вы хотите остановиться и сделать этот редирект немедленно. Для остановки процесса преобразования, вам также нужно написать флаг 'L'. </p>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-family:'Courier New,courier'; font-weight:600;">forbidden|F</span>' (делает URL запрещенным)<br />Это делает текущий URL запрещённым, <span style=" font-style:italic;">например</span>, клиенту немедленно отправляется ответ с HTTP статусом 403 (ЗАПРЕЩЕНО). Используйте этот флаг в сочетании с соответствующими RewriteConds для блокирования URL по некоторым критериям. </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-family:'Courier New,courier'; font-weight:600;">gone|G</span>' (делает URL &quot;мёртвым&quot;)<br />Этот флаг делает текущий URL &quot;мертвым&quot;, <span style=" font-style:italic;">т.е.</span>, немедленно отправляется HTTP ответ со статусом 410 (GONE). Используйте этот флаг для маркировки &quot;мертвыми&quot; не существующие более страницы. </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-family:'Courier New,courier'; font-weight:600;">proxy|P</span>' (вызвает прокси)<br />Этот флаг помечает подстановочную часть как внутренний запрос прокси и немедленно (<span style=" font-style:italic;">т.е.</span>, процесс преобразования здесь останавливается) пропускает его через <a href="http://www.egoroff.spb.ru/portfolio/mod_proxy.html"><span style=" text-decoration: underline; color:#0000ff;">прокси модуль</span></a>. Вы должны убедиться, что строка подстановки это реальный URI (<span style=" font-style:italic;">например</span>, типично начинающийся с <span style=" font-family:'Courier New,courier';">http://</span><span style=" font-style:italic;">hostname</span>), который может быть обработан прокси модулем Apache. Если это не так, вы получите ошибку от прокси модуля. Используйте этот флаг для того, чтобы добиться более мощной реализации диркетивы <a href="http://www.egoroff.spb.ru/portfolio/mod_proxy.html#proxypass"><span style=" text-decoration: underline; color:#0000ff;">ProxyPass</span></a>, интегрирующей некоторое содержимое на удаленных серверах, в пространство имён локального сервера. </li>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">Примечание: Для того чтобы это использовать убедитесь что у вас есть работающий прокси модуль на вашем сервере Apache. Если вы не знаете этого проверьте есть ли в выводе &quot;<span style=" font-family:'Courier New,courier';">httpd -l</span>&quot; строчка <span style=" font-family:'Courier New,courier';">mod_proxy.c</span>. Если да, эти возможности доступны mod_rewrite. Если нет, то сначала вы должны пересобрать программу &quot;<span style=" font-family:'Courier New,courier';">httpd</span>&quot; с включенным прокси модулем. </p>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-family:'Courier New,courier'; font-weight:600;">last|L</span>' (последнее правило)<br />Остановить процесс преобразования на этом месте и не применять больше никаких правил преобразований. Это соответствует оператору <span style=" font-family:'Courier New,courier';">last</span> в Perl или оператору <span style=" font-family:'Courier New,courier';">break</span> в языке C. Используйте этот флаг для того, чтобы не преобразовывать текущий URL другими, следующими за этим, правилами преобразований. К примеру, используйте это для преобразования корневого URL из ('<span style=" font-family:'Courier New,courier';">/</span>') в реальный, <span style=" font-style:italic;">например</span>, '<span style=" font-family:'Courier New,courier';">/e/www/</span>'. </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-family:'Courier New,courier'; font-weight:600;">next|N</span>' (следуюший раунд)<br />Перезапустить процесс преобразований (начав с первого правила). В этом случае URL снова сопоставляется неким условиям, но не оригинальный URL, а URL вышедший из последнего правила преобразования. Это соответствует оператору <span style=" font-family:'Courier New,courier';">next</span> в Perl или оператору <span style=" font-family:'Courier New,courier';">continue</span> из языка C. Используйте этот флаг для перезапуска процесса преобразований, <span style=" font-style:italic;">т.е.</span>, безусловному переходу на начало цикла.<br /><span style=" font-weight:600;">Однако будьте осторожны, для того чтобы не сделать бесконечный цикл!</span> </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-family:'Courier New,courier'; font-weight:600;">chain|C</span>' (связь со следующим правилом)<br />Этот флаг связывает текущее правило со следующим (которое, в свою очередь, может быть связано со следующим за ним, <span style=" font-style:italic;">и т.д.</span>). Это имеет следующий эффект: если есть соответствие правилу, процесс продолжается как обычно, <span style=" font-style:italic;">т.е.</span>, флаг не производит никакого эффекта. Если правило <span style=" font-weight:600;">не</span> соответствует условию, все следующие, связанные правила, пропускаются. Например, импользуйте это для удаления &quot;<span style=" font-family:'Courier New,courier';">.www</span>&quot; части в конфигурационном правиле контекста каталога работающего когда вы разрешаете внешний редирект (где не должно быть &quot;<span style=" font-family:'Courier New,courier';">.www</span>&quot;!). </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-family:'Courier New,courier'; font-weight:600;">type|T</span>=<span style=" font-style:italic;">MIME-тип</span>' (принудительно установить MIME <span style=" font-weight:600;">т</span>ип)<br />Принудительно установить MIME-тип целевого файла в <span style=" font-style:italic;">MIME-тип</span>. К примеру, это можно использовать для имитации <span style=" font-family:'Courier New,courier';">mod_alias</span> директивы <span style=" font-family:'Courier New,courier';">ScriptAlias</span> которая принудительно устанавливает для всех файлов внутри отображаемого каталога MIME тип равный &quot;<span style=" font-family:'Courier New,courier';">application/x-httpd-cgi</span>&quot;. </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-family:'Courier New,courier'; font-weight:600;">nosubreq|NS</span>' (используется только в случае <span style=" font-weight:600;">не</span>внутреннего подзапроса)<br />Этот флаг дает команду механизму преобразований пропустить директиву если текущий подзапрос является внутренним подзапросом. К примеру, внутренние подзапросы в Apache происходят тогда, когда <span style=" font-family:'Courier New,courier';">mod_include</span> пытается получить информацию о возможных файлах по-умолчанию для каталогов (<span style=" font-family:'Courier New,courier';">index.xxx</span>). При подзапросах это не всегда полезно и даже иногда вызывает проблему в работе всего набора директив преобразований. Используйте этот флаг для исключения некоторых правил.<br /></li>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">Используйте следующее правило по своему усмотрению: всякий раз когда вы предваряете некоторые URL префиксом передавая их на обработку CGI-скрипту, - велик шанс что вы напоретесь на проблемы (или даже на ненужные издержки) в случае применения подзапросов. В этих случаях, используйте этот флаг. </p>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-family:'Courier New,courier'; font-weight:600;">nocase|NC</span>' (не учитывать регистр)<br />Это делает <span style=" font-style:italic;">Шаблон</span> нечуствительным к регистру, <span style=" font-style:italic;">т.е.</span>, нет различий между 'A-Z' и 'a-z' когда <span style=" font-style:italic;">Шаблон</span> применяется к текущему URL. </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-family:'Courier New,courier'; font-weight:600;">qsappend|QSA</span>' (добавлять строку запроса)<br />Этот флаг указывает механизму преобразований на добавление а не замену, строки запроса из URL к существующей, в строке подстановки. Используйте это когда вы хотите добавлять дополнительные данные в строку запроса с помощью директив преобразований. </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-family:'Courier New,courier'; font-weight:600;">noescape|NE</span>' (не экранировать URI при выводе)<br />Этот флаг не даёт mod_rewrite применять обычные правила экранирования URI к результату преобразования. Обычно, специальные символы (такие как '%', '$', ';', и так далее) будут экранированы их шестнадцатиричными подстановками ('%25', '%24', и '%3B', соответственно); этот флаг не дает это делать. Это позволяет символам процента появлятся на выходе , как в </li>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteRule /foo/(.*) /bar?arg=P1\%3d$1 [R,NE] </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">для которого '<span style=" font-family:'Courier New,courier';">/foo/zed</span>' преобразовывалось бы в безопасный запрос '<span style=" font-family:'Courier New,courier';">/bar?arg=P1=zed</span>'. </p>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-family:'Courier New,courier'; font-weight:600;">passthrough|PT</span>' (пропускать через следующий обработчик)<br />Этот флаг даёт команду механизму преобразований устанавливать поле <span style=" font-family:'Courier New,courier';">uri</span> внутренней структуры <span style=" font-family:'Courier New,courier';">request_rec</span> равным полю <span style=" font-family:'Courier New,courier';">filename</span>. Этот флаг, просто лишь хитрый трюк, для того чтобы иметь возможность обработки вывода директив <span style=" font-family:'Courier New,courier';">RewriteRule</span>, директивами <span style=" font-family:'Courier New,courier';">Alias</span>, <span style=" font-family:'Courier New,courier';">ScriptAlias</span>, <span style=" font-family:'Courier New,courier';">Redirect</span>, <span style=" font-style:italic;">и т.д.</span> из других трансляторов URI-имя файла. Тривиальный пример для показа этой семантики: если вы хотите преобразовать <span style=" font-family:'Courier New,courier';">/abc</span> в <span style=" font-family:'Courier New,courier';">/def</span> с использованием механизма преобразований <span style=" font-family:'Courier New,courier';">mod_rewrite</span> и затем <span style=" font-family:'Courier New,courier';">/def</span> в <span style=" font-family:'Courier New,courier';">/ghi</span> с использованием <span style=" font-family:'Courier New,courier';">mod_alias</span>: </li>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteRule ^/abc(.*) /def$1 [PT]<br />Alias /def /ghi </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">Если вы опустите флаг <span style=" font-family:'Courier New,courier';">PT</span>, <span style=" font-family:'Courier New,courier';">mod_rewrite</span> прекрасно сделаетс свою работу, <span style=" font-style:italic;">т.е.</span>, он преобразует <span style=" font-family:'Courier New,courier';">uri=/abc/...</span> в <span style=" font-family:'Courier New,courier';">filename=/def/...</span> как должен делать полностью API-совместимый транслятор URI-имя файла. Затем настаёт очередь <span style=" font-family:'Courier New,courier';">mod_alias</span> пытающегося сделать переход URI-имя файла который и не будет работать. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">Примечание: <span style=" font-weight:600;">Вы должны использовать этот флаг если вы хотите смешивать директивы разных модулей содержащих трансляторы URL-имя файла</span>. Типичный пример это использование модулей <span style=" font-family:'Courier New,courier';">mod_alias</span> и <span style=" font-family:'Courier New,courier';">mod_rewrite</span>.. </p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Для любителей поковыряться в Apache</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">Если бы текущий Apache API имел какой-нибудь перехватчик имя файла-имя файла в дополнение к перехватчику URI-имя файла нам бы не понадобился данный флаг! Однако без такого перехватчика этот флаг это единственное решение. The Apache Group обсудила эту проблему и добавит такой перехватчик во 2-й версии Apache. </p>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-family:'Courier New,courier'; font-weight:600;">skip|S</span>=<span style=" font-style:italic;">количество</span>' (пропустить следующее правило(а))<br />Этот флаг указывает механизму преобразований пропускать следующее <span style=" font-style:italic;">количество</span> правил в последовательности начинающейся с текущего правила. Используйте это для создания псевдо if-then-else конструкций: Последнее правило блока then будет <span style=" font-family:'Courier New,courier';">skip=N</span> где N количество правил блока else. (Это <span style=" font-weight:600;">не</span> то же самое что и флаг 'chain|C'!) </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-family:'Courier New,courier'; font-weight:600;">env|E=</span><span style=" font-style:italic;">VAR</span>:<span style=" font-style:italic;">VAL</span>' (установить переменную окуржения)<br />Присваивает переменной окружения <span style=" font-style:italic;">VAR</span> значение <span style=" font-style:italic;">VAL</span>, где <span style=" font-style:italic;">VAL</span> может содержать обратные связи <span style=" font-family:'Courier New,courier';">$N</span> и <span style=" font-family:'Courier New,courier';">%N</span> ссылающиеся на части регулярных выражений, которые будут раскрыты соответствующим образом. Вы можете использовать этот флаг более одного раза чтобы присвоить значение более чем одной переменной. Позже, эти переменные могут быть использованы во многих ситуациях, обычно в XSSI (через <span style=" font-family:'Courier New,courier';">&lt;!--#echo var=&quot;VAR&quot;--&gt;</span>) или в CGI скриптах (<span style=" font-style:italic;">например</span> <span style=" font-family:'Courier New,courier';">$ENV{'VAR'}</span>). Кроме того, вы можете это использовать в следующем шаблоне RewriteCond через <span style=" font-family:'Courier New,courier';">%{ENV:VAR}</span>. Используйте это для удаления, но запоминания некоторой информации из URL. </li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'<span style=" font-family:'Courier New,courier'; font-weight:600;">cookie|CO=</span><span style=" font-style:italic;">NAME</span>:<span style=" font-style:italic;">VAL</span>:<span style=" font-style:italic;">domain</span>[:<span style=" font-style:italic;">lifetime</span>[:<span style=" font-style:italic;">path</span>]]' (записать <span style=" font-weight:600;">co</span>cookie)<br />Записывает cookie клиенту. Имя cookie указывается в <span style=" font-style:italic;">NAME</span> а его значение в <span style=" font-style:italic;">VAL</span>. Поле <span style=" font-style:italic;">domain</span> это домен cookie, такой как например '.apache.org', опциональное <span style=" font-style:italic;">lifetime</span> это время жизни cookie в минутах, и опциональный <span style=" font-style:italic;">path</span> это путь cookie </li></ul>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Примечание</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Никогда не забываёте что <span style=" font-style:italic;">Шаблон</span> применяется ко всему URL в конфигурационных файла сервера. <span style=" font-weight:600;">Однако в конфигурационных файлах каталогов, префикс каталога (который всегда одинаков для конкретного каталога !), автоматически </span><span style=" font-weight:600; font-style:italic;">удаляется</span><span style=" font-weight:600;"> при соответствии шаблону и автоматически </span><span style=" font-weight:600; font-style:italic;">добавляется</span><span style=" font-weight:600;"> после завершения подстановки. </span>Эта особенность, основа для многих видов преобразований, потому что без удаления префикса для родительского каталога тоже должно быть соответствие, что не всегда возможно. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Есть одно исключение: Если строка подстановки начинается с &quot;<span style=" font-family:'Courier New,courier';">http://</span>&quot; в этом случае префикс каталога <span style=" font-weight:600;">не</span> добавляется и происходит либо внешний редирект либо пропускание через прокси (если используется флаг <span style=" font-weight:600;">P</span>!)! </p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Примечание</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для того чтобы включить механизм преобразований в конфигурационных файлах каталогов вам нужно написать &quot;<span style=" font-family:'Courier New,courier';">RewriteEngine On</span>&quot; в этих самых файлах <span style=" font-weight:600;">и</span>, кроме того, должна быть разрешена конфигурационная директива &quot;<span style=" font-family:'Courier New,courier';">Options FollowSymLinks</span>&quot;. Если ваш администратор запретил перегрузку конфигурационной директивы <span style=" font-family:'Courier New,courier';">FollowSymLinks</span> в пользовательских каталогах, в этом случае вы не сможете использовать механизм преобразований. Это ограничение нужно по соображениям безопасности. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вот все возможные комбинации подстановок с расшифровкой их значений: </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">В конфигурационных файлах контекста сервера (</span><span style=" font-family:'Courier New,courier'; font-weight:600;">httpd.conf</span><span style=" font-weight:600;">)<br />для запроса вида &quot;</span><span style=" font-family:'Courier New,courier'; font-weight:600;">GET /somepath/pathinfo</span><span style=" font-weight:600;">&quot;:</span><br /></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-weight:600;">Правило</span><span style=" font-family:'Courier New,courier';">                                         </span><span style=" font-family:'Courier New,courier'; font-weight:600;">Подстановка</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">----------------------------------------------  ----------------------------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^/somepath(.*) otherpath$1                      не поддерживается, т.к. неверно!</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^/somepath(.*) otherpath$1  [R]                 не поддерживается, т.к. неверно!</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^/somepath(.*) otherpath$1  [P]                 не поддерживается, т.к. неверно!</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">----------------------------------------------  ----------------------------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^/somepath(.*) /otherpath$1                     /otherpath/pathinfo</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^/somepath(.*) /otherpath$1 [R]                 http://thishost/otherpath/pathinfo</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                                                через внешний редирект</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^/somepath(.*) /otherpath$1 [P]                 не поддерживается, - глупо!</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">----------------------------------------------  ----------------------------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^/somepath(.*) http://thishost/otherpath$1      /otherpath/pathinfo</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^/somepath(.*) http://thishost/otherpath$1 [R]  http://thishost/otherpath/pathinfo</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                                                через внешний редирект</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^/somepath(.*) http://thishost/otherpath$1 [P]  не поддерживается, - глупо!</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">----------------------------------------------  ----------------------------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^/somepath(.*) http://otherhost/otherpath$1     http://otherhost/otherpath/pathinfo</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                                                через внешний редирект</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^/somepath(.*) http://otherhost/otherpath$1 [R] http://otherhost/otherpath/pathinfo</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                                                через внешний редирект</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                                                (флаг [R] избыточен)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^/somepath(.*) http://otherhost/otherpath$1 [P] http://otherhost/otherpath/pathinfo</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                                                через внутренний прокси </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Внутри конфигурационного файла каталога, для </span><span style=" font-family:'Courier New,courier'; font-weight:600;">/somepath</span><span style=" font-weight:600;"><br />(</span><span style=" font-weight:600; font-style:italic;">т.е.</span><span style=" font-weight:600;">, файл </span><span style=" font-family:'Courier New,courier'; font-weight:600;">.htaccess</span><span style=" font-weight:600;"> в каталоге </span><span style=" font-family:'Courier New,courier'; font-weight:600;">/physical/path/to/somepath</span><span style=" font-weight:600;"> содержит </span><span style=" font-family:'Courier New,courier'; font-weight:600;">RewriteBase /somepath</span><span style=" font-weight:600;">)<br />для запроса &quot;</span><span style=" font-family:'Courier New,courier'; font-weight:600;">GET /somepath/localpath/pathinfo</span><span style=" font-weight:600;">&quot;:</span><br /></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-weight:600;">Правило</span><span style=" font-family:'Courier New,courier';">                                         </span><span style=" font-family:'Courier New,courier'; font-weight:600;">Подстановка</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">----------------------------------------------  ----------------------------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^localpath(.*) otherpath$1                      /somepath/otherpath/pathinfo</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^localpath(.*) otherpath$1  [R]                 http://thishost/somepath/otherpath/pathinfo</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                                                через внешний редирект</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^localpath(.*) otherpath$1  [P]                 не поддерживается, - глупо!</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">----------------------------------------------  ----------------------------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^localpath(.*) /otherpath$1                     /otherpath/pathinfo</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^localpath(.*) /otherpath$1 [R]                 http://thishost/otherpath/pathinfo</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                                                через внешний редирект</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^localpath(.*) /otherpath$1 [P]                 не поддерживается, - глупо!</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">----------------------------------------------  ----------------------------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^localpath(.*) http://thishost/otherpath$1      /otherpath/pathinfo</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^localpath(.*) http://thishost/otherpath$1 [R]  http://thishost/otherpath/pathinfo</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                                                через внешний редирект</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^localpath(.*) http://thishost/otherpath$1 [P]  не поддерживается, - глупо!</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">----------------------------------------------  ----------------------------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^localpath(.*) http://otherhost/otherpath$1     http://otherhost/otherpath/pathinfo</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                                                через внешний редирект</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^localpath(.*) http://otherhost/otherpath$1 [R] http://otherhost/otherpath/pathinfo</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                                                через внешний редирект</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                                                (флаг [R] избыточен)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^localpath(.*) http://otherhost/otherpath$1 [P] http://otherhost/otherpath/pathinfo</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">                                                через внутренний прокси </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Пример:</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Мы хотим преобразовать URL вида </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">/</span> <span style=" font-style:italic;">Language</span> <span style=" font-family:'Courier New,courier';">/~</span> <span style=" font-style:italic;">Realname</span> <span style=" font-family:'Courier New,courier';">/.../</span> <span style=" font-style:italic;">File</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">в </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">/u/</span> <span style=" font-style:italic;">Username</span> <span style=" font-family:'Courier New,courier';">/.../</span> <span style=" font-style:italic;">File</span> <span style=" font-family:'Courier New,courier';">.</span> <span style=" font-style:italic;">Language</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Мы берем файл, содержащий ассоциативный массив для преобразований, приведённый выше и сохраняем его под именем <span style=" font-family:'Courier New,courier';">/path/to/file/map.txt</span>. Затем, нам нужно только добавить следующие строчки в конфигурационный файл сервера Apache: </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteLog   /path/to/file/rewrite.log</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteMap   real-to-user               txt:/path/to/file/map.txt</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteRule  ^/([^/]+)/~([^/]+)/(.*)$   /u/${real-to-user:$2|nobody}/$3.$1 </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>
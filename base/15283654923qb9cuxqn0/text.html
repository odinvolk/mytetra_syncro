<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Достаточно часто (если не сказать, что всегда) при настройке нового сервера необходимо настроить синхронизацию времени и выставить правильный часовой пояс. В Linux это совсем не сложно и очень быстро. Я не буду описывать как это делается с помощью графических утилит, так как на серверах их нет по определению, а вот терминал есть везде, где есть Linux.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Шаг первый:</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />Проверяем текущие дату и время.<br /></span><span style=" font-family:'monospace'; font-size:9pt;"># date<br />Пнд Янв 9 09:50:25 CET 2012</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />CET - и есть наш текущий часовой пояс, установленный в системе. Так как мне, например, необходимо время московское, то мы и будем устанавливать московское время.<br />Список всех доступных часовых поясов можно найти в каталоге /usr/share/zoneinfo.<br /></span><span style=" font-family:'monospace'; font-size:9pt;"># ls /usr/share/zoneinfo</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Шаг второй:</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />Создаём резервную копию файла текущих настроек.<br />Этот шаг, в принципе, можно пропустить, но меня будет мучать совесть, если Вы этого не сделаете.<br /></span><span style=" font-family:'monospace'; font-size:9pt;"># sudo mv /etc/localtime /etc/localtime-backup</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Шаг третий:</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />Создаем символическую ссылку на необходимый нам timezone:<br /></span><span style=" font-family:'monospace'; font-size:9pt;"># sudo ln -sf /usr/share/zoneinfo/Europe/Moscow /etc/localtime</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />Хочется предостеречь от достаточно частой ошибки, ни в коем случае нельзя просто скопировать этот файл, так как если Вы его скопируете с помощью команды cp, то любое обновление данной timezone пройдёт для Вас незамеченным. А я думаю все помнят изменения с переводом времени в 2011 году?</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Шаг четвёртый:</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />Дублируем значение параметра ZONE в файле /etc/sysconfig/clock и устанавливаем его равным &quot;Europe/Moscow&quot;.<br /></span><span style=" font-family:'monospace'; font-size:9pt;"># sudo vi /etc/sysconfig/clock</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">В принципе, для подавляющего большинства современных дистрибутивов Linux на этих, достаточно простых шагах, можно и остановиться, так как самая главная и наиболее часто встречающаяся задача нами выполнена. Но мы пойдём дальше и попробуем разобраться с системными часами и синхронизацией времени.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Шаг пятый:</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />Установка аппаратных часов.<br />Для установки аппаратных часов существуют две команды: setclock и hwclock.<br />setclock - это высокоуровневая версия hwclock, которая не требует никаких параметров для запуска. Она сама выбирает какие параметры передать hwclock на основании сделанных нами выше настроек операционной системы.<br /></span><span style=" font-family:'monospace'; font-size:9pt;"># setclock</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />Использование setclock предпочтительнее, однако не во всех системах она установлена. Увы...</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">hwclock - устанавливает параметры аппаратных часов на основании переданных ему данных.<br />Использование:<br />Считываем системное время:<br /></span><span style=" font-family:'monospace'; font-size:9pt;"># sudo hwclock<br />Пнд 09 Янв 2012 14:09:46 -0.239259 секунд<br /></span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />Устанавливаем время аппаратных часов равное системному:<br /></span><span style=" font-family:'monospace'; font-size:9pt;">sudo hwclock --systohc</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />Устанавливаем время аппаратных часов равное UTC, но на основании системного времени:<br /></span><span style=" font-family:'monospace'; font-size:9pt;">sudo hwclock --systohc --utc</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />И устанавливаем время равное указанному:<br /></span><span style=" font-family:'monospace'; font-size:9pt;">sudo hwclock --set --date &quot;09 Jan 2012 14:11&quot;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Шаг шестой:</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />Установка пакета ntpdate, если он не установлен, конечно.<br /></span><span style=" font-family:'monospace'; font-size:9pt;"># sudo yum install ntpdate</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Шаг седьмой:</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />Ручная синхронизация времени.<br /></span><span style=" font-family:'monospace'; font-size:9pt;"># sudo ntpdate pool.ntp.org<br />9 Jan 14:21:47 ntpdate[2063]: adjust time server 178.63.64.14 offset 0.000866 sec</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />Список достаточно большого количества ntp серверов можно найти по следующей ссылке </span><a href="http://support.ntp.org/bin/view/Servers/WebHome"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#0000ff;">The Public NTP Time Server Lists</span></a><span style=" font-family:'Sans Serif'; font-size:9pt;">.<br />Отредактировать список серверов или же добавить свой можно в файле конфигурации ntpd: /etc/ntp.conf.<br /></span><span style=" font-family:'monospace'; font-size:9pt;">server pool.ntp.org prefer<br />server another.ntp.server</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;"># sudo vi /etc/ntp.conf</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Шаг восьмой:</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />Настройка автоматической синхронизации времени.<br />Для автоматической синхронизации времени достаточно всего лишь запустить демон ntpd.<br /></span><span style=" font-family:'monospace'; font-size:9pt;"># sudo service ntpd start</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">А для того, чтобы демон стартовал при перезагрузке сервера, необходимо выполнить следующую команду:<br /></span><span style=" font-family:'monospace'; font-size:9pt;"># sudo chkconfig --level 2345 ntpd on</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Шаг девятый, необязательный:</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />Наблюдение за синхронизацией.<br /></span><span style=" font-family:'monospace'; font-size:9pt;"># ntpq -p</span></p></body></html>
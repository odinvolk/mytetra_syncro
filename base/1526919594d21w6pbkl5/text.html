<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Ниже представлен автоматический перевод статьи с официального сайта developer.android.com. В статье, помимо общего описания взаимодействия по Bluetooth BLE есть раздел, в котором расписываются опции, которые надо прописать в манифест <span style=" font-family:'FreeMono'; color:#6a1009;">AndroidManifest.xml</span>, чтобы Android-приложение смогло работать с Bluetooth.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:xx-large; font-weight:600;">Обзор Bluetooth BLE</span></p>
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Android 4.3 (API уровня 18) представляет встроенную поддержку платформы для Bluetooth Low Energy (BLE) в <span style=" font-style:italic;">центральной роли</span> и предоставляет API, которые приложения могут использовать для обнаружения устройств, для запросов на услуги и для передачи информации. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В общем случае, использование включает следующее: </p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Передача небольших объемов данных между соседними устройствами. </li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Взаимодействие с датчиками приближения, такими как <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developers.google.com/beacons/&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhi-T8c6G___HQtTTNqFgkaKdxJMLg"><span style=" text-decoration: underline; color:#0000ff;">Google Beacons,</span></a> чтобы дать пользователям индивидуальный опыт, основанный на их текущем местоположении. </li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В отличие от <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/guide/topics/connectivity/bluetooth.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhiD7RDWDeaaysB08vk43yBGwDEnmQ"><span style=" text-decoration: underline; color:#0000ff;">классического Bluetooth</span></a> , технология Bluetooth Low Energy (BLE) предназначена для обеспечения значительно более низкого энергопотребления. Это позволяет приложениям Android взаимодействовать с устройствами BLE, которые имеют более строгие требования к питанию, такие как датчики приближения, мониторы сердечного ритма и фитнес-устройства. </p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="terms"></a><span style=" font-size:x-large; font-weight:600;">К</span><span style=" font-size:x-large; font-weight:600;">лючевые термины и понятия </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Ниже приведен краткий обзор ключевых терминов и понятий BLE: </p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Профиль общих атрибутов (GATT).</span> Профиль GATT является общей спецификацией для отправки и получения коротких фрагментов данных, известных как «атрибуты» по ссылке BLE. Все текущие профили приложений Low Energy основаны на GATT. </li>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Bluetooth SIG определяет множество <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://www.bluetooth.org/en-us/specification/adopted-specifications&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhhjXnHoMFfQH4eWvmAuMu6T-PQUNg"><span style=" text-decoration: underline; color:#0000ff;">профилей</span></a> для устройств с низкой энергией. Профиль - это спецификация того, как устройство работает в конкретном приложении. Обратите внимание, что устройство может реализовать более одного профиля. Например, устройство может содержать монитор сердечного ритма и детектор уровня заряда батареи. </li></ul>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Протокол атрибута (ATT)</span> -GATT построен поверх протокола атрибутов (ATT). Это также называется GATT / ATT. ATT оптимизирован для работы на устройствах BLE. Для этого он использует как можно меньше байтов. Каждый атрибут уникально идентифицируется универсально уникальным идентификатором (UUID), который является стандартизованным 128-битным форматом для идентификатора строки, используемого для уникальной идентификации информации. <span style=" font-style:italic;">Атрибуты</span> , передаваемые ATT, отформатированы как <span style=" font-style:italic;">характеристики</span> и <span style=" font-style:italic;">сервисы</span> . </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Характеристика</span> - Характеристика содержит одно значение и 0-n дескрипторы, которые описывают значение признака. Характеристику можно рассматривать как тип, аналогичный классу. </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Дескриптор -</span> дескрипторы - это атрибуты, которые описывают характеристическое значение. Например, дескриптор может указывать читаемое человеком описание, допустимый диапазон для значения признака или единицу измерения, которая является специфической для значения признака. </li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Сервис-</span> Сервис - это набор характеристик. Например, у вас может быть услуга «Heart Rate Monitor», которая включает такие характеристики, как «измерение сердечного ритма». Вы можете найти список существующих профилей и сервисов на основе GATT на <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://www.bluetooth.org/en-us/specification/adopted-specifications&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhhjXnHoMFfQH4eWvmAuMu6T-PQUNg"><span style=" text-decoration: underline; color:#0000ff;">bluetooth.org</span></a> . </li></ul>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="roles"></a><span style=" font-size:large; font-weight:600;">Р</span><span style=" font-size:large; font-weight:600;">оли и обязанности </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вот роли и обязанности, которые применяются, когда устройство Android взаимодействует с устройством BLE: </p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Центральный и периферийный. Это относится к самому соединению BLE. Объявление в центральной роли сканирует, ищет рекламу и устройство в периферийной роли. </li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">GATT-сервер против клиента GATT. Это определяет, как два устройства разговаривают друг с другом, как только они установили соединение. </li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Чтобы понять различие, представьте, что у вас есть телефон Android и трекер активности, который является устройством BLE. Телефон поддерживает центральную роль; отслеживатель активности поддерживает периферийную роль (для установления соединения BLE вам понадобится одна из двух вещей, которые поддерживают только периферийные устройства, не могут разговаривать друг с другом, а также две вещи, которые поддерживают только центральную). </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Как только телефон и отслеживатель активности установили соединение, они начинают передавать метаданные GATT друг другу. В зависимости от типа передаваемых данных один или другой может действовать как сервер. Например, если трекер активности хочет сообщить данные о датчике на телефон, может быть смысл отслеживать активность в качестве сервера. Если трекер активности хочет получать обновления с телефона, тогда для телефона может иметь смысл действовать как сервер. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В примере, используемом в этом документе, приложение Android (работает на устройстве Android) является клиентом GATT. Приложение получает данные с сервера GATT, который является монитором сердечного ритма BLE, который поддерживает <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=http://developer.bluetooth.org/TechnologyOverview/Pages/HRP.aspx&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhidd_AlxM8-4IK1jgiGoBXaCmWFyA"><span style=" text-decoration: underline; color:#0000ff;">профиль</span></a> сердечного ритма. Но вы могли бы также разработать свое приложение для Android, чтобы играть роль сервера GATT. См. <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/bluetooth/BluetoothGattServer.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhgJvR43smUv40DHMAfgFjTiWMWtqQ"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">BluetoothGattServer</span></a> для получения дополнительной информации. </p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="permissions"></a><span style=" font-size:x-large; font-weight:600;">Р</span><span style=" font-size:x-large; font-weight:600;">азрешения BLE </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Чтобы использовать функции Bluetooth в своем приложении, вы должны объявить разрешение Bluetooth <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/Manifest.permission.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhj2hM4lyCYJ4HKF52akma61XjoZPw#BLUETOOTH"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">BLUETOOTH</span></a> . Это разрешение требуется для выполнения любой связи Bluetooth, такой как запрос на соединение, прием соединения и передача данных. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если вы хотите, чтобы ваше приложение инициировало обнаружение устройства или манипулировало настройками Bluetooth, вы также должны объявить разрешение <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/Manifest.permission.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhj2hM4lyCYJ4HKF52akma61XjoZPw#BLUETOOTH_ADMIN"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">BLUETOOTH_ADMIN</span></a> . <span style=" font-weight:600;">Примечание.</span> Если вы используете разрешение <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/Manifest.permission.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhj2hM4lyCYJ4HKF52akma61XjoZPw#BLUETOOTH_ADMIN"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">BLUETOOTH_ADMIN</span></a> , вы также должны иметь разрешение <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/Manifest.permission.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhj2hM4lyCYJ4HKF52akma61XjoZPw#BLUETOOTH"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">BLUETOOTH</span></a> . </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Объявите разрешения (ы) Bluetooth в файле манифеста приложения. Например: </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> &lt;uses-permission android: name = &quot;android.permission.BLUETOOTH&quot; /&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> &lt;uses-permission android: name = &quot;android.permission.BLUETOOTH_ADMIN&quot; /&gt; </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если вы хотите заявить, что ваше приложение доступно только для устройств с поддержкой BLE, включите в манифест приложения следующее: </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">  &lt;uses-feature android: name = &quot;android.hardware.bluetooth_le&quot; android: required = &quot;true&quot; /&gt;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Однако, если вы хотите, чтобы ваше приложение было доступно для устройств, которые не поддерживают BLE, вы все равно должны включать этот элемент в манифест вашего приложения, но установите <span style=" font-family:'monospace';">required=&quot;false&quot;</span> . Затем во время выполнения вы можете определить доступность BLE с помощью <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/content/pm/PackageManager.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhh5FfoCC4-q9uK-ompTm3qVy11KiQ#hasSystemFeature%28java.lang.String%29"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">PackageManager.hasSystemFeature()</span></a> : </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">  // Используйте эту проверку, чтобы определить, поддерживается ли BLE на устройстве.  затем</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> // вы можете выборочно отключать связанные с BLE функции.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> if (! getPackageManager (). hasSystemFeature (PackageManager.FEATURE_BLUETOOTH_LE)) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     Toast.makeText (это, R.string.ble_not_supported, Toast.LENGTH_SHORT) .show ();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     Конец();</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> } </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Примечание:</span> Маяки LE часто связаны с местоположением. Чтобы использовать <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/bluetooth/le/BluetoothLeScanner.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhh5a-TRY7wMoJlJl7z76Fhn0XHY4A"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">BluetoothLeScanner</span></a> без фильтра, вы должны запросить разрешение пользователя, объявив либо разрешение <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/Manifest.permission.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhj2hM4lyCYJ4HKF52akma61XjoZPw#ACCESS_COARSE_LOCATION"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">ACCESS_COARSE_LOCATION</span></a> либо <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/Manifest.permission.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhj2hM4lyCYJ4HKF52akma61XjoZPw#ACCESS_FINE_LOCATION"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">ACCESS_FINE_LOCATION</span></a> в файле манифеста приложения. Без этих разрешений сканирование не вернет никаких результатов. </p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="setup"></a><span style=" font-size:x-large; font-weight:600;">Н</span><span style=" font-size:x-large; font-weight:600;">астроить BLE </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Прежде чем ваше приложение сможет связываться через BLE, вам необходимо убедиться, что BLE поддерживается на устройстве, и если да, убедитесь, что он включен. Обратите внимание, что эта проверка необходима только в том случае, если для параметра <span style=" font-family:'monospace';">&lt;uses-feature.../&gt;</span> установлено значение false. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если BLE не поддерживается, вы должны изящно отключить любые функции BLE. Если BLE поддерживается, но отключен, вы можете запросить, чтобы пользователь включил Bluetooth, не покидая приложение. Эта настройка выполняется в два этапа с использованием <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/bluetooth/BluetoothAdapter.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhjbxP-RS9bUKfpGGoofw4-7qiad4g"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">BluetoothAdapter</span></a> . </p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Получить <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/bluetooth/BluetoothAdapter.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhjbxP-RS9bUKfpGGoofw4-7qiad4g"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">BluetoothAdapter</span></a> </li>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/bluetooth/BluetoothAdapter.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhjbxP-RS9bUKfpGGoofw4-7qiad4g"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">BluetoothAdapter</span></a> необходим для любой активности Bluetooth. <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/bluetooth/BluetoothAdapter.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhjbxP-RS9bUKfpGGoofw4-7qiad4g"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">BluetoothAdapter</span></a> представляет собой собственный Bluetooth-адаптер устройства (Bluetooth-радио). Для всей системы есть один адаптер Bluetooth, и ваше приложение может взаимодействовать с ним с помощью этого объекта. Ниже показан фрагмент ниже, как получить адаптер. Обратите внимание, что этот подход использует <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/content/Context.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhiA8P-Kk0sfBfFVj2zpVRVBNzky9Q#getSystemService%28java.lang.Class%3CT%3E%29"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">getSystemService()</span></a> для возврата экземпляра <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/bluetooth/BluetoothManager.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhg_yRJXOGIDI3BivjU2Ltw7muYwsA"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">BluetoothManager</span></a> , который затем используется для получения адаптера. Android 4.3 (API Level 18) представляет <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/bluetooth/BluetoothManager.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhg_yRJXOGIDI3BivjU2Ltw7muYwsA"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">BluetoothManager</span></a> : </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'monospace';">  частный Bluetooth-адаптер mBluetoothAdapter;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'monospace';"> ...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'monospace';"> // Инициализирует адаптер Bluetooth.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'monospace';"> окончательный BluetoothManager bluetoothManager =</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'monospace';">         (BluetoothManager) getSystemService (Context.BLUETOOTH_SERVICE);</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'monospace';"> mBluetoothAdapter = bluetoothManager.getAdapter ();</span></p>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Включить Bluetooth </li></ol>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">Затем вам нужно убедиться, что Bluetooth включен. Вызовите <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/bluetooth/BluetoothAdapter.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhjbxP-RS9bUKfpGGoofw4-7qiad4g#isEnabled%28%29"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">isEnabled()</span></a> чтобы проверить, включен ли Bluetooth. Если этот метод возвращает false, Bluetooth отключен. Следующий фрагмент проверяет, включен ли Bluetooth. Если это не так, в фрагменте отображается сообщение об ошибке, указывающее пользователю перейти к настройкам, чтобы включить Bluetooth: </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'monospace';">  // Обеспечивает доступность Bluetooth на устройстве, и он включен.  Если не,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'monospace';"> // отображает диалоговое окно с запросом разрешения пользователя на включение Bluetooth.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'monospace';"> if (mBluetoothAdapter == null ||! mBluetoothAdapter.isEnabled ()) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'monospace';">     Intent enableBtIntent = новый Intent (BluetoothAdapter.ACTION_REQUEST_ENABLE);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'monospace';">     startActivityForResult (enableBtIntent, REQUEST_ENABLE_BT);</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'monospace';"> } </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-weight:600;">Примечание:</span> Константа <span style=" font-family:'monospace';">REQUEST_ENABLE_BT</span> передается в <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/app/Activity.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhiJfBCpKQCMUWhpAp8RA32JltHdeA#startActivityForResult%28android.content.Intent,%20int%29"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">startActivityForResult(android.content.Intent, int)</span></a> - это локально определенное целое число (которое должно быть больше 0), которое система возвращает вам в ваш <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/app/Activity.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhiJfBCpKQCMUWhpAp8RA32JltHdeA#onActivityResult%28int,%20int,%20android.content.Intent%29"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">onActivityResult(int, int, android.content.Intent)</span></a> в качестве параметра <span style=" font-family:'monospace';">requestCode</span> . </p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="find"></a><span style=" font-size:x-large; font-weight:600;">Н</span><span style=" font-size:x-large; font-weight:600;">айти устройства BLE </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Чтобы найти устройства BLE, вы используете метод <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/bluetooth/BluetoothAdapter.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhjbxP-RS9bUKfpGGoofw4-7qiad4g#startLeScan%28android.bluetooth.BluetoothAdapter.LeScanCallback%29"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">startLeScan()</span></a> . Этот метод принимает параметр <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/bluetooth/BluetoothAdapter.LeScanCallback.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhhYyYW0RW7HKfwaP0YpYryFz6SzSw"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">BluetoothAdapter.LeScanCallback</span></a> в качестве параметра. Вы должны реализовать этот обратный вызов, потому что так возвращаются результаты сканирования. Поскольку сканирование требует больших затрат энергии, вы должны соблюдать следующие рекомендации: </p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Как только вы найдете нужное устройство, прекратите сканирование. </li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Никогда не просматривайте петлю и не устанавливайте лимит времени на сканирование. Устройство, которое было ранее доступно, возможно, вышло за пределы допустимого диапазона и продолжает сканировать дренирование батареи. </li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Следующий фрагмент показывает, как запустить и остановить сканирование: </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">  / **</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">  * Активность для сканирования и отображения доступных устройств BLE.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">  * /</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> открытый класс DeviceScanActivity расширяет ListActivity {</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     частный Bluetooth-адаптер mBluetoothAdapter;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     private boolean mScanning;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     частный обработчик mHandler;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     // Остановка сканирования через 10 секунд.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     частный статический конечный длинный SCAN_PERIOD = 10000;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     ...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     private void scanLeDevice (конечное булевское разрешение) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         if (enable) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             // Остановка сканирования после заданного периода сканирования.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             mHandler.postDelayed (новый Runnable () {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 @Override</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 public void run () {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                     mScanning = false;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                     mBluetoothAdapter.stopLeScan (mLeScanCallback);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             }, SCAN_PERIOD);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             mScanning = true;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             mBluetoothAdapter.startLeScan (mLeScanCallback);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         } else {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             mScanning = false;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             mBluetoothAdapter.stopLeScan (mLeScanCallback);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         ...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> ...</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> }</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если вы хотите сканировать только определенные типы периферийных устройств, вы можете вместо этого вызвать <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/bluetooth/BluetoothAdapter.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhjbxP-RS9bUKfpGGoofw4-7qiad4g#startLeScan%28android.bluetooth.BluetoothAdapter.LeScanCallback%29"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">startLeScan(UUID[], BluetoothAdapter.LeScanCallback)</span></a> , предоставляя массив объектов <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/java/util/UUID.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhielEE6aEzk-uWOazZ9YINHU_Jr5Q"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">UUID</span></a> которые определяют службы GATT, поддерживаемые вашим приложением. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Ниже приведена реализация <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/bluetooth/BluetoothAdapter.LeScanCallback.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhhYyYW0RW7HKfwaP0YpYryFz6SzSw"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">BluetoothAdapter.LeScanCallback</span></a> , который является интерфейсом, используемым для доставки результатов сканирования BLE: </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> частный LeDeviceListAdapter mLeDeviceListAdapter;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> ...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> // Обратный вызов сканирования устройства.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> частный BluetoothAdapter.LeScanCallback mLeScanCallback =</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         новый BluetoothAdapter.LeScanCallback () {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     @Override</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     public void onLeScan (окончательное устройство BluetoothDevice, int rssi,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             byte [] scanRecord) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         runOnUiThread (новый Runnable () {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">            @Override</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">            public void run () {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                mLeDeviceListAdapter.addDevice (устройство);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                mLeDeviceListAdapter.notifyDataSetChanged ();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">            }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        });</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    }</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> }; </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Примечание.</span> Вы можете сканировать только устройства Bluetooth LE <span style=" font-style:italic;">или</span> сканировать классические устройства Bluetooth, как описано в <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/guide/topics/connectivity/bluetooth.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhiD7RDWDeaaysB08vk43yBGwDEnmQ"><span style=" text-decoration: underline; color:#0000ff;">Bluetooth</span></a> . Вы не можете одновременно сканировать как Bluetooth LE, так и классические устройства. </p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="connect"></a><span style=" font-size:x-large; font-weight:600;">П</span><span style=" font-size:x-large; font-weight:600;">одключение к серверу GATT </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Первый шаг при взаимодействии с устройством BLE - это подключение к нему, в частности, подключение к серверу GATT на устройстве. Чтобы подключиться к серверу GATT на устройстве BLE, вы используете метод <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/bluetooth/BluetoothDevice.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhioX0LBeaMkTuPTaXi7zumHkvviCw#connectGatt%28android.content.Context,%20boolean,%20android.bluetooth.BluetoothGattCallback%29"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">connectGatt()</span></a> . Этот метод принимает три параметра: объект <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/content/Context.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhiA8P-Kk0sfBfFVj2zpVRVBNzky9Q"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">Context</span></a> , <span style=" font-family:'monospace';">autoConnect</span> (логическое значение указывает, следует ли автоматически подключаться к устройству BLE, как только оно станет доступным) и ссылку на <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/bluetooth/BluetoothGattCallback.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhhRL2Ulo5pQEQLVcewkLsrIZdOLIg"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">BluetoothGattCallback</span></a> : </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">  mBluetoothGatt = device.connectGatt (это, false, mGattCallback); </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Это подключается к серверу GATT, размещенному устройством BLE, и возвращает экземпляр <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/bluetooth/BluetoothGatt.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhil1bun8naw9s-njw2nj4RWcFq5lg"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">BluetoothGatt</span></a> , который затем можно использовать для выполнения клиентских операций GATT. Вызывающим (приложение для Android) является клиент GATT. <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/bluetooth/BluetoothGattCallback.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhhRL2Ulo5pQEQLVcewkLsrIZdOLIg"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">BluetoothGattCallback</span></a> используется для доставки результатов клиенту, таких как состояние соединения, а также любые другие действия клиента GATT. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В этом примере приложение BLE обеспечивает активность ( <span style=" font-family:'monospace';">DeviceControlActivity</span> ) для подключения, отображения данных и отображения услуг и характеристик GATT, поддерживаемых устройством. Основываясь на пользовательском вводе, эта активность связывается с <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/app/Service.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhh1zcs4eayQSIUsQzr2T_9TU-B9PQ"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">Service</span></a> <span style=" font-family:'monospace';">BluetoothLeService</span> , который взаимодействует с устройством BLE через Android BLE API: </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> // Служба, которая взаимодействует с устройством BLE через Android BLE API.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> Открытый класс BluetoothLeService расширяет службу {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     private final static String TAG = BluetoothLeService.class.getSimpleName ();</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     частный BluetoothManager mBluetoothManager;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     частный Bluetooth-адаптер mBluetoothAdapter;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     private String mBluetoothDeviceAddress;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     частный BluetoothGatt mBluetoothGatt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     private int mConnectionState = STATE_DISCONNECTED;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     private static final int STATE_DISCONNECTED = 0;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     private static final int STATE_CONNECTING = 1;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     private static final int STATE_CONNECTED = 2;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     public final static String ACTION_GATT_CONNECTED =</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             &quot;Com.example.bluetooth.le.ACTION_GATT_CONNECTED&quot;;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     public final static String ACTION_GATT_DISCONNECTED =</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             &quot;Com.example.bluetooth.le.ACTION_GATT_DISCONNECTED&quot;;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     public final static String ACTION_GATT_SERVICES_DISCOVERED =</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             &quot;Com.example.bluetooth.le.ACTION_GATT_SERVICES_DISCOVERED&quot;;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     public final static String ACTION_DATA_AVAILABLE =</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             &quot;Com.example.bluetooth.le.ACTION_DATA_AVAILABLE&quot;;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     public final static String EXTRA_DATA =</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             &quot;Com.example.bluetooth.le.EXTRA_DATA&quot;;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     public final static UUID UUID_HEART_RATE_MEASUREMENT =</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             UUID.fromString (SampleGattAttributes.HEART_RATE_MEASUREMENT);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     // Различные методы обратного вызова, определенные BLE API.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     закрытый окончательный BluetoothGattCallback mGattCallback =</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             новый BluetoothGattCallback () {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         @Override</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         public void onConnectionStateChange (BluetoothGatt gatt, int status,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 int newState) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             String intentAction;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             if (newState == BluetoothProfile.STATE_CONNECTED) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 intentAction = ACTION_GATT_CONNECTED;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 mConnectionState = STATE_CONNECTED;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 broadcastUpdate (intentAction);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 Log.i (TAG, «Подключено к серверу GATT.»);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 Log.i (TAG, «Попытка начать обнаружение службы:» +</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                         mBluetoothGatt.discoverServices ());</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             } else if (newState == BluetoothProfile.STATE_DISCONNECTED) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 intentAction = ACTION_GATT_DISCONNECTED;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 mConnectionState = STATE_DISCONNECTED;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 Log.i (TAG, «Отключено от сервера GATT.»);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 broadcastUpdate (intentAction);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         @Override</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         // Обнаружены новые службы</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         public void onServicesDiscovered (BluetoothGatt gatt, int status) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             if (status == BluetoothGatt.GATT_SUCCESS) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 broadcastUpdate (ACTION_GATT_SERVICES_DISCOVERED);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             } else {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 Log.w (TAG, &quot;onServicesDiscovered received:&quot; + status);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         @Override</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         // Результат типичной операции чтения</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         public void onCharacteristicRead (BluetoothGatt gatt,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 Характеристики BluetoothGattCharacteristic,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 int status) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             if (status == BluetoothGatt.GATT_SUCCESS) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 broadcastUpdate (ACTION_DATA_AVAILABLE, характеристика);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">      ...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     };</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> ...</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> } </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Когда срабатывает конкретный обратный вызов, он вызывает соответствующий вспомогательный метод <span style=" font-family:'monospace';">broadcastUpdate()</span> и передает ему действие. Обратите внимание, что синтаксический анализ данных в этом разделе выполняется в соответствии с характеристиками <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=http://developer.bluetooth.org/gatt/characteristics/Pages/CharacteristicViewer.aspx%3Fu%3Dorg.bluetooth.characteristic.heart_rate_measurement.xml&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhgZZFu99WH1R052b0xpJ-0EGw8Hvw"><span style=" text-decoration: underline; color:#0000ff;">профиля</span></a> измерения частоты сердечных сокращений Bluetooth: </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">  private void broadcastUpdate (окончательное действие String) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     окончательное намерение намерения = новое намерение (действие);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     sendBroadcast (намерение);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> private void broadcastUpdate (final String action,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                              окончательная характеристика BluetoothGattCharacteristic) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     окончательное намерение намерения = новое намерение (действие);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     // Это специальная обработка для профиля измерения сердечного ритма.  Данные</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     // Разбор выполняется согласно спецификациям профиля.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     if (UUID_HEART_RATE_MEASUREMENT.equals (character.getUuid ())) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         int flag = character.getProperties ();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         int format = -1;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         if ((flag &amp; 0x01)! = 0) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             format = BluetoothGattCharacteristic.FORMAT_UINT16;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             Log.d (TAG, «Формат частоты сердечных сокращений UINT16.»);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         } else {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             format = BluetoothGattCharacteristic.FORMAT_UINT8;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             Log.d (TAG, «Формат частоты сердечных сокращений UINT8.»);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         final int heartRate = character.getIntValue (формат, 1);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         Log.d (TAG, String.format («Полученный сердечный ритм:% d», heartRate));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         intent.putExtra (EXTRA_DATA, String.valueOf (heartRate));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     } else {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         // Для всех других профилей записывает данные, отформатированные в HEX.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         final byte [] data = character.getValue ();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         if (data! = null &amp;&amp; data.length&gt; 0) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             final StringBuilder stringBuilder = новый StringBuilder (data.length);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             for (byte byteChar: data)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 stringBuilder.append (String.format (&quot;% 02X&quot;, byteChar));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             intent.putExtra (EXTRA_DATA, новая строка (данные) + &quot;\ n&quot; +</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                     stringBuilder.toString ());</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     sendBroadcast (намерение);</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> } </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Назад в <span style=" font-family:'monospace';">DeviceControlActivity</span> , эти события обрабатываются <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/content/BroadcastReceiver.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhjexMpfbf8u6zX7dzAOQyigqOFRrA"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">BroadcastReceiver</span></a> : </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">  // Обрабатывает различные события, запущенные службой.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> // ACTION_GATT_CONNECTED: подключен к серверу GATT.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> // ACTION_GATT_DISCONNECTED: отключен от сервера GATT.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> // ACTION_GATT_SERVICES_DISCOVERED: обнаружены службы GATT.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> // ACTION_DATA_AVAILABLE: полученные данные с устройства.  Это может быть</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> // результат операций чтения или уведомления.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> частный окончательный BroadcastReceiver mGattUpdateReceiver = новый BroadcastReceiver () {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     @Override</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     public void onReceive (контекстный контекст, намерение намерения) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         final String action = intent.getAction ();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         if (BluetoothLeService.ACTION_GATT_CONNECTED.equals (действие)) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             mConnected = true;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             updateConnectionState (R.string.connected);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             invalidateOptionsMenu ();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         } else if (BluetoothLeService.ACTION_GATT_DISCONNECTED.equals (действие)) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             mConnected = false;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             updateConnectionState (R.string.disconnected);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             invalidateOptionsMenu ();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             clearUI ();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         } else if (BluetoothLeService.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 ACTION_GATT_SERVICES_DISCOVERED.equals (действие)) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             // Показывать все поддерживаемые службы и характеристики на</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             // пользовательский интерфейс.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             displayGattServices (mBluetoothLeService.getSupportedGattServices ());</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         } else if (BluetoothLeService.ACTION_DATA_AVAILABLE.equals (действие)) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             displayData (intent.getStringExtra (BluetoothLeService.EXTRA_DATA));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     }</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> };</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="read"></a><span style=" font-size:x-large; font-weight:600;">Ч</span><span style=" font-size:x-large; font-weight:600;">тение атрибутов BLE </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Когда ваше приложение Android подключится к серверу GATT и обнаружит службы, он сможет читать и писать атрибуты, если они поддерживаются. Например, этот фрагмент выполняет итерации через службы и характеристики сервера и отображает их в пользовательском интерфейсе: </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> Открытый класс DeviceControlActivity расширяет действие {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     ...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     // Демонстрирует, как итерации через поддерживаемый GATT</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     // Услуги / Характеристики.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     // В этом примере мы заполняем структуру данных, привязанную к</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     // ExpandableListView в пользовательском интерфейсе.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     private void displayGattServices (Список &lt;BluetoothGattService&gt; gattServices) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         if (gattServices == null) return;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         String uuid = null;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         Строка unknownServiceString = getResources ().</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 GetString (R.string.unknown_service);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         Строка unknownCharaString = getResources ().</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 GetString (R.string.unknown_characteristic);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         ArrayList &lt;HashMap &lt;String, String &gt;&gt; gattServiceData =</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 new ArrayList &lt;HashMap &lt;String, String &gt;&gt; ();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         ArrayList &lt;ArrayList &lt;HashMap &lt;String, String &gt;&gt;&gt; gattCharacteristicData</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 = new ArrayList &lt;ArrayList &lt;HashMap &lt;String, String &gt;&gt;&gt; ();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         mGattCharacteristics =</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 новый ArrayList &lt;ArrayList &lt;BluetoothGattCharacteristic &gt;&gt; ();</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         // Петли через доступные службы GATT.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         для (BluetoothGattService gattService: gattServices) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             HashMap &lt;String, String&gt; currentServiceData =</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                     новый HashMap &lt;String, String&gt; ();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             uuid = gattService.getUuid (). toString ();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             currentServiceData.put (</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                     LIST_NAME, SampleGattAttributes.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                             lookup (uuid, unknownServiceString));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             currentServiceData.put (LIST_UUID, uuid);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             gattServiceData.add (currentServiceData);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             ArrayList &lt;HashMap &lt;String, String &gt;&gt; gattCharacteristicGroupData =</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                     new ArrayList &lt;HashMap &lt;String, String &gt;&gt; ();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             Список &lt;BluetoothGattCharacteristic&gt; gattCharacteristics =</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                     gattService.getCharacteristics ();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             ArrayList &lt;BluetoothGattCharacteristic&gt; charas =</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                     новый ArrayList &lt;BluetoothGattCharacteristic&gt; ();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">            // Петли через доступные характеристики.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             для (BluetoothGattCharacteristic gattCharacteristic:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                     gattCharacteristics) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 charas.add (gattCharacteristic);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 HashMap &lt;String, String&gt; currentCharaData =</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                         новый HashMap &lt;String, String&gt; ();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 uuid = gattCharacteristic.getUuid (). toString ();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 currentCharaData.put (</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                         LIST_NAME, SampleGattAttributes.lookup (uuid,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                                 unknownCharaString));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 currentCharaData.put (LIST_UUID, uuid);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                 gattCharacteristicGroupData.add (currentCharaData);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             mGattCharacteristics.add (чарас);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">             gattCharacteristicData.add (gattCharacteristicGroupData);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">          }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     ...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> ...</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> } </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="notification"></a><span style=" font-size:x-large; font-weight:600;">П</span><span style=" font-size:x-large; font-weight:600;">олучать уведомления GATT </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обычно приложения BLE просят уведомить вас, когда на устройстве изменяется конкретный характер. Этот фрагмент показывает, как установить уведомление для характеристики, используя метод <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/bluetooth/BluetoothGatt.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhil1bun8naw9s-njw2nj4RWcFq5lg#setCharacteristicNotification%28android.bluetooth.BluetoothGattCharacteristic,%20boolean%29"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">setCharacteristicNotification()</span></a> : </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> частный BluetoothGatt mBluetoothGatt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> Характеристики BluetoothGattCharacteristic;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> boolean enabled;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> ...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> mBluetoothGatt.setCharacteristicNotification (характеристика, включена);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> ...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> Дескриптор BluetoothGattDescriptor = character.getDescriptor (</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         UUID.fromString (SampleGattAttributes.CLIENT_CHARACTERISTIC_CONFIG));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> descriptor.setValue (BluetoothGattDescriptor.ENABLE_NOTIFICATION_VALUE);</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> mBluetoothGatt.writeDescriptor (дескриптор); </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">После включения уведомлений для характеристики <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/bluetooth/BluetoothGattCallback.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhhRL2Ulo5pQEQLVcewkLsrIZdOLIg#onCharacteristicChanged%28android.bluetooth.BluetoothGatt,%20android.bluetooth.BluetoothGattCharacteristic%29"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">onCharacteristicChanged()</span></a> обратный вызов <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/bluetooth/BluetoothGattCallback.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhhRL2Ulo5pQEQLVcewkLsrIZdOLIg#onCharacteristicChanged%28android.bluetooth.BluetoothGatt,%20android.bluetooth.BluetoothGattCharacteristic%29"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">onCharacteristicChanged()</span></a> , если характерные изменения на удаленном устройстве: </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">  @Override</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> // Уведомление о характеристиках</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> public void onCharacteristicChanged (BluetoothGatt gatt,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         Характеристика BluetoothGattCharacteristic) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     broadcastUpdate (ACTION_DATA_AVAILABLE, характеристика);</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> }</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="close"></a><span style=" font-size:x-large; font-weight:600;">З</span><span style=" font-size:x-large; font-weight:600;">акройте клиентское приложение </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Как только ваше приложение закончит использовать устройство BLE, оно должно вызвать функцию <a href="https://translate.googleusercontent.com/translate_c?act=url&amp;depth=1&amp;hl=ru&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.ru&amp;sl=en&amp;sp=nmt4&amp;tl=ru&amp;u=https://developer.android.com/reference/android/bluetooth/BluetoothGatt.html&amp;xid=17259,15700023,15700124,15700149,15700168,15700173,15700186,15700189,15700191,15700195,15700201,15700205&amp;usg=ALkJrhil1bun8naw9s-njw2nj4RWcFq5lg#close%28%29"><span style=" font-family:'monospace'; text-decoration: underline; color:#0000ff;">close()</span></a> чтобы система могла соответствующим образом выделять ресурсы: </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">  public void close () {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     if (mBluetoothGatt == null) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">         вернуть;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     mBluetoothGatt.close ();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">     mBluetoothGatt = null;</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> } </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace';"><br /></p></body></html>
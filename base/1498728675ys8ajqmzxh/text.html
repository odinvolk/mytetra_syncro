<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'Arial'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В сети есть достаточно много источников на тему сборки приложений под архитектуру ARM, но когда я впервые столкнулся с такой задачей, то набил не одну шишку. Этот топик будет про самые начала кросскомпиляции и различные подходы к этому вопросу. <br /><br />Моё устройство принадлежит к архитектуре ARMv5TE и разработка велась на x86 машине с Ubuntu Linux. <br />Так как это введение, то собирать будем простую <a href="http://pastebin.com/zehNSssR"><span style=" text-decoration: underline; color:#0000ff;">программу</span></a> для высчитывания факториала числа. <br /><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">Подход 1. Коммерческий.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="habracut"></a><br />Компанией CodeSourcery выпускается коммерческая интегрированная среду разработки Sourcery G++, основанная на инструментах GNU (gcc, gdb, binutils) и имеющая интерфейс на базе Eclipse. Пожалуй, это самый простой и быстрый способ создания приложений, так как при установке ставятся и все необходимые библиотеки, и сам кросскомпилятор. На официальном <a href="http://www.codesourcery.com/sgpp"><span style=" text-decoration: underline; color:#0000ff;">сайте</span></a> кроме возможности покупки можно воспользоваться триальной версией на 30 дней. Благодаря близкому «родству» с Eclipse настройки интуитивно понятны и писать подробно нет смысла. <br /><br />Для разовых задач подходит идеально, но есть и абсолютно бесплатные решения. <br /><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">Подход 2. QEMU.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Широко известная программа эмуляции <a href="http://ru.wikipedia.org/wiki/QEMU"><span style=" text-decoration: underline; color:#0000ff;">QEMU</span></a> поддерживает в том числе и ARM платформу, чем грех не воспользоваться. <br /><br />Для начала устанавливаем саму программу:<br /><br /><span style=" font-family:'Courier New,courier';">sudo apt-get install qemu-kvm-extras-static</span><br />Разработчики QEMU сделали отдельную команду для простоты установки окружения (в моём случае это debian lenny):<br /><br /><span style=" font-family:'Courier New,courier';">sudo build-arm-chroot lenny qemu</span><br />В ре­зуль­та­те у нас со­здаст­ся ка­та­лог qemu с об­ра­зом си­сте­мы lenny под нужную нам архитектуру. <br />Не хватает сети и необходимых пакетов для компиляции. Отредактируем sources.list нашей qemu-машины:<br /><span style=" font-family:'Courier New,courier';">sudo nano qemu/etc/apt/sources.list</span><br /><br />И добавим туда <br /><br /><span style=" font-family:'Courier New,courier';">deb ftp.us.debian.org/debian lenny main contrib non-free<br />deb-src ftp.us.debian.org/debian lenny main contrib non-free</span><br /><br />Обновляемся, устанавливаем необходимые пакеты и в самой QEMU собираем наш factorial.<br /><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">Подход 3. Собираем crosstool.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Crosstool — это набор скриптов для сборки и проверки работы gcc и glibc для всех архитектур, поддерживаемых glibc. При сборке различных кросстулов (<a href="http://kegel.com/crosstool/"><span style=" text-decoration: underline; color:#0000ff;">так</span></a> или <a href="http://ymorin.is-a-geek.org/projects/crosstool"><span style=" text-decoration: underline; color:#0000ff;">так</span></a>) у меня возникали проблемы с совместимостью различных компонентов. Так, например, gcc не дружил с binutils из-за разницы в версиях и приходилось чуть ли не методом тыка подбирать работающие связки. К счастью, и этот процесс уже был автоматизирован и сделан предельно простым. За что спасибо пользователю сайта linux.org.ru <a href="http://www.linux.org.ru/people/mskmsk1985/profile"><span style=" text-decoration: underline; color:#0000ff;">mskmsk1985</span></a>:<br />Написанный им <a href="http://www.antario.org.ru/downloads/build-toolchain"><span style=" text-decoration: underline; color:#0000ff;">скрипт</span></a> собирает тулчейн для arm-linux-gnueabi- архитектуры из последних версий GNU инструментов. Собираются С и С++ кросс компиляторы, кросс-отладчик и отладочный сервер для целевой архитектуры. Подробнее можно прочитать <a href="http://www.linux.org.ru/forum/development/5519881"><span style=" text-decoration: underline; color:#0000ff;">тут</span></a>. <br /><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">Подход 4. Gentoo-way.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Как и писал, собиралось это всё на компьютере с Ubuntu, но стоит всё же сказать, что в Gentoo есть отдельная программа <a href="http://en.gentoo-wiki.com/wiki/Crossdev"><span style=" text-decoration: underline; color:#0000ff;">crossdev</span></a>, которая занимается тем же самым и собирает бинарники для нужной архитектуры. <br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-style:italic;">Подход 5. Ubuntu-way.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Мои долгие поиски наиболее простого способа кросскомпиляции шли весьма запутанно и, конечно же, я пропустил решение, которое было слишком очевидным и простым чтобы даже об этом думать. Но оказалось что да, кросскомпилятор можно поставить из репозиториев и одной командой:<br /><br /><span style=" font-family:'Courier New,courier';">sudo apt-get install libc6-dev-armel-cross gcc-arm-linux-gnueabi </span><br /><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">Вместо заключения.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Способы кросскомпиляции не ограничиваются приведенными выше примерами. Существуют многостраничные описания, варианты создания необходимых инструментов 'from scratch', но если нужно быстро написать и запустить простенькое приложение на другой архитектуре, часто не хватает времени для полного изучения, да и количество нюансов и программных несовместимостей могут отбить любое желание заниматься этим. <br /><br />Надеюсь, мой небольшой обзор поможет вам избежать моих ошибок и быстро получить работающий инструмент для создания приложение на ARM-архитектуре. Удачи!</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>
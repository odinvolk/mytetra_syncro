<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:10pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:xx-large; font-weight:600;">Миф №4: </span><span style=" font-family:'Courier New,courier'; font-size:xx-large; font-weight:600;">32</span><span style=" font-size:xx-large; font-weight:600;">-х разрядное приложение не может использовать более </span><span style=" font-family:'Courier New,courier'; font-size:xx-large; font-weight:600;">2</span><span style=" font-size:xx-large; font-weight:600;"> Гб памяти</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Постойте-ка, разве мы только что не подтвердили эту легенду? Не совсем. Ведь есть разница: &quot;выделить за раз&quot; и &quot;использовать&quot;. Да, вы не можете выделить <span style=" font-family:'Courier New,courier';">2</span> Гб памяти (или более) - что за раз, что за несколько вызовов: ведь обычно размер пользовательской части виртуального адресного пространства равен <span style=" font-family:'Courier New,courier';">2</span> Гб, но это не ограничивает вас <span style=" font-family:'Courier New,courier';">2</span> Гб виртуальной памяти. Вы можете выделять память, без проецирования её в ваше виртуальное адресное пространство. Как мы увидели в мифах 1 и 2: виртуальное адресное пространство программы не равно виртуальной памяти в системе. Второе - больше, чем первое.<br /><br />Обычно размер пользовательской части виртуального адресного пространства равен <span style=" font-family:'Courier New,courier';">2</span> Гб, но это не ограничивает вас <span style=" font-family:'Courier New,courier';">2</span> Гб виртуальной памяти. Вы можете выделять память, без проецирования её в ваше виртуальное адресное пространство: <br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="0" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a1009;">1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a1009;">2</span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a1009;">h := CreateFileMapping(INVALID_HANDLE_VALUE, 0,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a1009;">                       PAGE_READWRITE, 1, 0, nil);</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">При условии, что у вас достаточно физической памяти и/или файла подкачки, этот запрос на выделение <span style=" font-family:'Courier New,courier';">4</span> Гб памяти будет успешен.<br /><br />Конечно же, вы не сможете спроецировать всю эту память <span style=" font-weight:600;">сразу</span>, но вы можете делать это по частям.<br /><br />Другим вариантом использования большего объёма памяти является <a href="http://msdn.microsoft.com/en-us/library/aa366527(VS.85).aspx"><span style=" text-decoration: underline; color:#0000ff;">AWE</span></a>.<br /><br />В общем, мораль в том, что виртуальное адресное пространство - это не то же самое, что виртуальная память. <a href="http://www.transl-gunsmoker.ru/2008/11/blog-post_4926.html"><span style=" text-decoration: underline; color:#0000ff;">Как мы видели ранее</span></a>, вы можете проецировать одну и ту же память по нескольким адресам, так что соответствие один-к-одному для виртуальной памяти и виртуального адресного пространства никогда и не выполнялось. Здесь мы продемонстрировали, что выделение памяти вовсе не означает, что она вообще занимает какое-то место в виртуальном адресном пространстве.<br /><br />Более того: если вы укажете при загрузке системы <a href="http://msdn.microsoft.com/en-us/library/ff556232(VS.85).aspx"><span style=" text-decoration: underline; color:#0000ff;">ключ </span></a><a href="http://msdn.microsoft.com/en-us/library/ff556232(VS.85).aspx"><span style=" font-family:'Courier New,courier'; text-decoration: underline; color:#0000ff;">/3GB</span></a>, то вы сможете использовать более <span style=" font-family:'Courier New,courier';">2</span> Гб виртуального <span style=" font-style:italic;">адресного пространства</span> (и снова: и ещё больше - виртуальной <span style=" font-style:italic;">памяти</span>). Ключ <span style=" font-family:'Courier New,courier';">/3GB</span> изменяет способ разбиения полных <span style=" font-family:'Courier New,courier';">4</span> Гб виртуального адресного пространства. Вместо разбиения на <span style=" font-family:'Courier New,courier';">2</span> Гб пользовательского виртуального адресного пространства и <span style=" font-family:'Courier New,courier';">2</span> Гб режима ядра, разделение будет сделано на <span style=" font-family:'Courier New,courier';">3</span> Гб пользовательского и <span style=" font-family:'Courier New,courier';">1</span> Гб адресного пространства режима ядра (это граница по умолчанию, а вообще она варьируется).<br /><br />Так что это неверно даже если вы говорили про адресное пространство, а не про память вообще. В этом мифе есть лишь часть правды про адресное пространство.<br /><br />Статус мифа: <span style=" font-weight:600;">(totally) </span><span style=" font-weight:600; color:#ff0000;">busted</span>.<br /></p></body></html>
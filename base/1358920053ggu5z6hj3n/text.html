<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:10pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:xx-large; font-weight:600;">Как установить 1С Предприятие 8.2 (релиз 8.2.16.368 от 05.10.12) на линукс CentOS 6.3 (статья, HowTo)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:xx-large; font-weight:600;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://habrahabr.ru/hub/s_admin/"><span style=" text-decoration: underline; color:#0000ff;">Серверное администрирование</span></a>, <a href="http://habrahabr.ru/hub/linux/"><span style=" text-decoration: underline; color:#0000ff;">Linux</span></a>, <a href="http://habrahabr.ru/hub/erp/"><span style=" text-decoration: underline; color:#0000ff;">ERP-системы</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">Предупреждение: Никаких подробных инструкций не будет! Только последовательность действий, необходимые шаги и наводки. Это руководство только для опытных администраторов Линукс!</span><br /><br />Примеры некоторых моих конфигов <a href="https://rapidshare.com/files/3845142900/Celeron_-_kak_ustanovit_1C8.2.16.368_na_linux_CentOS6.3_-_config_samples.rar"><span style=" text-decoration: underline; color:#0000ff;">прилагаются...</span></a><br /><br />Замечание: эта статья написана на основе экспериментов с 32-битным CentOS 6.3 <span style=" font-style:italic;">(Для сервера необходимо использовать 64-битную ОС. Но так получилось, что на доступном мне для экспериментов железе 64-битный CentOS не установился.)</span> Однако разницы для методики установки нет (32 vs 64bit) — она только в суффиксах дистрибутивных файлов: либо i686 (или i386), либо x86_64…<br /><br /><span style=" font-weight:600;">Содержание:</span><br /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="#chapter0"><span style=" text-decoration: underline; color:#0000ff;">0) Подготавливаем серверное железо</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="#chapter1"><span style=" text-decoration: underline; color:#0000ff;">1) Устанавливаем Операционную Систему (ОС)</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="#chapter2"><span style=" text-decoration: underline; color:#0000ff;">2) Настраиваем Сеть</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="#chapter3"><span style=" text-decoration: underline; color:#0000ff;">3) Настраиваем менеджер пакетов (yum)</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="#chapter4"><span style=" text-decoration: underline; color:#0000ff;">4) Устанавливаем дополнительный софт, не относящийся к системе 1С</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="#chapter5"><span style=" text-decoration: underline; color:#0000ff;">5) Настраиваем Samba-сервер</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="#chapter6"><span style=" text-decoration: underline; color:#0000ff;">6) Достаём и готовим дистрибутивы 1С: Предприятие… Откуда всё взять?</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="#chapter7"><span style=" text-decoration: underline; color:#0000ff;">7) Сборка и Установка «СУБД PostgreSQL от 1С (релиз 9.0.3-3.1C от 17.01.12)» на Линукс CentOS (6.3) </span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="#chapter8"><span style=" text-decoration: underline; color:#0000ff;">8) Установка «Сервера 1С: Предприятие 32bit для RPM-based Linux-систем (8.2.16.368)» на Линукс CentOS (6.3)</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="#chapter9"><span style=" text-decoration: underline; color:#0000ff;">9) Установка защитных ключей (лицензирование 1С)</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="#chapter10"><span style=" text-decoration: underline; color:#0000ff;">10) Далее, устанавливаем клиентскую часть — на другой машине под управлением Windows</span></a></li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="#chapterL"><span style=" text-decoration: underline; color:#0000ff;">Литература (использованная и дополнительно рекомендуемая)</span></a></li></ul>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p>
<hr />
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">0) Подготавливаем серверное железо</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Конкретных рекомендаций по выбору серверного железа (какой мощности железо требуется) давать не буду — нет личного опыта. Смотрите официальные <a href="http://www.v8.1c.ru/predpriyatie/recomendations.htm"><span style=" text-decoration: underline; color:#0000ff;">«Рекомендации по выбору оборудования для работы с 1С: Предприятием 8»</span></a> от v8.1c.ru и неофициальные <a href="http://1c.xxi.kiev.ua/predprijatie80/requirements/"><span style=" text-decoration: underline; color:#0000ff;">«Требования к компьютеру для работы с программой 1С: Предприятие 8»</span></a> от 1c.xxi.kiev.ua…<br />И рекомендую брать железо с запасом мощности, чем рекомендуемое (потому что «на вырост» потребностей предприятия; и потому что Платформа 1С тоже постоянно «растёт и оптимизируется» — значит потребляет от релиза к релизу всё больше ресурсов).<br /><br />Вдобавок, в двух словах, наиболее выгодна следующая стратегия:<br /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> Разнести два сервера (сервер 1С и сервер СУБД Postgres) по двум разным машинам — мощность наращивается в два раза, а лишних лицензий покупать не надо. Это и дешёвое решение: Линукс бесплатен, а стоимость железа не в счёт (железо всегда дешевле лицензий). </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> Примечание: учтите, что «кластер серверов 1С» ещё очень глючный. Причём, каждая дополнительная отдельная машина под «Сервер 1С в составе кластера» — требует покупки отдельной «Лицензии на Сервер»! Поэтому, со всех сторон, под «Сервер 1С» выгоднее всего использоватьТОЛЬКО ОДНУ МАШИНУ — купите под сервер только одну машину, с достаточно мощным железом, которое способно тянуть всю нагрузку...</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> В сервер СУБД установить аппаратный RAID10 (файлы БД резервированы, а объём дискового пространства наращивать по необходимости). <br />Причём: В бюджетных рещениях, вполне <a href="http://people.overclockers.ru/Dentarg/12812/Igry_s_RAID"><span style=" text-decoration: underline; color:#0000ff;">достаточно использовать Чипсетный RAID-контроллер, встроенный во многие современные материнские платы</span></a>, чем покупать отдельный и дорогой Аппаратный RAID-контроллер (цена которых от $250). Встроенные чипсетные RAID-контроллеры уже имеют <a href="http://www.triatis.md/reviews_in.php?id=66"><span style=" text-decoration: underline; color:#0000ff;">широкий функционал</span></a>; поддерживают <a href="http://www.thg.ru/storage/raid_migration_level/onepage.html"><span style=" text-decoration: underline; color:#0000ff;">необходимые режимы RAID (0, 1, 5, 10) и автоматизированную миграцию </span></a> между ними, с сохранением данных. <br />Есть только одна но существенная ложка дёгтя: <a href="http://www.linuxcenter.ru/lib/articles/hardware/DPT_Hardware_RAID_minihowto.phtml"><span style=" text-decoration: underline; color:#0000ff;">плохая поддержка аппаратных RAID-контроллеров в ОС Linux</span></a>. И к тому же, встроенный в материнскую плату <a href="http://asplinux.net/node/3511"><span style=" text-decoration: underline; color:#0000ff;">чипсетный SATA-RAID не является полностью аппаратным</span></a>: управление данными происходит не на уровне самого «железа», а на уровне микрокода BIOS через драйвер ОС — отсюда и такие понятия как «драйвера на SATA-RAID» (Intel Matrix Storage Driver), без которых RAID видится как отдельные диски — отсюда и проблемы поддержки… <a href="http://citkit.ru/articles/524/"><span style=" text-decoration: underline; color:#0000ff;">Под Linux — традиционно используются программные RAID-массивы</span></a>, поддержка которых уже давно реализована и отлажена!</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> Оба сервера конечно поднимать на ОС windows/linux 64bit (т.к. поддерживают много ОЗУ и большую мощность). А «сервер 1С» купить и установить 32bit (потому что «Сервер 1С 64bit» стоит в 2 раза больше, а прирост производительности при прочих равных условиях даёт лишь +5%!!! неофициально <span style=" text-decoration: underline;">умельцы тестировали</span>...)</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br /></p>
<hr />
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><a name="chapter1"></a><br /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">1) Устанавливаем Операционную Систему (ОС)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Установить линукс CentOS 6.x (последний релиз), лучше 64bit. <br /><span style=" font-style:italic;">Причины выбора дистрибутива CentOS: Это серверный дистрибутив линукс. Это свободный (бесплатный, «Community Edition») дистрибутив. Это дистрибутив основанный на ядре RedHat, который 1С декларирует как «поддерживаемый».</span><br /><br />Образы дистрибутива CentOS качаются <a href="http://www.centos.org/modules/tinycontent/index.php?id=30"><span style=" text-decoration: underline; color:#0000ff;">отсюда (с любого из зеркал)</span></a>.<br /><span style=" font-style:italic;">Удобнее выкачать iso, прожечь на болвань (DVDRW) и с неё ставить.<br />Для установки, как правило, достаточно только первого диска из двух компонуемых (на втором диске — всякий второстепенный софт).<br />А потом установочные дистки уже не нужны — всё равно весь софт нужно обновлять и доставлять через Интернет...</span><br /><br />Замечание: <span style=" font-weight:600;">Пользователь root в системе CentOS нелогинный</span> (должен быть)!<br />Вся работа в системе CentOS ВСЕГДА осуществляется из сеанса обычного пользователя, в т.ч. и установка/настройка системы. И только для некоторых действий каждый раз запрашиваются привилегии «суперпользователя» (нечто подобное появилось и в Windows7).<br />Поэтому для выполнения правки конфигов, установки пакетов и прочих «админских» действий — открыв консоль в сеансе обычного пользователя, сразу выполняем команду «su», которая переключит текущую консоль в режим «суперпользователя» (фича CentOS):<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	bash# su	Пароль: &lt;вводим пароль root&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Далее эта консоль bash# используется для разных привилигированных действий. Например, можно запустить «mc» и править конфиги в /etc/…<br /><br /></p>
<hr />
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><a name="chapter2"></a><br /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">2) Настраиваем Сеть</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Настроить сетевые адаптеры, имя хоста, gateway и DNS…<br />Подключиться к Интернет и обновить все базовые пакеты до последних версий…<br />Все дальнейшие действия будем делать только при наличии подключения к Интернет, считаем что оно постоянно!<br /><br />Настройка сети осуществляется стандартно… Но есть <a href="http://www.alsigned.ru/?p=1756"><span style=" text-decoration: underline; color:#0000ff;">распространённые Грабли, которые надо обойти</span></a>: <br /><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">2a)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Первое – имя нашего сервера должно без проблем разрешаться в IP-адрес. <br /><br />В файле /etc/sysconfig/network проверяем значение параметра hostname («имя компьютера» севера), при необходимости меняем, что бы новые параметры вступили в силу нужно перезапустить систему.<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	bash# cat /etc/sysconfig/network	NETWORKING=yes	NETWORKING_IPV6=no	HOSTNAME=delldev	GATEWAY=192.168.10.2    </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-style:italic;">(Последняя строчка — шлюз по-умолчанию, указывать необязательно. Если не указан — он будет браться из конфигов ifcfg или по DHCP...)</span><br /><br />В файле /etc/hosts не должно быть записей формата localhost.localdomian или относящихся к IPv6, в случае отсутствия DNS-сервера в нем должно быть прописано четкое соответствие IP-адрес сервера – FQDN имя – короткое имя. Пример правильного файла hosts:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	bash# cat /etc/hosts	127.0.0.1 localhost delldev</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Проверка: пингует ли сервер сам себя? Введите в консоли:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	bash# ping delldev</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">2b)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Второе – на файрволе не должно быть правил запрещающих взаимодействие между собой компонентов 1с предприятия. <br />В большинстве случаев сервер 1с предприятия находится в пределах локальной сети, поэтому мы вполне может отключить файрвол (хотя бы на время пуско-наладки):<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	bash# chkconfig iptables off	bash# service iptables stop</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">2c)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Третье – необходимо также отключить SELinux policy!<br /><br />Причины:<br />1) Ранее SELinux был причиной ошибки Segmentation Fault. <br />2) Со включенным SELinux не работают шары Samba (удалённые пользователи в шары заходят, но файлы не видят… или файлы видятся, но не читаются… и т.п. глюки)<br />3) Кроме того, плюсы от использования SELinux на высоко-нагруженном сервере, находящемся в пределах локальной сети, — выглядят крайне туманно.<br /><br />Как отключить: <br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	Редактируем конфиг /etc/selinux/config	строку SELINUX=enforcing	меняем на SELINUX=disabled	перегружаем машину...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">2d)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />У интернет провайдера «Укртелеком/Украина» есть ещё такие грабли: глючные DNS сервера — поэтому нужно использовать вспомогательные (лучше от Google)… А ещё возможно мой DSL-роутер оказался плохо совместим с ОС Линукс… <br /><br /><span style=" font-weight:600;">Симптом:</span> при работе с Интернет, резолвинг каждого DNS-имени происходит очень долго (несколько [десятков] секунд таймаута), работать очень плохо…<br /><span style=" font-weight:600;">Решение:</span> Поэтому я сервера DNS не получал автоматически через DHCP, а статически прописал в настройках адаптера (в конфиге /etc/sysconfig/network-scripts/ifcfg-eth0) следующие адреса: 213.179.249.151, 213.179.249.152, 8.8.8.8, 8.8.4.4 <span style=" font-style:italic;">(первые два — новые Укртелекомовские, следущие два — от Google)</span>.<br /><br /></p>
<hr />
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><a name="chapter3"></a><br /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">3) Настраиваем менеджер пакетов (yum)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Примечание: подробный мануал по использованию yum — смотри в статье <a href="http://hrafn.me/articles/package-management-in-rhel6-yum/"><span style=" text-decoration: underline; color:#0000ff;">«Управление пакетами в RHEL6. Yum»...</span></a><br /><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">3a) </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-weight:600;">Настраиваем источники софта (репозитории):</span><br /><br />включаем стандартные репозитории (в конфиге репозитария пропишем enabled=1, или установим галочки через графический интерфейс...):<br />   CentOS-6 — Base<br />   CentOS-6 — Contrib<br />   CentOS-6 — Extras<br />   CentOS-6 — Plus<br />   CentOS-6 — Updates<br /><br />И <a href="http://wiki.centos.org/AdditionalResources/Repositories"><span style=" text-decoration: underline; color:#0000ff;">добавляем/подключаем дополнительные репозитории</span></a> (без них очень грустно, т.к. стандартные репозитории содержат преимущественно серверный софт, причём устаревшие хотя и сверхотлаженные версии). <br /><br />Примечание: В большинстве случаев, для облегчения подключения новых репозиториев, владельцы репозиториев подготовили RPM-пакеты для автоматической конфигурации — эти пакеты нужно только скачать и установить. Причём, выбирайте пакеты правильной версии: для соответствующей версии репозитария и предназначенные для соответствующего вашему релиза Линукс. При установке этого псевдопакета автоматически сгенерируются необходимые конфиги, сконфигурируется yum и т.п.<br /><br />Рекомендации:<br />   Use «cat /etc/redhat-release» to find which release of EL you are using <span style=" font-style:italic;">(у меня говорит: «CentOS release 6.3» — т.е. «el6»)</span><br />   Use «uname -a» to find your processor architecture <span style=" font-style:italic;">(у меня говорит: «i686 i386»)</span><br />   Use «rpm -ivh package-filename» to install the rpmforge-release package <span style=" font-style:italic;">(also works with URLs)</span><br /><br /><span style=" font-weight:600;">RPMforge</span><br />   инструкции по установке: <a href="http://repoforge.org/use/"><span style=" text-decoration: underline; color:#0000ff;">repoforge.org</span></a> и <a href="http://wiki.centos.org/AdditionalResources/Repositories/RPMForge#head-54c2bfab2ebfdb90aa800698abb69102098d04a8"><span style=" text-decoration: underline; color:#0000ff;">wiki.centos.org</span></a><br />   рабочий пример установки: su -c 'rpm -Uvh <a href="http://packages.sw.be/rpmforge-release/rpmforge-release-0.5.2-2.el6.rf.i686.rpm"><span style=" text-decoration: underline; color:#0000ff;">packages.sw.be/rpmforge-release/rpmforge-release-0.5.2-2.el6.rf.i686.rpm</span></a>'<br /><br /><span style=" font-weight:600;">EPEL</span><br />   инструкции по установке: <a href="http://fedoraproject.org/wiki/EPEL/FAQ#How_can_I_install_the_packages_from_the_EPEL_software_repository.3F"><span style=" text-decoration: underline; color:#0000ff;">fedoraproject.org</span></a><br />   рабочий пример установки: su -c 'rpm -Uvh <a href="http://download.fedoraproject.org/pub/epel/6/i386/epel-release-6-7.noarch.rpm"><span style=" text-decoration: underline; color:#0000ff;">download.fedoraproject.org/pub/epel/6/i386/epel-release-6-7.noarch.rpm</span></a>'<br /><br /><span style=" font-weight:600;">ATrpms</span><br />   инструкции по установке: <a href="http://atrpms.net/documentation/install/"><span style=" text-decoration: underline; color:#0000ff;">atrpms.net</span></a><br />   рабочий пример установки: su -c 'rpm -Uvh <a href="http://dl.atrpms.net/all/atrpms-repo-6-5.el6.i686.rpm"><span style=" text-decoration: underline; color:#0000ff;">dl.atrpms.net/all/atrpms-repo-6-5.el6.i686.rpm</span></a>'<br /><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">3b) </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Концепция: <span style=" font-weight:600;">главное — не нарушить функциональность базового ядра системы</span>. <br />Стандартные репозитарии CentOS (особенно «CentOS-6 — Base») составляют специально обученные люди, которые обеспечивают наличие в каждый момент времени в репозитарии среза совместимых друг с другом пакетов и библиотек. <span style=" font-style:italic;">(CentOS — система серверная, которая установлена на самых дорогих Продакшн серверах, которые работают в режиме автоапдейта. Глюк в репозитарии сломает много серверов, ну то есть у админов будет много гемора и кредит доверия к CentOS подорвётся… Этого не допускают.) </span><br />Но если играться с третьими левыми дистрибутивами, то в них всегда новые (и нестабильные) версии библиотек появляются ранее — они могут быть автоматически установлены в систему при автоапдейте, породив несовместимость для сервисов ядра. Плохо!<br /><br />Для того чтобы на сервер устанавливался именно самый отлаженный софт, а из дополнительных репозитариев устанавливался только софт отсутствующий в базовых (пакеты развязываются по «зависимостям») — нужно настроить/использовать систему приоритетов:<br /><br />Для управления приоритетами — нужно <span style=" text-decoration: underline;">установить дополнительные плагины для yum</span> (полезно установить все три):<br /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> yum-protect-packages (позволяет защитить указанные пакеты от удаления; по умолчанию защищён сам yum и его цепочка зависимости)</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> <a href="http://wiki.centos.org/PackageManagement/Yum/ProtectBase"><span style=" text-decoration: underline; color:#0000ff;">yum-plugin-protectbase</span></a> (позволяет защитить пакеты из указанного репозитария от обновления из незащищённых репозитариев) — ЕГО ПРОЩЕ НАСТРАИВАТЬ.</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> <a href="http://wiki.centos.org/PackageManagement/Yum/Priorities"><span style=" text-decoration: underline; color:#0000ff;">yum-plugin-priorities</span></a> (позволяет назначить приоритеты различным репозиториям; пакеты из репозитория с более низким значением приоритета не могут быть обновлены из репозитория с высоким значением приоритета — это другой вид защиты, более продвинутый и гибкий) — ОН ЛУЧШЕ!</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-style:italic;">(Примечание: для yum есть ещё много интересных плагинов, но эти самые необходимые...)</span><br /><br /><span style=" text-decoration: underline;">Настройки репозитариев yum</span> хранит в: /etc/yum.repos.d/<br />конфиги, которые можно редактировать, называются: *.repo <br />остальные файлы служебные — их не трогаем.<br /><br />Нужно дописать в текстовые конфиги (как минимум для всех репозитариев с enabled=1): строки с параметрами protect=… и priority=… <span style=" font-style:italic;">(примечание: чем меньше значение priority — тем репозиторий главнее)</span><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Рекомендую прописать следующие установки приоритетов...</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">#== CentOS-Base.repo[base]enabled=1protect=1priority=1[updates]enabled=1protect=1priority=1[extras]enabled=1protect=1priority=1[centosplus]enabled=1protect=0priority=2[contrib]enabled=1protect=0priority=2#== CentOS-Media.repo[c6-media]enabled=0 # На самом деле это локальный репозитарий на установочных дисках. В реальной работе он не нужен, т.к. используется Интернет - Отключим этот репозитарий.protect=0priority=2#== rpmforge.repo[rpmforge]enabled=1protect=0priority=9[rpmforge-extras]enabled=0protect=0priority=9[rpmforge-testing]enabled=0protect=0priority=99#== epel.repo[epel]enabled=1protect=0priority=10[epel-debuginfo]enabled=0protect=0priority=10[epel-source]enabled=0protect=0priority=10#== epel-testing.repoenabled=0#== atrpms.repo[atrpms]enabled=1protect=0priority=11[atrpms-debuginfo]enabled=0protect=0priority=11[atrpms-source]enabled=0protect=0priority=11#== atrpms-bleeding.repoenabled=0#== atrpms-testing.repoenabled=0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">3c)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Ещё рекомендую установить использовать графическую оболочку к менеджеру пакетов: Yum Extender (бинарь называется yumex) — он гораздо продвинутей стандартного GUI!<br /><br /></p>
<hr />
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><a name="chapter4"></a><br /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">4) Устанавливаем дополнительный софт, не относящийся к системе 1С</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Теперь можно проинсталировать (через консоль управления менеджером пакетов yum, конечно):<br />   поддержку ntfs<br />   wine (эмулятор для запуска простых приложений windows)<br />и другие полезные локальные приложения…<br /><br /></p>
<hr />
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><a name="chapter5"></a><br /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">5) Настраиваем Samba-сервер</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Нужно установить (через yum) и настроить сервер Samba (службы «smb» и «nmb») — это поддержка протокола Microsoft NetBIOS под Линукс, т.н. «Сетевое окружение»…<br /><br />Причём Samba рекомендую поднять, даже если вы не будете предоставлять файловые шары на этом сервере для других клиентов локальной сети, чтобы этот сервер появился в «сетевом окружении» у всех Windows клиентов и других серверов сети, сканировался стандартным API, резолвил своё «сетевое имя машины» — чтобы на него можно было ссылаться как-то типа ¨\\MyLinuxServer¨. Для удобства, настройте Samba так, чтобы Сервер 1С был виден в вашей WORKGROUP…<br /><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Примечание по поводу: Нужен ли Samba-сервер для работы 1С:Предприятия или нет?</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1) Раньше, для работы 1С: Предприятие версии 8.1, Samba-сервер был строго необходим: например, MMC-оснастке «Администрирование серверов», если сервер 1С под Линукс, требовался аналог «Cлужбы доступа к файлам и принтерам Windows» – Samba… Но сейчас <a href="http://habrahabr.ru/post/155735/#comment_5317635"><span style=" text-decoration: underline; color:#0000ff;">админы отмечают, что поздние версии 1С: Предприятие 8.2 нормально работают и без поднятия Samba на сервере</span></a>. <span style=" font-style:italic;">(Хотя замечу, что тогда клиентским приложениям 1С, в т.ч. оснастке «Администрирования серверов», приходится обращаться к серверу 1С только через IP. Либо требуется поднимать и настраивать соответствующим образом локальный DNS-сервер, для трансляции IP сервера в символическое имя компьютера.)</span><br /><br />2) В отличие от «файловой Информационной Базы», для размещения которой требовалась «общая сетевая папка», — в клиент-серверном варианте samba-шара уже не требуется… Однако Samba-сервер остаётся полезным! <span style=" font-style:italic;">Основное назначение Samba в клиент-серверной конфигурации — легко и просто резолвить в локальной сети символическое «имя сервера» в его IPшник</span>, для всех клиентских приложений 1С, без необходимости применения локального DNS-сервера — что <span style=" text-decoration: underline;">значительно упрощает настройку и администрирование сетей</span>, для небольших 1С-решений.<br /><br />3) Кроме того, нужно понимать, что платформа 1С: Предприятие была всегда заточена под Windows (COM, RPC, NetBIOS) и её миграция под Линукс, в кросплатформенное решение (TCP/IP, HTTP и на собственные переносимые протоколы), началась недавно. Пока кросплатформенные решения обладают гораздо меньшим доступным функционалом, чем при развёртывании системы на платформе Windows. И разработчики 1С ещё работают над переделкой сервисов платформы 1С на «кросплатформенные протоколы» (а сервисов в пакете много)… И «1С: Предприятие 8.х» во многом ориентировано на работу «в локальной сети» (например, вся их лицензионная политика на этом построена)… Поэтому есть ещё масса явных и неявных использований протокола NetBIOS сервисами 1С (что может быть и недокументировано, но это обычные накладки при «итеративной разработке») — и мне профессиональная интуиция подсказывает, что <span style=" font-weight:600;">Samba очень желательно поднять</span>!<br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Для настройки Samba советую:<br />создать и настроить шаровые папки так:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	mkdir /home/samba	mkdir /home/samba/вседругие	...	chown -R samba /home/samba	chgrp -R samba /home/samba	chmod -R a+rw  /home/samba</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />создать нелогинного пользователя/группу: samba/samba<br />назначить этому пользователю домашнюю папку: /home/samba<br /><br />Настройка службы Samba:<br />   Конфиги лежат в /etc/samba/<br />   см. man smb.conf<br />   см. <a href="http://smb-conf.ru/"><span style=" text-decoration: underline; color:#0000ff;">smb-conf.ru/</span></a><br />   Для простой настройки — см. статью <a href="http://centos.moy.su/news/prostaja_ustanovka_i_konfiguracija_servera_samba_v_centos/2010-05-19-27"><span style=" text-decoration: underline; color:#0000ff;">«Простая установка и конфигурация сервера SAMBA в CentOS»...</span></a><br /><br /><span style=" font-weight:600;">Важно:</span> Кроме службы «smb» (основной), также следует «включить» и «запустить» службу «nmb» (которая отвечает за публикацию NetBIOS имени компьютера в локальной сети — Сервер станет виден в «Сетевом окружении»):<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	chkconfig --level 2345 smb on	chkconfig --level 2345 nmb on	service smb start	service nmb start</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-weight:600;">Совет:</span> Режим работы Служб лучше всего настраивать через графическую оснастку «GNOME / Система / Администрирование / Службы»…<br /><br /></p>
<hr />
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><a name="chapter6"></a><br /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">6) Достаём и готовим дистрибутивы 1С: Предприятие… Откуда всё взять?</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Пиратские дистрибутивы 1С (и кряки) можно скачать с обменников (ссылки не привожу, найдёте на <a href="http://forum.ru-board.com"><span style=" text-decoration: underline; color:#0000ff;">forum.ru-board.com</span></a> в разделе «Варезник»)…<br /><br />Итак, добыли/скачали дистрибутив <span style=" font-weight:600;">«1С: Платформа 8.2 релиз 8.2.16.368 от 05.10.12»</span> -&gt; из него берём «Cервер 1С: Предприятия (32bit) для RPM-based Linux-систем», файл <span style=" font-weight:600;">«8_2_16_368_rpm.tar.gz»</span> (169.07 MB) -&gt; после распаковки архива получим 8 RPM-файлов дистрибутива…<br /><br />Готовые сборки «PostgreSQL от 1С релиз 9.0.3-3.1C от 17.01.12» нам не подойдут, не установятся по зависимостям (там пакеты собраны для CentOS 5.x, а не для 6.x.). <br />Нам <span style=" text-decoration: underline;">нужны исходные коды PostgreSQL, патченные 1С, для самостоятельной сборки!</span> Из дистрибутива <span style=" font-weight:600;">«PostgreSQL от 1С релиз 9.0.3-3.1C от 17.01.12»</span> -&gt; берём только файл «PG90331_Patch903.rar» -&gt; из архива берём только файл <span style=" font-weight:600;">«postgresql-9.0.3-3.1C.src.rpm»</span> <span style=" font-style:italic;">(это RPM-пакет c исходными кодами PostgreSQL версии 9.0.3, УЖЕ ВКЛЮЧАЮЩИЙ ВСЕ НЕОБХОДИМЫЕ ПАТЧИ для обеспечения совместимости с сервером 1С: Предприятия 8.1 и 1С: Предприятия 8.2)</span><br />Примечание: Кроме того, исходные коды для самостоятельной сборки СУБД PostgreSQL, поддерживаемой 1С: Предприятием 8, проще всего <a href="http://v8.1c.ru/overview/postgresql_patches/9-0-3/postgresql-9.0.3-3.1C.src.rpm"><span style=" text-decoration: underline; color:#0000ff;">скачать с оф.сайта напрямую...</span></a><br /><br />Замечания: Какую платформу выбрать?<br /></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> сервер 1С бывает: и х64, и х86</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> клиентские программы 1С бывают: только х86, на сегодняшний момент (повторюсь: х64 бывает только сервер 1C)</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> известно что на ОС х64 можно ставить программы х86 (это касается не только 1С)</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> клиентские программы 1С (толстый и тонкий клиенты) работают только под Windows!<br /></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-weight:600;">Дополнительная информация...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a href="http://v8.1c.ru/requirements/"><span style=" text-decoration: underline; color:#0000ff;">На оф.сайте v8.1c.ru</span></a> для «Технологической платформы 1С: Предприятия» / «Тонкий клиент» и «толстый клиент» — возможность работы под Linux не упомянута! Хотя таковая упомянута для web-клиента и для Сервера 1С…<br /><br />В дистрибутивах платформы 1С: Предприятие 8.2 клиентских приложений под Линукс — НЕ ОБНАРУЖИЛ (т.о. из под Линукс доступны только Web-клиенты, которые работают в окружении Браузера).<br /><br />В дистрибутивах платформы 1С: Предприятие 8.3 (пока тестовая версия) клиентские приложения под Линукс (и 32bit и 64bit) — УЖЕ ПРИСУТСТВУЮТ!<br /><br /><span style=" font-style:italic;">Кстати, поэтому для локальной установки 1С (один пользователь/один компьютер) — пока доступен только вариант под Win32.</span><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br /></p>
<hr />
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><a name="chapter7"></a><br /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">7) Сборка и Установка «СУБД PostgreSQL от 1С (релиз 9.0.3-3.1C от 17.01.12)» на Линукс CentOS (6.3) </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Первым делом, чтобы не было конфликтов в системе, нужно деинсталлировать все другие/предыдущие версии СЕРВЕРА PostgreSQL, если таковые установлены (проверьте).<br /><br /><span style=" vertical-align:sub;">Вредный совет: Чтобы не было путаницы из-за программной несовместимости, я также деинсталировал клиента «postgresql-8.4.13» (установленный изначально, из стандартного репозитария CentOS 6.3)… Некоторые пакеты (например, «postgresql-libs-8.4.13» и др.) сейчас пришлось оставить, т.к. от них зависят многие другие пакеты в системе — однако их можно будет деинсталировать потом, после установки PostgreSQL 9.0.3 (забегая вперёд, мне это удалось)…<br />Тем не менее, есть смысл оставить эти стандартные пакеты в системе (особенно «postgresql-libs-8.4.13») — на тот случай, если в будущем вам прийдётся деинсталировать PostgreSQL 9.0.3. Потому что сейчас у меня сложилась такая ситуация, что все системные пакеты теперь зависят только от пакета «postgresql-libs-9.0.3-3.1C» и менеджер пакетов не даёт деинсталировать последний не снеся заодно половину систему (крах).<br /></span><br /><br />К сожалению, в базовых репозитариях CentOS 6.3, т.е. в текущей системе, имеются не все необходимые библиотеки (зависимости) для использования готовой сборки «PostgreSQL от 1С». Кроме того, следует иметь в виду, что для работы сервера 1С: Предприятия 8.2 <a href="http://v8.1c.ru/overview/postgres_patches_notes.htm"><span style=" text-decoration: underline; color:#0000ff;">требуется версия PostgreSQL не ниже 8.3.8 </span></a>.<br /><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Я перепробовал разные дистрибутивы...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">PostgreSQL от 1С релиз 9.0.3-3.1C (последняя доступняя стабильная версия, патченная 1С) — сходу не установился из-за отсутствующих зависимостей, требует новые версии библиотек (libcrypto.so.4, libssl.so.4, libreadline.so.4, libtermcap.so.2).<br /><br />PostgreSQL от 1С релиз 8.4.3-3.1C — сходу не установился из-за отсутствующих зависимостей, требует новые версии библиотек (libcrypto.so.4, libssl.so.4, libreadline.so.4, libtermcap.so.2); также требуется установить пакет openldap (библиотеки libldap-2.2.so.7, libldap_r-2.2.so.7); [и необязательно, для дополнительных клиентов, требуются библиотеки: libpython2.3.so.1.0, libtcl8.4.so].<br /><br />PostgreSQL от 1С релиз 8.3.3-2.1C — сходу не установился из-за отсутствующих зависимостей, требует новые версии библиотек (libreadline.so.4, libtermcap.so.2); [и необязательно, для дополнительных клиентов, требуются библиотеки: libpython2.3.so.1.0, libtcl8.4.so]. Кроме того, устанавливаемый пакет «postgresql-libs-8.3.3» был меньшей версии и конфликтовал с уже установленным в системе пакетом «postgresql-libs-8.4.13» (поэтому версия 8.3.3 вообще не подходит).<br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Итак, лучше всего подходит версия «PostgreSQL от 1С релиз 9.0.3-3.1C», но собранные RPM-пакеты из дистрибутива «PG90331_setuppln903.rar» нам не подойдут: не установятся по зависимостям (там пакеты собраны для CentOS 5.x, а не для 6.x.)…<br /><br /><span style=" vertical-align:sub;">Неправильный подход: Апгрейдить вручную существующие старые библиотеки — это геморно и опасно (от них зависит куча софта из базового и стабильного ядра CentOS)! Ещё можно было бы вставить костыли-хаки в виде символических ссылок (с именами требуемых библиотек, ссылающиеся на существующие версии), но это совсем плохо на Production-сервере…<br /></span><br /><br />Поэтому чтобы не нарушать целостность ядра CentOS, <span style=" text-decoration: underline;">нужно пересобрать сам PostgreSQL из исходных кодов</span>, пропатчив его патчами 1C (так он будет базироваться на наших существующих библиотеках). Патченные исходники PostgreSQL берём из дистрибутива «PostgreSQL от 1С релиз 9.0.3-3.1C» -&gt; нам понадобится только файл «PG90331_Patch903.rar» -&gt; а из архива берём только файл «postgresql-9.0.3-3.1C.src.rpm»… или скачиваем этот файл напрямую с оф.сайта…<br /><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">7a)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-style:italic;">Примечание: Я не опытен в сборке из исходников, поэтому далее идёт слегка модифицированный рецепт из </span><a href="http://www.alsigned.ru/?p=1756"><span style=" font-style:italic; text-decoration: underline; color:#0000ff;">блога «Админа-маньяка» на alsigned.ru</span></a><span style=" font-style:italic;"> (автору респект).</span><br /><br /><span style=" text-decoration: underline;">Установка должна выполняться от имени пользователя root...</span><br /><br />Перед PostgreSQL, необходимо установить (или убедиться что уже установлена) <a href="http://icu.sourceforge.net"><span style=" text-decoration: underline; color:#0000ff;">библиотеку ICU</span></a> — она необходима для работы PostgreSQL версии от 1С. Установить можно вручную из RPM-пакета (но не нужно)… Или с помощью yum, из стандартного репозитария (что лучше):<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	yum install icu libicu libicu-devel</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Устанавливаем также пакеты необходимые для компиляции и сборки:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	yum install rpm-build wget glibc-devel bison flex readline-devel zlib-devel openssl-devel pam-devel gettext gcc make </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">7b) </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Загружаем с сайта 1с исходники PostgreSQL 9.0.3:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	wget http://v8.1c.ru/overview/postgresql_patches/9-0-3/postgresql-9.0.3-3.1C.src.rpm</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />и устанавливаем пакет с исходниками (будут созданы разные папки в системе и по ним раскиданы исходные файлы):<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	rpm -ihv postgresql-9.0.3-3.1C.src.rpm</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Открываем для редактирования файл /usr/lib/rpm/macros и меняем в нем уровень подгона пачей _default_patch_fuzz на 2: <br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	%_default_patch_fuzz    2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-style:italic;">Примечание: Раньше подобные действия приходилось делать только на Fedora 12 и выше, при сборке софта не поддерживающего обработку пачей новыми скриптами, а начиная с 6-ой версии новые скрипты пришли и в CentOS.</span><br /><br />Создаем символические ссылки на библиотеки libicu:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	ln -s /usr/lib/libicui18n.so /usr/local/lib/libicui18n.so.46	ln -s /usr/lib/libicudata.so /usr/local/lib/libicudata.so.46	ln -s /usr/lib/libicuuc.so   /usr/local/lib/libicuuc.so.46</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Переходим к сборке PostgreSQL:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	rpmbuild -bb --define 'runselftest 0' ~/rpmbuild/SPECS/postgresql-9.0-1C.spec</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-style:italic;">Примечание: Установкой параметра «runselftest 0» мы отказываемся от инициализации тестовой базы и проверки работоспособности PosgreSQL во время сборки, для того что бы тестирование прошло успешно его нужно выполнять из-под ограниченного пользователя, иначе процесс сборки будет остановлен.</span><br /><br />Процесс сборки займёт некоторое время…<br /><br />Наконец, просмотрим список собранных RPM-пакетов (т.к. у меня ОС Линукс 32-битная, то и пакеты PostgreSQL были собраны тоже 32-битной версии):<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	bash# ls -1 ~/rpmbuild/RPMS/i686	postgresql-9.0.3-3.1C.i686.rpm	postgresql-contrib-9.0.3-3.1C.i686.rpm	postgresql-debuginfo-9.0.3-3.1C.i686.rpm	postgresql-devel-9.0.3-3.1C.i686.rpm	postgresql-docs-9.0.3-3.1C.i686.rpm	postgresql-libs-9.0.3-3.1C.i686.rpm	postgresql-server-9.0.3-3.1C.i686.rpm	postgresql-test-9.0.3-3.1C.i686.rpm</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">7c)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Установка патченного сервера СУБД PostgreSQL от 1С:<br /><br />Совсем необязательно устанавливать все пакеты… для нормальной работы PostgreSQL вполне достаточно четырёх: postgresql-libs, postgresql, postgresql-server, postgresql-contrib. Переходим в директорию /root/rpmbuild/RPMS/i686 (на 64-битной ОС — в /root/rpmbuild/RPMS/x86_64) и устанавливаем пакеты…<br /><br />порядок установки пакетов следующий:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	postgresql-libs-9.0.3-3.1C.i686.rpm	postgresql-9.0.3-3.1C.i686.rpm	postgresql-server-9.0.3-3.1C.i686.rpm	postgresql-contrib-9.0.3-3.1C.i686.rpm</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Необязательно но полезно (для разработчиков) затем ещё установить следующие пакеты:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	postgresql-docs-9.0.3-3.1C.i686.rpm	postgresql-devel-9.0.3-3.1C.i686.rpm	postgresql-debuginfo-9.0.3-3.1C.i686.rpm	postgresql-test-9.0.3-3.1C.i686.rpm</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Но чтобы не заморачиваться с порядком установки — лучше установить все пакеты скопом (yum сам разберётся с зависимостями):<br />   rpm -ihv postgresql-9.0.3-3.1C.i686.rpm postgresql-contrib-9.0.3-3.1C.i686.rpm postgresql-debuginfo-9.0.3-3.1C.i686.rpm postgresql-devel-9.0.3-3.1C.i686.rpm postgresql-docs-9.0.3-3.1C.i686.rpm postgresql-libs-9.0.3-3.1C.i686.rpm postgresql-server-9.0.3-3.1C.i686.rpm postgresql-test-9.0.3-3.1C.i686.rpm<br /><br /><span style=" font-weight:600;">Грабли:</span> при установке пакета «postgresql-contrib-9.0.3-3.1C.i686.rpm» возникает ошибка?<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"> ошибка: распаковка архива не удалась на файле /usr/pgsql/lib/libicudata.so.46;4e9327cc: cpio: Digest mismatch<br /><br /> ошибка: postgresql-contrib-9.0.3-3.1C.i686: install failed<br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-weight:600;">Решение:</span> Запускаем rpm без проверки digest и md5<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	rpm --nodigest --nomd5 -ihv postgresql-contrib-9.0.3-3.1C.i686.rpm</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br /><span style=" text-decoration: underline;">Все вышеперечисленные действия должны выполняться от имени пользователя root.</span><br /><br /><span style=" font-style:italic;">После этого в операционной системе появится пользователь «postgres», который будет владеть всеми файлами СУБД и в сеансе которого будет запускаться сервер (не путайте его с одноимённым суперпользователем самой СУБД).<br />Будет создан скрипт /etc/init.d/postgresql для старта и остановки СУБД.<br />Бинарные файлы клиента и сервера PostgreSQL 9.0.3 находятся в /usr/pgsql/bin/…<br /></span><br /><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">7d)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Инициализируем кластер баз данных PostgreSQL (так называется директория, обычно /var/lib/pgsql/data, в которой хранятся данные всех баз этой установки СУБД PostgreSQL):<br /><br /><span style=" font-style:italic;">Примечание: в предыдущих версиях Postgres проходил трюк, когда мы просто запускали сервер СУБД, и он при первом запуске не обнаруживая директории с файлами БД — сам инициировал initdb… Но сейчас это не работает — </span><br />нужно запускать initdb явно и с правильными параметрами. При этом, нужно явно указать системного пользователя в сеансе которого происходит запуск сервера СУБД (командой «su postgres»). Также явно указываем локаль в которой работает сервер (locale=ru_RU.UTF-8).<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	bash# su postgres -c '/usr/pgsql/bin/initdb -D /var/lib/pgsql/data --locale=ru_RU.UTF-8'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />При выполнении этой команды, её консольный вывод подтвердит заданные параметры (в консоли появится текст):<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;">   Файлы, сопутствующие этой системе баз данных, будут принадлежать пользователю «postgres». Этот пользователь также должен быть владельцем процесса сервера. <br />   Кластер баз данных будет инициализирован с локалью ru_RU.UTF-8. Кодировка базы по умолчанию установлена в UTF8. Конфигурация полнотекстового поиска по умолчанию установлена в «russian».<br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br /><span style=" font-style:italic;">В результате будет создана база данных, размещенная в каталоге /var/lib/pgsql/data (примечание: тут же и конфиги сервера PostgreSQL).</span><br /><br /><span style=" font-weight:600;">Грабли:</span> если во время инициализации кластера баз данных выпадает ошибка?<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"> FATAL: could not create shared memory segment… <br /> HINT: This error usually means that PostgreSQL's request for a shared memory segment exceeded your kernel's SHMMAX parameter. You can either reduce the request size or reconfigure the kernel with larger SHMMAX. To reduce the request size (currently 35233792 bytes), reduce PostgreSQL's shared_buffers parameter (currently 3584) and/or its max_connections parameter (currently 104).<br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-weight:600;">Решение:</span> Необходимо увеличить значение параметра kernel.shmmax, для этого добавляем в файл /etc/sysctl.conf строчку:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	kernel.shmmax = 40000000</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Затем обновляем параметры sysctl следующей командой:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	bash# sysctl -p</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-style:italic;">Примечание: Обычно эта проблема характерна для 32-битных версий… Но у меня на CentOS 6.3 32bit такой проблемы не возникло — здесь уже установлен параметр kernel.shmmax = 4294967295<br /></span><br /><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">7e)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Настройка сервиса PostgreSQL:<br /><br />Добавляем в автозагрузку и запускаем сервис PostgreSQL:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	bash# chkconfig postgresql on	bash# service postgresql start</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Бинарные файлы клиента и сервера PostgreSQL 9.0.3 находятся в /usr/pgsql/bin/… Создадим символические ссылки на необходимые бинари, чтобы они запускались без указания пути (особенно это нужно для Консольного клиента PostgreSQL):<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	ln -s /usr/pgsql/bin/psql  /usr/local/bin/psql	и др.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />При первом запуске PostgreSQL, для контроля привилегий доступа к сущностям БД, в СУБД создаётся учётная запись суперпользователя «postgres» с паролем «postgres» (не путайте её с учётной записью ОС Линукс). Первое что нужно сделать – сменить стандартный пароль… Задаем пароль для суперпользователя СУБД «postgres» командой:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	bash# psql -U postgres -c &quot;ALTER USER postgres PASSWORD 'newpassword'&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-style:italic;">Примечание: теперь этот пароль будет использоваться при соединении клиентов к СУБД: login=«postgres» password=«newpassword».</span><br /><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">7f)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Настраиваем сервер PostgreSQL для работы с «Сервером 1С: Предприятие» (правим конфиги):<br />См. <a href="http://1clinux.org/index.php?topic=447.0"><span style=" text-decoration: underline; color:#0000ff;">описание параметров конфигов на русском...</span></a><br /><br />В файле /var/lib/pgsql/data/postgresql.conf — настройки сервера. Нужно указать параметры (раскомментировать строки или если этих параметров нет, то ввести их вручную):<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	default_with_oid = on</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />По умолчанию, Автовакуум в PostgreSQL 9.0.3 отключён… Если вы хотите включить «Автоматическую сборку мусора (Automatic Vacuuming)» в БД (что полезно для слабонагруженных серверов, чтобы админу не требовалось делать процедуру «упаковки БД» периодически и вручную, а просто установить и забыть) — то установите такие параметры:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	track_counts = on	autovacuum = on</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-style:italic;">Примечание: в предыдущих версиях СУБД был параметр «stats_row_level»… но в PostgreSQL 9.0.3 этот параметр устарел и вошёл в новый параметр «track_counts».</span><br /><br />В файле /var/lib/pgsql/data/pg_hba.conf настраивается политика доступа и идентификации пользователей (т.е. допустимые параметры подключения к PostgreSQL-серверу)… Убедитесь, что в конце этого файла указана незакомментированная такая строчка (что означает «разрешить подключения к серверу с любых хостов, пароли при логине хешируются md5»):<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	host all all 0.0.0.0/0 md5</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-style:italic;">Примечание: если в строке политики заменить «md5» на «trust», то пароль при подключении проверяться не будет! (полезно для восстановления/изменения забытого пароля суперпользователя) Также обратите внимание, что политика по-умолчанию для клиентских подключений с localhost: пароли не проверяются...</span><br /><br /><span style=" font-style:italic;">Примечание: Эти параметры вы сможете конфигурировать и позднее. А когда убедитесь, что всё включая клиента 1С работает — имеет смысл, в целях безопасности, ограничить подключения только локальным хостом localhost (или точнее хостами «кластера серверов 1С», если они отделены)...</span><br /><br />Наконец, перезапустите сервер PostgreSQL:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	/etc/init.d/postgresql restart</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br /></p>
<hr />
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><a name="chapter8"></a><br /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">8) Установка «Сервера 1С: Предприятие 32bit для RPM-based Linux-систем (8.2.16.368)» на Линукс CentOS (6.3)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Дистрибутив серверной части 1С: Предприятия 8 для Linux представлен в виде нескольких rpm-пакетов: <br /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> 1C_Enterprise-common — общие компоненты 1С: Предприятия 8; </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> 1C_Enterprise-server — компоненты сервера 1С: Предприятия 8; </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> 1C_Enterprise-ws — адаптер для публикации Web—сервисов 1С: Предприятия 8 на веб-сервере на основе Apache HTTP Server 2.0 или Apache HTTP Server 2.2; </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> 1C-Enterprise-crs — компоненты сервера хранилища конфигурации 1С: Предприятия 8. </li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> Пакеты, содержащие в названии суффикс &quot;-nls&quot; — это дополнительные национальные ресурсы для соответствующего пакета. </li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Пакеты 1C_Enterprise-server и 1C_Enterprise-ws не зависят друг от друга. Соответственно, они могут быть установлены на одном компьютере как вместе, так и по отдельности (т.е. «сервер 1С» и «Web-сервер» можно разнести по разным машинам, как и отделить сервер СУБД, для разгрузки «сервера 1С»)…<br /><br /><span style=" text-decoration: underline;">Установка должна выполняться от имени пользователя root...</span><br /><br />При установке следует учитывать следующие зависимости между пакетами (чтобы успешно установить пакет, предварительно нужно установить все пакеты, от которых он зависит) — поэтому порядок установки следующий:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	rpm -ihv 1C_Enterprise82-common-8.2.16-368.i386.rpm	rpm -ihv 1C_Enterprise82-common-nls-8.2.16-368.i386.rpm	rpm -ihv 1C_Enterprise82-server-8.2.16-368.i386.rpm	rpm -ihv 1C_Enterprise82-server-nls-8.2.16-368.i386.rpm	rpm -ihv 1C_Enterprise82-ws-8.2.16-368.i386.rpm	rpm -ihv 1C_Enterprise82-ws-nls-8.2.16-368.i386.rpm	rpm -ihv 1C_Enterprise82-crs-8.2.16-368.i386.rpm	rpm -ihv 1C_Enterprise82-crs-nls-8.2.16-368.i386.rpm</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Затем сервер следует запустить в режиме демона:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	/etc/rc.d/init.d/srv1cv82 stop	/opt/1C/v8.2/i386/ragent -daemon	/etc/rc.d/init.d/srv1cv82 restart</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br /><span style=" text-decoration: underline;">Все вышеперечисленные действия должны выполняться от имени пользователя root.</span><br /><br /><span style=" font-style:italic;">В процессе установке компонент сервера 1C: Предприятия 8 создается пользователь операционной системы с именем usr1cv82, под учетной записью которого будут исполняться серверные процессы 1С: Предприятия 8.</span><br /><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">8a)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />После установки всех требуемых пакетов, нужно запустить скриптовую утилиту диагностики и инициализации графической подсистемы в 1С v8.2 и выполнить её рекомендации, если таковые возникнут. (Утилита проверяет систему на наличие в ней требуемых для графической подсистемы в 1С v8.2 компонентов и настроек, и выдаёт рекомендации, если 1С ещё что-то требуется.)<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	/opt/1C/v8.2/i386/utils/config_server</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Дополнительная информация про утилиту «config_server»: на <a href="http://nefrit.arvixe.ru/page/oshibka-inicializacii-graficheskoj-podsistemy-v-1s-v82"><span style=" text-decoration: underline; color:#0000ff;">nefrit.arvixe.ru</span></a> и <a href="http://blog.unixstyle.ru/index.php?/archives/106-1-v8.2.html"><span style=" text-decoration: underline; color:#0000ff;">blog.unixstyle.ru</span></a>…<br /><br />Порядок настройки системы с помощью утилиты «config_server» будет примерно следующий <span style=" font-style:italic;">(некоторые из этих этапов у вас могут отсутствовать — пропустите)</span>:<br /><br /><span style=" text-decoration: underline;">Установка должна выполняться от имени пользователя root...</span><br /><br />1) После первого запуска утилиты «config_server» — должна вылететь ошибка: «Can not detect font directory, please specify it!»<br /><span style=" font-weight:600;">Решение:</span> ставим отсутствующие TTF-шрифты по рецепту <a href="http://linewb.ru/faq/kak_ustanovit_shrifty_microsoft_true_type_na_linux/12-0-54"><span style=" text-decoration: underline; color:#0000ff;">linewb.ru FAQ</span></a> и <a href="http://corefonts.sourceforge.net/"><span style=" text-decoration: underline; color:#0000ff;">сайта corefonts.sourceforge.net</span></a>.<br /><span style=" font-style:italic;">Примечание: система папок ~/rpmbuild/ у вас уже должна существовать (они были созданы ранее, при сборке дистрибутива PostgreSQL).</span><br />В итоге, для установки шрифтов, достаточно примерно следующих действий:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	yum install rpm-build cabextract	wget http://corefonts.sourceforge.net/msttcorefonts-2.5-1.spec	rpmbuild -bb msttcorefonts-2.5-1.spec	rpm -ivh ~/rpmbuild/RPMS/noarch/msttcorefonts-2.5-1.noarch.rpm</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />2) Повторно запускаем утилиту «config_server» — должна вылететь ошибка: «No truetype conversion utility found! Please install ttf2afm or ttf2pt1!»<br /><span style=" font-weight:600;">Решение:</span> ставим утилиту ttf2pt1 (доступна в репозитарии EPEL):<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	yum install ttf2pt1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />3) Третий раз запускаем утилиту «config_server» — cистема задумается подольше и все будет отлично: больше ошибок в консоль не выдаст…<br /><br />Наконец, нужно перегрузить «Сервер 1С» (или целиком всю машину):<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	/etc/init.d/srv1cv82 restart</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br /><span style=" text-decoration: underline;">Все вышеперечисленные действия должны выполняться от имени пользователя root.</span><br /><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">8b)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Все, установка «Сервера 1С» на ОС Линукс завершена!<br />Остается подключиться к этому «Серверу 1С» через MMC-консоль «Администрирование сервера 1С: Предприятие 8.2» и создать «информационные базы» конфигураций. Об этом ниже…<br /><br /><span style=" font-style:italic;">Примечание: MMC-консоль устанавливается в составе «Технологической платформы 1С: предприятия 8.2» — на другом хосте, и только под управлением Windows. (Хотя в версии «1С: Предприятие 8.3» обещают, что уже реализовано ПО администрирования и под Линукс...)</span><br /><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">8c)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Настраиваем поддержку web-клиентов 1С через вебсервер Apache:<br /><br />Подготовка: Мы будем использовать локальный вебсервер Apache, установленный на этой же линукс-машине, что и «Сервер 1С». Если у вас ещё не установлен вебсервер Apache — то выполните действия из раздела «Task: Install Apache/httpd under Fedora Core/Cent OS Linux» статьи <a href="http://www.cyberciti.biz/faq/linux-install-and-start-apache-httpd/"><span style=" text-decoration: underline; color:#0000ff;">«How to install and start the Apache or httpd service under Linux»</span></a>:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	yum install httpd	chkconfig httpd on	/etc/init.d/httpd start</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Далее, действуем как сказано в разделе «2. Публикация web-клиента» статьи <a href="http://www.alsigned.ru/?p=416"><span style=" text-decoration: underline; color:#0000ff;">«Ставим 1C web-клиент на Apache»...</span></a><br /><br />Предположим, у вас на «Сервере 1С» есть информационная база с названием «test1c» <span style=" font-style:italic;">(фактически она будет создана поздже, после инициализации кластера и создания БД в postgreSQL… но публикацию можно выполнить спекулятивно и сейчас, т.к. фактически к ИБ мы обращаться не будем, а просто поправим конфиги Apache и создадим на вебсервере заглушку, некоторые папки/файлы).</span> Процедура публикации очень простая и автоматизированная (каждый шаг подробно описан в вышеназванной статье, поэтому тут не повторяюсь) — нужно исполнить следующие команды:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	cd /opt/1c/v8.2/i386	./webinst -apache22 -wsdir test1c -dir '/var/www/html/test1c/' -connStr 'Srvr=&quot;delldev&quot;;Ref=&quot;test1c&quot;' -confPath /etc/httpd/conf/httpd.conf	chown apache:apache /var/www/html/test1c/default.vrd	chkconfig httpd on	service httpd start</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Всё, информационная база «test1c» опубликована! Когда вы до конца настроите «кластер серверов 1С» и информационную базу, то к ней можно будет подключиться через броузер, введя адрес http:// delldev/test1c <span style=" font-style:italic;">(где delldev — имя хоста под управлением CentOS, с «Сервером 1С» и «вебсервером Apache», который мы сейчас настраиваем)...</span><br /><br /><span style=" font-style:italic;">Помните: чтобы веб-клиент заработал — также необходимо: к хосту, на котором работает «Сервер 1С» или «Web-сервер Apache» (в данном случае он один), подключить пакет «Сетевых клиентских лицензий» (ключ защиты можно подключить локально или настроить доступ к «менеджеру лицензий»); и включить в «Свойствах» Информационной Базы пункт «Выдавать лицензии сервером приложения» (настраивается через оснастку «Администрирование серверов»).</span><br /><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">8d)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Дополнительно: следует знать <a href="http://www.kraeg.ru/content/vklyuchenie-tekhnologicheskogo-zhurnala-v-1s"><span style=" text-decoration: underline; color:#0000ff;">как включить «Технологический журнал»</span></a> (он же «логи», он же «log»)…<br /><br />По-умолчанию логи отключены, потому что они быстро разрастаются и занимают очень много места на диске (при ошибках, вместе с «логами» создаются также «дампы»). Включайте логи только если вам действительно необходимо отследить некую проблему.<br /><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">8e)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Дополнительно: если вдруг понадобится… для удаления «Сервера 1С», следует выполнить такие шаги:<br /><br />Перед удалением необходимо завершить работу кластера серверов: <br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	/etc/rc.d/init.d/srv1cv82 stop </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Затем, удаляем пакеты в порядке, обратном установке, чтобы зависимый пакет удалялся до того пакета, от которого он зависит:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	rpm -e 1C_Enterprise82-crs-nls-8.2.16-368.i386.rpm	rpm -e 1C_Enterprise82-crs-8.2.16-368.i386.rpm	rpm -e 1C_Enterprise82-ws-nls-8.2.16-368.i386.rpm	rpm -e 1C_Enterprise82-ws-8.2.16-368.i386.rpm	rpm -e 1C_Enterprise82-server-nls-8.2.16-368.i386.rpm	rpm -e 1C_Enterprise82-server-8.2.16-368.i386.rpm	rpm -e 1C_Enterprise82-common-nls-8.2.16-368.i386.rpm	rpm -e 1C_Enterprise82-common-8.2.16-368.i386.rpm</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Или также можно выполнить удаление всех rpm-пакетов одной универсальной командой, которая удалит все установленные пакеты, которые начинаются с префикса «1C_», а зависимости будут отслежены автоматически:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	rpm —e`rpm —qa|grep 1C_` </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br /></p>
<hr />
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><a name="chapter9"></a><br /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">9) Установка защитных ключей (лицензирование 1С)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Подключить ключи к «Серверу 1С» — просто. Нужно скачать драйвер с сайта производителя ключа, распаковать его и выполнить установку двойным кликом…<br /><br />Советы по выбору драйвера — <a href="http://forum.alsigned.ru/viewtopic.php?f=5&amp;t=165#p494"><span style=" text-decoration: underline; color:#0000ff;">рекомендуют использовать драйвер от Etersoft...</span></a><br />Драйверы ключей и менеджер лицензий для Linux и WINE@Etersoft, собранные для всех систем — <a href="http://wiki.etersoft.ru/HASP"><span style=" text-decoration: underline; color:#0000ff;">можно получить здесь...</span></a><br />Конкретно под линукс CentOS 6 — <a href="http://download.etersoft.ru/pub/Etersoft/HASP/last/CentOS/6/"><span style=" text-decoration: underline; color:#0000ff;">драйвера качать отсюда...</span></a><br /><br />Установка HASP-драйвера от Etersoft, со встроенным «менеджером лицензий»:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">	rpm -ihv haspd-3.3-eter4scientific.i586.rpm haspd-modules-3.3-eter4scientific.i586.rpm</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Далее, нужно вставить в USB-порт этого сервера два аппаратных ключа: «ключ на сервер 1С: Предприятие» и «ключ на X сетевых пользовательских лицензий» (все ключи в одной физической «флешке»). И всё должно заработать: клиенты будут получать клиентские лицензии через сервер…<br /><br /><span style=" font-style:italic;">Примечание: Ключи нужны только для «Сервера приложений 1С: Предприятие» и для «защищённых клиентских приложений 1С». с СУБД PostgreSQL проблем нет — это opensource и не требует ни лицензий, ни ключей (в отличие от СУБД «MS SQL Server», но мы её не используем).<br /><br />Примечание: Некоторые версии 1С работали и без ключей (беты)...</span><br /><br /><span style=" font-weight:600;">Внимание:</span> Нелицензионный «Сервер 1С» (т.е. даже без «серверного ключа») нормально работает с небольшим числом клиентских подключений (до ~12 подключений). Вероятно это сделано для облегчения задач администрирования: начального конфигурирования и мониторинга в случае проблем… Но при превышении этого административного лимита — Сервер начинает отвергать новые подключения и требовать ключ.<br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">По результатам эксперимента...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> у меня точное число допустимых подключений = 13, из которых 1-3 подключения, в разное время, могут захватываться некоторыми внешними сервисами самого 1С (они периодически автоматически стартуют, делают что-то своё и отключаются).<br /><br />Список текущий соединений можно увидеть через оснастку «Администрирование серверов»: <br /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">&quot;… / Рабочие серверы / Рабочие процессы / Соединения&quot; — соединения в целом к серверу</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">&quot;… / Информационные базы / test1c (имя ИБ) / Соединения&quot; — соединения к конкретной ИБ (их может быть меньше, чем к серверу в целом)</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-style:italic;">Примечание: однако «клиентские ключи» (локальные или сетевые) требуются для «защищённых клиентских приложений 1С», в любом случае — что для первого подключения к серверу, что для сотого!</span><br /><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Дополнительная информация по использованию ключей...</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; font-weight:600;">Какие бывают ключи?</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br /><span style=" font-weight:600;">1) По назначениям</span>, ключи 1С бывают трёх типов:<br /><br /></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> <span style=" text-decoration: underline;">Локальные однопользовательские клиентские ключи</span> — обязательно должны физически быть подключены к компьютеру, на котором запускается клиент 1С (по одному в каждый комп). модель ключа «HASP HL Basic» (синего цвета), данный ключ имеет маркировку «H4 M1 ORGL8», не имеет встроенной памяти и персонального ID, не хранит в себе никаких параметров и настроек. Обычно поставляется с продуктами имеющими лицензию на одно рабочее место...</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> <span style=" text-decoration: underline;">Сетевые многопользовательские клиентские ключи</span> — раздаются с одного компьютера многим удалённым сетевым клиентам, через службу «Менеджер лицензий». Модель ключа «HASP HL Net» (красного цвета). Имеют внутреннюю память, в которой хранится количество лицензий, и уникальный ID. Существуют разновидности на 5, 10, 20, 50 и 100 пользователей. Имеет маркировку «NETXX ORGL8», где ХX — количество лицензий (например NET5 ORGL8).</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> <span style=" text-decoration: underline;">[Локальные] Серверные ключи</span> — обязательно должны физически быть подключены локально к компьютеру, на котором установлен и работает сервер агента 1С: Предприятие. (Подчеркну: Ключи для сервера 1С: Предприятие бывают только локальные!)<br /></li></ol>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> 32-битная версия сервера имеет ключ защиты «HASP HL Pro» (фиолетового цвета), который имеет внутреннюю память и уникальный ID. Имеет маркировку ENSR8, поставляется вместе с лицензией на сервер 1С: Предприятие.</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> Для 64-битного сервера используется ключ «HASP HL Max» (зеленого цвета), с внутренней памятью и уникальным ID. Имеет маркировку EN8SA и поддерживает также 32-битный сервер (т.е. имея лицензию на 64-битный сервер можно, не меняя ключа, использовать 32-битную версию, но не наоборот).</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /> Подробности тут:<br /> <a href="http://www.online-ufa.ru/content/articles/marking_security_keys_1c/"><span style=" text-decoration: underline; color:#0000ff;">www.online-ufa.ru/content/articles/marking_security_keys_1c/</span></a><br /> <a href="http://interface31.ru/tech_it/2010/02/klyuchi-zashhity-1s-predpriyatie-81.html"><span style=" text-decoration: underline; color:#0000ff;">interface31.ru/tech_it/2010/02/klyuchi-zashhity-1s-predpriyatie-81.html</span></a><br /> <a href="http://www.k-max.name/windows/ne-obnaruzhen-klyuch-zashhity-programmy-v-1spredpriyatie-8-ili-likbez-zashhity-1s/"><span style=" text-decoration: underline; color:#0000ff;">www.k-max.name/windows/ne-obnaruzhen-klyuch-zashhity-programmy-v-1spredpriyatie-8-ili-likbez-zashhity-1s/</span></a><br /><br /><span style=" font-weight:600;">2) По конструктивному исполнению</span>, и серверные и клиентские ключи, бывают реализованы как: <br /><br /></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> «Аппаратные ключи» (физические устройства, вставляются в USB-порт подобно флешкам) — их легче использовать и они самые понятные/отработанные на практике.</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> «Программные ключи» (как серийник; активируются с привязкой к конкретному железу посредством интернета/телефона; требуют переактивации каждый раз ПРИ ЛЮБОМ изменении в конфигурации оборудования: например, если планку памяти поменял) — <a href="http://forum.ixbt.com/topic.cgi?id=96:1019"><span style=" text-decoration: underline; color:#0000ff;">с их использованием возникает много вопросов...</span></a></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Примечания:<br /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> Само название HASP (от англ. Hardware Against Software Piracy) — это мультиплатформенная аппаратно-программная система защиты программ и данных от нелегального использования и несанкционированного распространения...</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> Многими драйверами поддерживаются АППАРАТНЫЕ КЛЮЧИ защиты (USB,LPT) — с ними проще и безопаснее иметь дело, они универсальнее.</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> Но также есть сведения, что некоторыми драйверами поддерживаются и ПРОГРАММНЫЕ ЛИЦЕНЗИИ (что удобно при работе 1С: Предприятие в виртуализованной среде типа Hyper-V). Но таковых решений гораздо меньшее количество. И имеется ли реализация драйвера под ваш Линукс? — ещё вопрос...</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> Аппаратные ключи и программные лицензии могут использоваться совместно...</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Подробнее тут: <a href="http://www.gilev.ru/1c/hasp/"><span style=" text-decoration: underline; color:#0000ff;">www.gilev.ru/1c/hasp/</span></a><br /><br /><span style=" font-weight:600;">3) Лицензионная политика 1С</span> мутная… Причём, есть две модели лицензирования: «старая, применяющаяся в версии 8.1» и «новая, пришедшая в связи с выходом версии 8.2» (потому что в версии 8.2 появились новые необычные возможности: «тонкий клиент» и «Web-клиент», вся логика которых реализована на сервере. Причём, «Web-клиент» вообще не имеет технической возможности подключить ЛОКАЛЬНЫй HASP-ключ, потому что работает в окружении веб-браузера — понадобилась новая модель лицензирования...)<br /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> Для пользователей, работающих с толстым или тонким клиентом, может использоваться модель лицензирования, применяющаяся в версии 8.1. Лицензия дает право на запуск неограниченного количества сеансов на конкретном компьютере пользователя. При этом ключ аппаратной защиты должен быть установлен в компьютере пользователя или доступен этому компьютеру по локальной сети.</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> Для пользователей, работающих с тонким, толстым и веб-клиентом в клиент-серверном режиме или через веб-сервер, может применяться новая модель лицензирования. Лицензия дает право на запуск одного сеанса. Ключ аппаратной защиты должен быть установлен в компьютере сервера или веб-сервера или доступен этому компьютеру по локальной сети. </li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Источник: <a href="http://nefrit.arvixe.ru/page/utochnenie-licenzionnoj-politiki-dlja-1spredprijatija-82"><span style=" text-decoration: underline; color:#0000ff;">nefrit.arvixe.ru/page/utochnenie-licenzionnoj-politiki-dlja-1spredprijatija-82</span></a><br /><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; font-weight:600;">Какие ключи поддерживаются драйвером от Etersoft?</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Поддерживаемые драйвером от Etersoft ключи защиты:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    HASP 3/HASP 4/HASP HL от Aladdin (HASP SRM пока не поддерживается)    Smartkey 3 от Eutron    SafeNet и UltraPro/SuperPro от Sentinel    SenseLock (USB)    Катран (USB и LPT)    Guardant Stealth/Net II USB, Stealth/Net III USB, Stealth III Sign/Time USB HID от компании Актив</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Подробнее — см. в <a href="http://kb.etersoft.ru/Support_key"><span style=" text-decoration: underline; color:#0000ff;">полном списке поддерживаемых ключей...</span></a><br /><br /><span style=" font-style:italic;">Ещё не проясненный вопрос: Поддерживает ли драйвер от Etersoft под Линукс «программные лицензии» (и если да, то каким образом они активируются?) или только «аппаратные ключи (USB)»? </span><br /><br /><span style=" font-style:italic;">Ещё не проясненный вопрос: Сколько одновременно подключенных локально к компьютеру ключей распознаёт драйвер от Etersoft под Линукс? </span><br /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> Уточню: к одному компьютеру гарантированно можно подключить один «серверный ключ» И один «клиентский ключ» (на 5, 10, 20, 50, 100 пользователей) — оба подхватятся и будут работать нормально. Но если вы подключите одновременно два и более «клиентских ключа» (например, на 5 + на 20 пользователей), то из них увидится только один, причём случайно какой.</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> Есть известная особенность «драйверов HASP под Windows»: он распознаёт/подхватывает только один ключ из множества подключённых к компьютеру (По крайней мере, точно не поддерживает несколько ключей одной серии! А несколько ключей разных серий может быть и проиндексирует, в зависимости от реализации/версии драйвера… Причём, не подхватывает по такой системе: либо подхватывает любой ключ совершенно случайно, игнорируя остальные; либо подхватывает только ключ что в USB-порте с младшим номером или в LPT-порте ближайший.)</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> Как с этим у «драйвера от Etersoft под Линукс»? Похоже что также — поскольку это особенность технологии, и регламентируется в большинстве руководств...</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br /><span style=" font-style:italic;">По результатам эксперимента: драйвер от Etersoft также имеет встроенную службу «HASP License Manager». Утилита «Aladdin NetHASP Monitor» видит на линукс-хосте с Сервером 1С: Предприятие службу «HASP License Manager». Но реальную работу службы (раздачу сетевых клиентских ключей) пока протестировать не смог (нет официальных ключей)...</span><br /><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; font-weight:600;">Документация/Вопросы по установке/настройке драйвера от Etersoft</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Про установку и использование АППАРАТНЫХ КЛЮЧЕЙ защиты в Linux, с драйвером от Etersoft — читай тут: <br /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> <a href="http://etersoft.ru/products/wine/manual#linux"><span style=" text-decoration: underline; color:#0000ff;">Документация по продукту WINE@Etersoft / Использование аппаратных ключей защиты в Linux...</span></a></li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> <a href="http://kb.etersoft.ru/%D0%9F%D0%BE%D0%B4%D0%B4%D0%B5%D1%80%D0%B6%D0%BA%D0%B0_%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9_HASP_%D0%B2_Wine"><span style=" text-decoration: underline; color:#0000ff;">Поддержка ключей HASP в Wine</span></a></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; font-weight:600;">Другие вопросы по эксплуатации ключей (рассматриваются только Аппаратные ключи защиты)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Аппаратный ключ защиты, вставленный в USB-порт, можно использовать следующим образом:<br /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> Локально установленным ПО;</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> Существуют варианты проброса локального USB-порта в установленную виртуальную машину (VM), в которой крутится комплекс 1С;</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> существуют варианты проброса USB-порта по сети (это для каких-то очень специальных нужд, не путать с «менеджером лицензий»).</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Варианты лицензирования клиентских программ 1С:<br /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> «Локальный однопользовательский клиентский ключ» подключается в USB-порт локального компьютера, где используется локальным HASP-драйвером для лицензирования локально установленного «защищённого ПО». Внимание: но «Локальный однопользовательский клиентский ключ» не работает на компьютере, где установлен Сервер Терминалов!</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> И «сервер лицензирования» (некий удалённый хост, на котором установлен «менеджер лицензий» и вставлен «сетевой ключ») — может лицензировать по сети множество защищённых программ (клиентов 1С) с удалённых хостов. </li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /> <br />Для лицензирования ПО запускаемого в сессиях <span style=" text-decoration: underline;">на Сервере Терминалов — необходимо использовать «Сетевые многопользовательские клиентские ключи»</span>, через «HASP License Manager» («менеджер лицензий»), установленный локально или на другом компьютере локальной сети («сетевой ключ» естественно вставляется в тот компьютер, где устанавливается «менеджер лицензий»).<br /><br /><span style=" font-style:italic;">Примечание: «Сервер Терминалов» был необходим в 1С 7.7 для обеспечения надёжной работы многих пользователей по сети… В 1С 8.2 гораздо более развитые сетевые клиент/серверные возможности: появилась трёхуровнеая архитектура с выделенным сервером приложений, кластер серверов с баллансировкой нагрузки и т.п. В 1С 8.2 надёжная работа через сеть отлично обеспечивается и без использования «Сервера Терминалов»! Кроме того в 1С 8.2 появилась замечательная универсальная альтернатива — веб-клиент… <br /><br />Однако, «Сервер Терминалов» всё ещё может использоваться вместе с 1С 8.2 и полезен в случаях: если вы не хотите устанавливать/настраивать приложения 1С «Толстый или Тонкий Клиент» на каждом клиентском хосте (которые обязательно должны быть в текущей локальной сети); если клиентские хосты расположены не в текущей локальной сети (и не связаны VPN) и если для них вы по каким-то причинам не хотите использовать «веб-клиентов 1С» (например, «веб-клиент» и «тонкий клиент» работают только в конфигурациях, написанных </span><a href="http://easyprog.ru/index.php?option=com_content&amp;task=view&amp;id=630&amp;Itemid=9"><span style=" font-style:italic; text-decoration: underline; color:#0000ff;">в режиме «управляемого приложения»</span></a><span style=" font-style:italic;"> ). </span><br /><br /><span style=" text-decoration: underline;">Для лицензирования веб-клиентов 1С: Предприятие 8.2</span>, которые работают в окружении веб-броузера и физически изолированы от локального компьютера (локального ключа) и от локальной сети (сетевого ключа) — применяется новая модель лицензирования, когда <span style=" text-decoration: underline;">«клиентский ключ» для этого подключения делегируется через обслуживающий клиента «Сервер 1С» или «Веб-сервер».</span> <br /><br /><span style=" font-style:italic;">Поэтому чтобы заработал веб-клиент: кроме обеспечения сервера доступными «сетевыми клиентскими лицензиями» (локально воткнуть ключ или настроить доступ к «менеджеру лицензий»), обязательно необходимо включить в «Свойствах» Информационной Базы пункт «Выдавать лицензии сервером приложения» (через оснастку «Администрирование серверов») — см. </span><a href="http://www.forum.mista.ru/topic.php?id=536845"><span style=" font-style:italic; text-decoration: underline; color:#0000ff;">обсуждение граблей...</span></a><br /><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; font-weight:600;">Работа с ключами по сети — Менеджер лицензий</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br /><span style=" text-decoration: underline;">Если у вас два и более комплекта «сетевых пользовательских ключей»</span> (например, другие были докуплены позднее), то вставлять их в порт одного компьютера нельзя (драйвер не увидит все ключи). Нужно взять отдельный хост в текущей локальной сети, установить там «HASP driver» и «HASP License Manager» (он шарит ключи по сети), и затем воткнуть в этот хост только один «сетевой ключ». Для остальных ключей — повторить процедуру… Каждый ключ «пользовательских лицензий» необходимо вставлять в отдельный хост!<br /><br />Варианты установки «Менеджера лицензий»:<br /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">До недавнего времени, существовал только один вариант установки «Менеджера лицензий» автономно (без Сервера 1С): требовался обязательно компьютер под управлением ОС Windows.</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Под Линукс, сейчас <a href="http://forum.ru-board.com/topic.cgi?forum=8&amp;topic=42852"><span style=" text-decoration: underline; color:#0000ff;">регламентируется поддержка работы «HASP License Manager» по такой схеме</span></a>: Сервер 1С: Предприятие 8.2 на Linux + Сервер PostgreSQL 9.0.3 на Linux + HASP License Manager на Linux + клиенты 1С на Windows.</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Но последнее время софт защиты под Линукс активно разрабатывается, поэтому скоро могут возникнуть и другие варианты...</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Назначение «Менеджера лицензий»:<br /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">HASP License Manager позволяет организовать сеть распределённых ключей, которыми будут пользоваться сервер и клиенты 1С (защищённые приложения).</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">HASP License Manager устроен так: Выдаёт лицензии обратившимся к нему «защищённым приложениям». уменьшая внутренний счётчик доступных от ключа лицензий. Когда лицензий уже нет, то клиент не может получить лицензию ОТ ЭТОГО экземпляра «менеджера лицензий» — тогда «защищённое приложение» обращается к следующему найденному в сети «менеджеру лицензий» (если таковой есть) и просит лицензии у него, затем к следующему… </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Программы находят друг друга через локальную сеть автоматически, с помощью широковещательных запросов; или соединения к конкретному (одному или нескольким) «менеджеру лицензий» можно прописать явно (как серверу, так и клиентам), через конфиг nethasp.ini, расположенный в папке установки каждого «защищённого приложения» (<a href="http://www.forum.mista.ru/topic.php?id=502155"><span style=" text-decoration: underline; color:#0000ff;">а под линуксом тут: /opt/1С/v8.2/i386/conf/ </span></a>)...</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">При автоматической конфигурации, все «менеджеры лицензий» в сети должны быть видны всем работающим программам. Но сеть бывает сегментирована через VPN (широковещательные запросы могут быть запрещены), бывают проблемы с каналами и оборудованием (пакеты могут повреждаться/теряться) — тогда нужно дополнительно конфигурировать эту сеть «менеджеров лицензий» (явно прописывать IP и протоколы соединения).</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Схема/порядок проверки лицензий 1C примерно следующий:<br /></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Клиентские программы сначала ищут «локальный ключ»… </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если не находят локального ключа, то ищут в сети «сервер лицензирования» и получают лицензию от него. </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если на первом «сервере лицензирования» закончились свободные лицензии, а в сети найдены другие «серверы лицензирования» — то клиенты последовательно обходят следующие сервера и получают лицензию от них...</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">И только когда «клиентская лицензия получена» — программы идут подключаться к «Серверу 1С». </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">«Сервер 1С» проверяет свою «лицензию на сервер» и количество доступных подключений <span style=" font-style:italic;">(рабочие сервера кластера имеют настраивамый лимит подключений, для баллансировки нагрузки; на это накладывается ограничение работы «Сервера 1С» без «серверного ключа»)</span> — если ок, то принимает клиента и даёт подключение к Информационной базе. </li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">А ещё информационные базы (Конфигурации) тоже могут иметь свою встроенную защиту: проверку лицензии подключаемого клиента. </li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br /><span style=" font-style:italic;">Примечание: механизм проверок всё усложняется, от релиза к релизу, для обнаружения новых нелицензионных ключей и эмуляторов. И для усложнения жизни хакерам, 1С тщательно скрывает детали проверки — поэтому если что-то при проверке пошло не так, то программа просто скажет «Не найден ключ защиты». А что и где у него «не так»? (либо ключ сгорел, либо HASP-драйвер кривой, либо «License Manager» неправильно сконфигурирован, либо приложение, либо проблемы с сетью) — х. его знает… Приходится догадываться методом «телепатии и научного тыка» (правда логи чуток помогают) — чем сильно усложняется жизнь и всем лицензионным пользователям и администраторам.</span><br /><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br /></p>
<hr />
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><a name="chapter10"></a><br /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">10) Далее, устанавливаем клиентскую часть — на другой машине под управлением Windows</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">10a)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />См. подробнейшие <a href="http://1c-md.com/administrirovanie/ustanovka-1s.html"><span style=" text-decoration: underline; color:#0000ff;">инструкции по установке «Технологической платформы для Windows»</span></a>(в картинках и с видео)…<br /><br />Запускаем инсталлятор «Технологическая платформа для Windows версии 8.2.16.368» (в версии 8.2 бывает только 32-битная) — там все программы в одном флаконе. При установке выбираем следующие компоненты: <br /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> «1С: Предприятие» (Основные компоненты «1С: Предприятия», включая компоненты для администрирования, конфигурирования, толстый и тонкий клиент)</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> «1С: Предприятие — Тонкий клиент» (Компоненты тонкого клиента только для работы в клиент-серверном варианте, без возможности работы с файловым вариантом)</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> «Администрирование сервера 1С: Предприятия» (MMC-консоль для администрирования кластера серверов)</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> «Интерфейсы на различных языках: английский, русский...» (по-умолчанию)</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Подчёркиваю, мы не ставим следующие компоненты (они не нужны в этом клиент/серверном варианте использования 1С):<br /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> «1С: Предприятие — Тонкий клиент, файловый вариант» (Компоненты тонкого клиента, включая <span style=" font-style:italic;">компоненты для работы с файловым вариантом информационной базы</span>)</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> «Сервер 1С: Предприятие» (<span style=" text-decoration: underline;">на этой машине он не нужен</span>, т.к. он уже установлен на другом хосте под ОС Линукс… Хотя если у вас в будущем будет гетерогенный «кластер серверов 1С»: в которых будут входить машины под управлением не только Линукс, но и Widows — только тогда этот пункт вам понадобится...)</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> «Модули расширения веб-сервера» (работают только под Windows: «Сервер 1С» под Windows + web-сервер IIS под Windows, можно на разных машинах… Эти модули позволяют просто реализовать сайт, на котором будет интерфейс 1С-клиента встроен прямо в web-страничку. Тяжёлый неповоротливый сайт, потому что соединение из модулей веб-сервера к «серверу 1С» — через DCOM… <span style=" font-style:italic;">Но польза сомнительна: эта хрень требует на каждое подключение удалённого веб-клиента по отдельному полноценному «клиентскому ключу»! Поэтому такой сайт никак не может быть массовым...</span>)</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> «Сервер хранилища конфигураций 1С: Предприятия» (Используется если конфигурация хранится не в реляционной СУБД, а файлово — оптимизирует работу с ней многопользователей, сервера 1С или Web-сервера Apache. <span style=" font-style:italic;">По отзывам: глючная фигня, и походу 1С забила на её развитие...</span>)</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> «Конвертер ИБ 1С: Предприятия 7.7» (нужен только разработчикам)</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br /><span style=" text-decoration: underline;">«Установку HASP-драйвера»</span> производим в том случае, если 1С на данном компьютере будем использовать лицензионную: либо к USB-порту будет присоединяться аппаратный ключ защиты, либо лицензия будет браться из сети с «менеджера лицензий»… <span style=" font-style:italic;">(Напоминаю: если будете использовать кряк/эмулятор, то при инсталляции не ставьте «HASP-драйвер защиты»!)</span><br /> <br /><span style=" font-weight:600;">Совет:</span> Чтобы ничего не глючило, <span style=" text-decoration: underline;">убедитесь в правильных настройках DCOM</span> НА КАЖДОЙ МАШИНЕ под управлением ОС Windows, которую вы используете для работы с 1С. <br />DCOM настраиваются через оснастку dcomcnfg, <a href="http://www.mista.ru/articles1c/1cv8_setup.htm"><span style=" text-decoration: underline; color:#0000ff;">как показано в инструкции...</span></a> <span style=" font-style:italic;">(Примечание: в инструкции говорится не только про DCOM, а про установку 1Сv8+MSSQL… Но в ней также наглядное описание в картинках, куда кликать чтобы настроить DCOM.)</span><br /><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">10b)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Теперь переходим непосредственно к эксплуатации установленного пакета программ:<br /><br />Запускаем MMC-консоль: Пуск -&gt; Программы -&gt; 1С: Предприятие 8.2 -&gt; Дополнительно -&gt; Администрирование серверов 1С: Предприятие. <br /><br />Через консоль, последовательно создаем объекты: «Центральный сервер», «Кластер», «Рабочий сервер», «Рабочий процесс», «Информационная база» — как описано и показано в <a href="http://1c-md.com/administrirovanie/administrirovanie-serverov-1s.html"><span style=" text-decoration: underline; color:#0000ff;">статье «Администрирование серверов 1С Предприятия»...</span></a><br /> <br />Следующие статьи немного устарели и неполные (изменился вид MMC-консоли, порядок создания и параметры компонент), но тоже могут быть полезны для иллюстрации, что требуется сделать на этом этапе:<br /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> <a href="http://life.screenshots.ru/the-code-inside/php-platform/linux-1c-setup/"><span style=" text-decoration: underline; color:#0000ff;">«Установка Сервера 1С: Предприятия 8.1 на Linux-сервер (со скриншотами)»</span></a> / см. заключительный раздел «Создание сервера предприятия».</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> <a href="http://www.gilev.ru/1c/81/setup/pgsql.htm"><span style=" text-decoration: underline; color:#0000ff;">«Установка 1С: Предприятие 8.1 бета в картинках»</span></a></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">10c)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Сейчас установите в USB-порт линукс-сервера 1С аппаратные ключи лицензий (два ключа: особенно требуется «лицензия на сервер», и ещё желательно «сетевые клиентские лицензии»), ибо <span style=" text-decoration: underline;">дальше без ключей работа невозможна!</span> <span style=" font-style:italic;">Другие варианты ключей и вопросы с ними здесь не рассматриваю — они уже выходят за рамки данной статьи… Ещё можно активировать программные лицензии через email/телефон (если линукс драйвер их поддерживает?), или настройте эмуляторы/кряки (но замечу, что </span><span style=" font-style:italic; text-decoration: underline;">под линукс эмуляторов ещё не реализовали</span><span style=" font-style:italic;">, и вряд ли сделают, т.к. особо не нужны)...</span><br /><br />После того как, через MMC-консоль администрирования сервера, [уже была] создана «Информационная база» (пока пустая) — к ней можно подключиться «Толстым клиентом» в режиме «Конфигуратора» и начать создание/настройку прикладной Конфигурации… Сделайте это сейчас: <br /></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> Подключитесь к ИБ Конфигуратором (при первом запуске клиента, нужно добавить ИБ в список: кнопка «Добавить» / «Добавление в список существующей информационной базы» / «На Сервере 1С: Предприятия» / «Кластер серверов» = delldev (имя хоста сервера); «Имя ИБ в кластере» = test1c ); </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> Загрузите Конфигурацию («Конфигурация / Загрузить конфигурацию из файла (.cf)»… затем пройдёт длительный процесс слияния конфигураций и перестройки БД, с запросами подтверждений); </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> Импортируйте реальные учётные данные (пункт меню «Администрирование / Загрузить информационную базу» — это когда данные были предварительно выгружены в «файловый вариант ИБ», используется для сервисных нужд); <br /><span style=" font-style:italic;">Примечание: не путайте этот пункт с </span><a href="http://forum.vingrad.ru/index.php?showtopic=233642&amp;view=findpost&amp;p=1740630"><span style=" font-style:italic; text-decoration: underline; color:#0000ff;">«восстановлением базы данных PostgreSQL из регулярной резервной копии»</span></a><span style=" font-style:italic;"> — этот процесс делается на сервере СУБД PostgreSQL, для всего кластера баз данных целиком, т.е. для всех информационных баз хранящихся на текущем сервере СУБД… Это операция грубая и грандиозная, делается в случае сбоев сервера или при миграции существующего сервера на новое железо...</span></li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> Настройте Пользователей системы и их Роли (пункт меню «Администрирование / Пользователи»… обязательно создайте пользователя «Администратор» и включите ему все возможные Роли).</li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />А когда прикладная Конфигурация будет загружена и настроена — к ней можно будет подключаться разными клиентами (толстым, тонким, web) для использования и решения прикладных задач…<br /><br />На этом всё! Спасибо за внимание!<br /><br /></p>
<hr />
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><a name="chapterL"></a><br /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Литература (использованная и дополнительно рекомендуемая)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />За основу методики взяты статьи:<br /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> <a href="http://life.screenshots.ru/the-code-inside/php-platform/linux-1c-setup/"><span style=" text-decoration: underline; color:#0000ff;">«Установка Сервера 1С: Предприятия 8.1 на Linux-сервер (со скриншотами)»</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> <a href="http://www.gilev.ru/1c/81/setup/pgsql.htm"><span style=" text-decoration: underline; color:#0000ff;">«Установка 1С: Предприятие 8.1 бета в картинках»</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> <a href="http://wiki.sergeysi.net/index.php?title=1C:%D0%9F%D1%80%D0%B5%D0%B4%D0%BF%D1%80%D0%B8%D1%8F%D1%82%D0%B8%D0%B5_%D0%BD%D0%B0_Ubuntu_10.04"><span style=" text-decoration: underline; color:#0000ff;">«1C: Предприятие на Ubuntu 10.04 / Установка PostgreSQL 9.0»</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> <a href="http://www.alsigned.ru/?p=1756"><span style=" text-decoration: underline; color:#0000ff;">«Установка 1с 8.2 и PostgreSQL 9.0.3 на CentOS 6»</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> <a href="http://1c-md.com/administrirovanie/ustanovka-1s-linux.html"><span style=" text-decoration: underline; color:#0000ff;">«Установка 1С: Предприятия 8.2 и PostgreSQL 8.4 на Linux» (статья с видеокастами!)</span></a></li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> <a href="http://1c-md.com/administrirovanie/administrirovanie-serverov-1s.html"><span style=" text-decoration: underline; color:#0000ff;">«Администрирование серверов 1С Предприятия»</span></a></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Книга «1С: Предприятие 8.2 — Руководство администратора».<br /><br />Вдобавок может быть интересно форум-обсуждение <a href="http://forum.ru-board.com/topic.cgi?forum=8&amp;topic=38289#8"><span style=" text-decoration: underline; color:#0000ff;">«Есть ли возможность разнести сервера: 1С Сервер отдельно от PostgreSQL?»</span></a><br /><br />Смотри также рекомендации по тонкой настройке и оптимизации PostgreSQL (после установки системы пригодится) (немного устарело): <a href="http://1clinux.org/index.php?topic=447.0"><span style=" text-decoration: underline; color:#0000ff;">тут</span></a>, <a href="http://www.gilev.ru/1c/81/postgresql/index.htm"><span style=" text-decoration: underline; color:#0000ff;">тут</span></a>, <a href="http://wiki.etersoft.ru/PostgreSQL/Optimum"><span style=" text-decoration: underline; color:#0000ff;">тут</span></a>, <a href="http://postgresmen.ru/articles/view/83"><span style=" text-decoration: underline; color:#0000ff;">тут</span></a>, <a href="http://forum.vingrad.ru/forum/topic-233642/0.html"><span style=" text-decoration: underline; color:#0000ff;">тут</span></a>…<br /><br /><a href="http://v8.1c.ru/requirements/"><span style=" text-decoration: underline; color:#0000ff;">Базовые требования к ОС для работы платформы 1С: Предприятие 8.x ...</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; text-decoration: underline; color:#0000ff;"></p></body></html>
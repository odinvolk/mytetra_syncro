<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:10pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:xx-large; font-weight:600;">Модели-Посредники<br /></span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Обзор</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В структуре модель/представление, элементы данных предоставляемые одной моделью могут быть разделены между несколькими представлениями, и каждое из этих представлений может отображать информацию совершенно уникальным способом. Собственные представления и делегаты - эффективные помощники в отображении данных совершенно различными способами. Однако в приложениях часто требуется представление по разному обработанных одних и тех же данных. Например, в виде списков, элементы которых по разному отсортированы.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Казалось бы вполне естественным выполнять сортировку и фильтрацию элементов данных силами самих представлений, но такой подход не позволяет многим представлениям совместно использовать результаты таких потенциально дорогостоящих операций. Альтернативный подход состоит в том, чтобы заставить саму модель сортировать и фильтровать данные, но в итоге каждое представления будет использовать результаты самой последней операции сортировки или фильрации.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для решения этой проблемы, а архитектуре модель/представление используется модель-посредник, управляющая данными, передаваемыми между моделью и представлением. Модели-посредники - это компоненты ведущие, себя по отношению к представлению подобно модели данных и осуществляющие доступ к модели данных от имени представления. Механизм сигналов и слотов, используемый в архитектуре модель/представление, гарантирует, что представление будет обновлено независимо от того, сколько моделей-посредников расположено между ней и моделью данных.<a name="using-proxy-models"></a> </p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Использование Моделей-Посредников</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Модели-посредники могут быть вставлены между существующей моделью и любым количеством представлений. Qt предоставляет стандартную модель-посредник <span style=" font-family:'Courier New'; color:#6a0e07;">QSortFilterProxyModel</span>, которая может использоваться как сама по себе, так и служить основой для подклассов, реализующих собственные способы фильтрации и сортировки. Класс <span style=" font-family:'Courier New'; color:#6a0e07;">QSortFilterProxyModel</span> может использоваться следующим образом:</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">        QSortFilterProxyModel *filterModel = new QSortFilterProxyModel(parent);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">        filterModel-&gt;setSourceModel(stringListModel);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; color:#6a0e07;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">        QListView *filteredView = new QListView;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">        filteredView-&gt;setModel(filterModel);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; color:#6a0e07;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Так как модели-посредники являются наследниками <span style=" font-family:'Courier New'; color:#6a0e07;">QAbstractItemModel</span>, они могут быть соединены с представлением любого вида и быть разделенными между представлениями. Также они могут использоваться для обработки данных, полученных от другой модели-посредника.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Класс <span style=" font-family:'Courier New'; color:#6a0e07;">QSortFilterProxyModel</span> разработан для того, чтобы использоваться непосредственно в приложениях. Наследуя этот класс можно создать более специализированную модель-посредник, реализующую требуемые операции сравнения.<a name="customizing-proxy-models"></a> </p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Настройка Моделей-Посредников</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обработка данных моделью-посредником включает в себя и перемещение каждого элемента данных относительно его изначального расположения в модели данных. В некоторых моделях, отдельные элементы могут не обрести соответствующего расположения в модели-посреднике; такие модели являются <span style=" font-style:italic;">фильтрующими</span> моделями-посредниками. Представления работают с элементами данных, используя модельные индексы, полученные от модели-посредника и не имеют никакого представления относительно расположения элементов в модели данных.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">QSortFilterProxyModel</span> позволяет отсортировать данные перед предоставлением их представлению, а также позволяет предоставить представлению несортированные данные.<a name="custom-filtering-models"></a> </p>
<p style="-qt-paragraph-type:empty; margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Собственные Фильтрующие Модели</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Класс <span style=" font-family:'Courier New'; color:#6a0e07;">QSortFilterProxyModel</span> предоставляет довольно универсальную фильтрующую модель, которая может использоваться в самых разных ситуациях. Продвинутые пользователи, для реализации собственных механизмов фильтрации, могут создать подкласс <span style=" font-family:'Courier New'; color:#6a0e07;">QSortFilterProxyModel</span>.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Подкласс <span style=" font-family:'Courier New'; color:#6a0e07;">QSortFilterProxyModel</span> может повторно реализовать две виртуальные функции, которые вызываются всякий раз, когда требуется или используется модельный индекс от модели-посредника:</p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">filterAcceptsColumn()</span> используется для фильтрации определенных колонок исходной модели.</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a0e07;">filterAcceptsRow()</span> используется для фильтрации определенных строк исходной модели.</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Реализация этих функций в <span style=" font-family:'Courier New'; color:#6a0e07;">QSortFilterProxyModel</span> по умолчанию всегда возвращает true для того, чтобы гарантировать, что все строки и колонки будут переданы представлению. Для того, чтобы представление не получало информацию о некоторых строках и колонках, повторная реализация этих функций должна для них возвращать false.<a name="custom-sorting-models"></a> </p>
<p style="-qt-paragraph-type:empty; margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Собственные Сортирующие Модели</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для установки порядка элементов исходной модели, экземпляры <span style=" font-family:'Courier New'; color:#6a0e07;">QSortFilterProxyModel</span> используют встроенную в Qt функцию <span style=" font-family:'Courier New'; color:#6a0e07;">qStableSort()</span>, тем самым позволяя представлению получить иерархию элементов без изменения структуры исходной модели. Для воплощения собственного метода сортировки, заново реализуйте функцию <span style=" font-family:'Courier New'; color:#6a0e07;">lessThan()</span>, в которой пропишите свои правила сравнения.</p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>